<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´» | Wise Salted Fish Life</title>
    <meta name="description" content="ä¸€å€‹çµ¦åŸºç£å¾’çš„è¼•é¬†éˆä¿®èˆ‡ç”Ÿæ´»å°å·¥å…·ï¼Œæ‹’çµ•å±¬éˆç„¦æ…®ï¼Œå¿«æ¨‚åšé¹¹é­šã€‚">
    
    <!-- PWA / ä¸»ç•«é¢åœ–ç¤ºè¨­å®š (App Icons) -->
    <!-- é è¨­ SVG åœ–ç¤º (ä¿®æ­£ç·¨ç¢¼ï¼Œç¢ºä¿ç€è¦½å™¨èƒ½è®€å–) -->
    <link rel="icon" id="favicon-link" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' rx='40' fill='%237CA1B3'/%3E%3Cellipse cx='100' cy='50' rx='60' ry='10' fill='none' stroke='%23D4B483' stroke-width='6'/%3E%3Cpath d='M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z' fill='%23FFFFFF'/%3E%3Cpath d='M180 130 L 200 110 L 200 150 Z' fill='%23FFFFFF'/%3E%3Cellipse cx='60' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cellipse cx='140' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cg stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'%3E%3Cline x1='75' y1='112' x2='75' y2='128'/%3E%3Cline x1='69' y1='118' x2='81' y2='118'/%3E%3Cline x1='125' y1='112' x2='125' y2='128'/%3E%3Cline x1='119' y1='118' x2='131' y2='118'/%3E%3C/g%3E%3Cline x1='95' y1='145' x2='105' y2='145' stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'/%3E%3C/svg%3E" type="image/svg+xml">
    
    <!-- iOS ä¸»ç•«é¢åœ–ç¤º (é è¨­å…ˆçµ¦ SVGï¼ŒJS æœƒå‡ç´šæˆ PNG) -->
    <link rel="apple-touch-icon" id="apple-icon-link" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%237CA1B3'/%3E%3Cellipse cx='100' cy='50' rx='60' ry='10' fill='none' stroke='%23D4B483' stroke-width='6'/%3E%3Cpath d='M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z' fill='%23FFFFFF'/%3E%3Cpath d='M180 130 L 200 110 L 200 150 Z' fill='%23FFFFFF'/%3E%3Cellipse cx='60' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cellipse cx='140' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cg stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'%3E%3Cline x1='75' y1='112' x2='75' y2='128'/%3E%3Cline x1='69' y1='118' x2='81' y2='118'/%3E%3Cline x1='125' y1='112' x2='125' y2='128'/%3E%3Cline x1='119' y1='118' x2='131' y2='118'/%3E%3C/g%3E%3Cline x1='95' y1='145' x2='105' y2='145' stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'/%3E%3C/svg%3E">
    
    <!-- Android PWA è¨­å®š (Manifest) -->
    <link rel="manifest" href="manifest.json" id="manifest-placeholder">

    <!-- 4. è¡Œå‹•è£ç½®é¡¯ç¤ºå„ªåŒ– -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#FDFCF8">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <style>
        :root {
            /* --- INS é¢¨é«˜ç´šæ„Ÿé…è‰² --- */
            --bg-color: #FDFCF8;
            --card-bg: #FFFFFF;
            --text-primary: #5A524C;
            --text-secondary: #9E9791;
            --accent-blue: #7CA1B3;
            --accent-blue-light: #E8F1F5; 
            --accent-gold: #D4B483;
            --accent-warning: #D98E73;
            --accent-green: #8FB3A3;
            --accent-purple: #B5A3BE;
            --accent-purple-light: #F3EAF5;
            --border-color: #F0EAE4;
            --shadow-soft: 0 10px 40px -10px rgba(90, 82, 76, 0.08);
            --radius-main: 24px;
            --radius-btn: 12px;
            
            /* æ–°å¢è«è˜­è¿ªè‰²ç³»æ•´åˆ */
            --morandi-green: #8DA399;
            --morandi-pink: #D4A5A5;
            --morandi-bg-gray: #F7F7F7;

            /* å­˜éŒ¢æ ¼å­çš„æ·±è‰²èƒŒæ™¯ï¼Œç¢ºä¿ç™½å­—æ¸…æ™° */
            --savings-saved-bg: #5A7D8F; 
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        /* --- App Shell ä½ˆå±€ --- */
        html, body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.7;
            height: 100vh; 
            height: 100dvh; 
            width: 100vw;
            overflow: hidden;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            /* è¼•å¾®çš„ SVG èƒŒæ™¯ç´‹ç† */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%235a524c' fill-opacity='0.03'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z'/%3E%3C/g%3E%3C/svg%3E");
        }

        /* å…§éƒ¨æ²å‹•å®¹å™¨ */
        #scroll-wrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            height: 100%;
            position: relative;
            scroll-behavior: smooth;
            padding-bottom: 100px; /* å¢åŠ åº•éƒ¨ç©ºé–“ï¼Œé¿å…è¢«å°è¦½åˆ—é®ä½ */
        }

        header { text-align: center; padding: 50px 20px 30px; }
        h1 { font-family: 'Noto Serif TC', serif; font-size: 2rem; font-weight: 700; color: var(--text-primary); letter-spacing: 0.05em; margin-bottom: 6px; }
        .subtitle { font-family: 'Noto Sans TC', sans-serif; font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.2em; }
        
        main { 
            padding: 0 20px; 
            max-width: 500px; 
            margin: 0 auto; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
        }

        .card { background: var(--card-bg); border-radius: var(--radius-main); padding: 30px; box-shadow: var(--shadow-soft); text-align: center; margin-bottom: 25px; border: 1px solid var(--border-color); transition: transform 0.3s ease; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, transparent, var(--accent-blue), transparent); opacity: 0.5; }

        .mascot-container { width: 140px; height: 140px; margin: 0 auto 20px; position: relative; }
        .mascot-svg { width: 100%; height: 100%; animation: float 3.5s ease-in-out infinite; filter: drop-shadow(0 10px 15px rgba(124, 161, 179, 0.3)); }
        .halo { transform-origin: center; animation: halo-glow 3s ease-in-out infinite alternate; }
        .eye { transform-origin: center; animation: blink 4s infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-8px) rotate(1deg); } }
        @keyframes halo-glow { 0% { opacity: 0.6; stroke-width: 2px; } 100% { opacity: 1; stroke-width: 3px; } }
        @keyframes blink { 0%, 48%, 52%, 100% { transform: scaleY(1); } 50% { transform: scaleY(0.1); } }

        h2 { font-family: 'Noto Serif TC', serif; font-size: 1.4rem; color: var(--text-primary); margin-bottom: 15px; }
        p { color: var(--text-primary); font-weight: 300; }
        .text-muted { color: var(--text-secondary); font-size: 0.9rem; }
        .label { display: block; text-align: left; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 10px; font-weight: 500; }
        
        select, input[type="text"], input[type="number"] { width: 100%; padding: 14px 16px; border-radius: var(--radius-btn); border: 1px solid var(--border-color); background: #FAFAFA; color: var(--text-primary); font-size: 1rem; margin-bottom: 15px; outline: none; transition: border 0.2s; }
        select:focus, input[type="text"]:focus, input[type="number"]:focus { border-color: var(--accent-blue); }
        
        .btn-primary { background: var(--text-primary); color: white; border: none; padding: 14px 30px; border-radius: 50px; font-size: 1rem; cursor: pointer; font-weight: 500; width: 100%; transition: all 0.2s ease; box-shadow: 0 4px 15px rgba(90, 82, 76, 0.2); }
        .btn-primary:active { transform: scale(0.97); }
        .btn-icon { background: transparent; border: none; cursor: pointer; padding: 8px; color: var(--accent-blue); transition: transform 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .btn-icon:hover { background-color: var(--accent-blue-light); border-radius: 50%; }

        .preservative-btn { background: white; border: 1px solid var(--accent-green); color: var(--accent-green); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; margin-bottom: 15px; display: inline-flex; align-items: center; gap: 5px; transition: all 0.2s; }
        .preservative-box { font-family: 'Noto Serif TC', serif; font-size: 1rem; color: var(--text-primary); min-height: 40px; margin-bottom: 15px; font-style: italic; opacity: 0; transition: opacity 0.5s; }

        .bible-plan-panel { margin-top: 25px; padding-top: 20px; border-top: 1px dashed var(--border-color); text-align: left; }
        .panel-desc { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 15px; font-weight: 400; font-style: italic; line-height: 1.6; }
        .progress-bar-bg { background: #eee; border-radius: 10px; height: 16px; overflow: hidden; width: 100%; margin-bottom: 10px; position: relative; }
        .progress-bar-fill { background: linear-gradient(90deg, var(--accent-blue), #A3C4BC); height: 100%; width: 0%; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); border-radius: 10px; }
        .progress-info { background: #FAFAFA; padding: 15px; border-radius: 15px; border: 1px solid var(--border-color); margin-bottom: 15px; }
        .progress-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-primary); }
        
        .progress-quote { font-size: 0.9rem; color: var(--accent-blue); font-style: italic; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee; display: flex; align-items: flex-start; gap: 5px; cursor: pointer; transition: color 0.2s; }
        .progress-quote:hover { color: var(--accent-green); }
        .refresh-icon { font-size: 1.1rem; opacity: 0.7; margin-top: 1px; margin-left: 5px; }

        .check-in-btn { background: var(--accent-blue); color: white; border: none; padding: 10px 0; border-radius: 30px; font-size: 0.9rem; cursor: pointer; width: 100%; box-shadow: 0 4px 10px rgba(124, 161, 179, 0.3); transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .check-in-btn.checked { background: var(--accent-green); cursor: default; }

        /* --- Devotion Section Specifics --- */
        .tab-switcher { display: flex; background: #F2F2F2; padding: 5px; border-radius: 50px; margin-bottom: 25px; gap: 2px; }
        .tab-btn { flex: 1; border: none; background: transparent; padding: 10px 5px; border-radius: 40px; color: var(--text-secondary); cursor: pointer; font-size: 0.85rem; transition: all 0.3s; font-weight: 500; white-space: nowrap;}
        .tab-btn.active { background: white; color: var(--text-primary); shadow: 0 2px 5px rgba(0,0,0,0.05); font-weight: bold; }
        
        .sub-section { display: none; animation: fadeIn 0.3s ease; }
        .sub-section.active { display: block; }

        .bible-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .day-cell { aspect-ratio: 1; border-radius: 16px; background: white; border: 1px solid var(--border-color); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; position: relative; }
        .day-cell.completed { background: var(--morandi-green); color: white; border-color: var(--morandi-green); }
        .day-cell.today { border: 2px solid var(--accent-gold); } /* ä»Šæ—¥é«˜äº® */
        .day-cell:active { transform: scale(0.95); }
        .day-num { font-size: 0.75rem; opacity: 0.7; font-weight: bold; margin-bottom: 2px; }
        .day-read { font-size: 0.8rem; font-weight: 500; line-height: 1.1; }

        .prayer-item, .goal-item, .wish-item { background: white; padding: 15px; border-radius: 16px; border: 1px solid var(--border-color); margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s; }
        .prayer-item.answered { background: #F0F5F3; border-color: #E0EBE6; }
        .prayer-content, .wish-content { flex: 1; text-align: left; }
        .prayer-text, .wish-text { font-size: 1rem; margin-bottom: 4px; color: var(--text-primary); }
        .prayer-meta, .wish-meta { font-size: 0.75rem; color: #aaa; display: flex; gap: 5px; align-items: center; }
        .action-btn { background: none; border: none; padding: 5px; cursor: pointer; color: #ccc; transition: color 0.2s; }
        .action-btn:hover { color: var(--accent-warning); }
        
        .goal-item.done, .wish-item.fulfilled { opacity: 0.6; background: #F9F9F9; }
        .goal-item.done .goal-text, .wish-item.fulfilled .wish-text { text-decoration: line-through; color: #aaa; }
        
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .input-group input { margin-bottom: 0; }
        .add-btn { background: var(--morandi-pink); color: white; border: none; width: 50px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        .signal-textarea { width: 100%; border: 1px solid var(--border-color); border-radius: 16px; padding: 15px; font-size: 1rem; color: var(--text-primary); background: #FAFAFA; resize: none; min-height: 100px; margin-bottom: 10px; outline: none; transition: border 0.2s; font-family: 'Noto Serif TC', serif; }
        .signal-textarea:focus { border-color: var(--accent-blue); background: white; }
        
        .signal-item { background: white; border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; margin-bottom: 15px; position: relative; }
        .signal-item::before { content: 'â'; position: absolute; top: 45px; left: 15px; font-size: 2rem; color: var(--accent-blue); opacity: 0.2; font-family: serif; z-index: 0; }
        .signal-date { font-size: 0.75rem; color: #aaa; margin-bottom: 0; }
        .signal-content { position: relative; z-index: 1; font-family: 'Noto Serif TC', serif; font-size: 1.05rem; color: var(--text-primary); line-height: 1.6; white-space: pre-wrap; padding-left: 10px; margin-top: 5px; }

        .backup-section { border-top: 1px dashed var(--border-color); padding-top: 20px; margin-top: 30px; text-align: center; }
        .backup-title { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 10px; font-weight: bold; }
        .backup-btn-group { display: flex; gap: 10px; justify-content: center; }
        .btn-small { font-size: 0.8rem; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-color); background: white; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
        .btn-small:hover { background: #f0f0f0; color: var(--text-primary); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); backdrop-filter: blur(3px); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-content { background: white; width: 85%; max-width: 320px; padding: 30px; border-radius: 30px; text-align: center; transform: scale(0.9); transition: transform 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.1); }
        .modal-overlay.show .modal-content { transform: scale(1); }

        .flip-container { perspective: 1000px; width: 100%; height: 340px; cursor: pointer; }
        .flipper { position: relative; width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
        .flip-container.flipped .flipper { transform: rotateY(180deg); }
        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: var(--radius-main); box-shadow: var(--shadow-soft); background: var(--card-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; border: 1px solid var(--border-color); }
        .back { transform: rotateY(180deg); background: #FDFBF7; border: 2px solid var(--accent-blue); }
        .quote-content { font-family: 'Noto Serif TC', serif; font-size: 1.25rem; margin-bottom: 20px; color: var(--text-primary); line-height: 1.6; text-align: center; }

        /* ä¿®æ”¹ï¼šçµæœæ¡†å¢åŠ ç›¸å°å®šä½èˆ‡éš±è—æº¢å‡ºï¼Œé™åˆ¶çƒé´‰é£›è¡Œç¯„åœ */
        .result-box { 
            background: var(--accent-blue-light); 
            border-radius: var(--radius-btn); 
            padding: 25px; 
            margin-top: 20px; 
            margin-bottom: 10px; 
            min-height: 120px; /* ç¨å¾®åŠ é«˜ä¸€é»çµ¦çƒé´‰é£› */
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            opacity: 0; 
            transition: all 0.5s ease; 
            border: 1px solid var(--border-color); 
            color: var(--text-primary); 
            font-family: 'Noto Serif TC', serif; 
            font-size: 1.1rem; 
            position: relative; /* é—œéµï¼šä½œç‚ºçµ•å°å®šä½å­å…ƒç´ çš„åƒè€ƒé» */
            overflow: hidden;   /* é—œéµï¼šé™åˆ¶å…§å®¹ä¸è¶…å‡ºæ¡†æ¡† */
        }
        
        .pua-result-box { background: #F8F5FA; border: 1px solid var(--accent-purple); border-radius: var(--radius-btn); padding: 20px; margin-top: 20px; text-align: left; opacity: 0; transition: opacity 0.5s; }
        .pua-label { font-size: 0.8rem; color: var(--accent-purple); font-weight: bold; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 1px; }
        .pua-content { font-size: 1rem; color: var(--text-primary); margin-bottom: 15px; line-height: 1.5; }

        /* PUA Level Badge */
        .pua-level-badge {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            background-color: #F3EAF5;
            color: var(--accent-purple);
            font-weight: bold;
            display: none;
            border: 1px solid rgba(181, 163, 190, 0.3);
        }

        /* --- çƒé´‰å‹•ç•«æ¨£å¼ --- */
        .crow-anim-wrapper {
            position: absolute;
            top: 50%;
            left: -80px; /* èµ·é» */
            margin-top: -30px; 
            width: 80px;
            height: 60px;
            z-index: 10;
            pointer-events: none;
            /* Wrapper è² è²¬é£›è¡Œè·¯å¾‘ */
        }

        /* æ–°å¢ï¼šé£›è¡Œè§¸ç™¼é¡åˆ¥ */
        .crow-anim-wrapper.flying {
            animation: crowFlyPath 4s linear forwards;
        }

        .crow-body {
            position: absolute;
            top: 0;
            left: 0;
            font-size: 3rem;
            line-height: 1;
            transform: scaleX(-1); /* é¢å‘å³ */
            /* æ¨¡æ“¬ç¿…è†€æ§å‹•ï¼šè¼•å¾®çš„ä¸Šä¸‹ç¸®æ”¾å’Œæ—‹è½‰ */
            animation: wingFlap 0.3s infinite alternate ease-in-out;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1));
        }

        .crow-meat {
            position: absolute;
            font-size: 1.2rem; /* è‚‰è®Šå° */
            right: 0px; /* é è¿‘å˜´å·´ */
            top: 18px;  /* å˜´å·´é«˜åº¦ */
            z-index: 11;
            /* åˆå§‹ç‹€æ…‹ï¼šè·Ÿè‘—çƒé´‰ */
        }

        .crow-meat.dropping {
            /* æ‰è½å‹•ç•«ç‹€æ…‹ */
            animation: meatFall 0.5s cubic-bezier(0.5, 0, 1, 1) forwards;
        }

        /* ç¿…è†€æ§å‹•æ•ˆæœ */
        @keyframes wingFlap {
            0% { transform: scaleX(-1) translateY(0) rotate(0deg); }
            100% { transform: scaleX(-1) translateY(-3px) rotate(5deg); }
        }

        /* çƒé´‰é£›è¡Œè·¯å¾‘ï¼šå·¦å…¥ -> ä¸­åœ -> å³å‡º */
        @keyframes crowFlyPath {
            0% { left: -80px; } 
            40% { left: 50%; transform: translateX(-50%); } /* é£›åˆ°ä¸­é–“ */
            60% { left: 50%; transform: translateX(-50%); } /* åœç•™ */
            100% { left: calc(100% + 80px); } /* é£›å‡º */
        }

        /* è‚‰æ‰è½æ•ˆæœ */
        @keyframes meatFall {
            0% { top: 18px; opacity: 1; transform: scale(1); }
            100% { top: 150px; opacity: 0; transform: scale(0.5); }
        }

        .feedback-section { margin-top: 60px; padding-top: 20px; border-top: 1px dashed var(--border-color); text-align: center; }
        .feedback-text { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 15px; }
        .btn-line { background-color: transparent; color: var(--accent-purple); border: 1px solid var(--accent-purple); padding: 10px 20px; border-radius: 50px; font-size: 0.9rem; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease; font-weight: 500; }
        .btn-line:hover { background-color: var(--accent-purple); color: white; }

        /* åº•éƒ¨å°è¦½åˆ— - Fixed */
        .bottom-nav { 
            position: fixed;
            bottom: 20px; 
            bottom: calc(20px + env(safe-area-inset-bottom)); 
            left: 50%; 
            transform: translateX(-50%); 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.5); 
            padding: 8px 4px; /* ä¿®æ”¹ï¼šç¸®å°å¤–æ¡†å…§è· */
            border-radius: 50px; 
            display: flex; 
            gap: 2px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 99999;
            width: 98%; /* ä¿®æ”¹ï¼šåŠ å¯¬è‡³ 98%ï¼Œçˆ­å–ç©ºé–“ */
            max-width: 460px; /* ä¿®æ”¹ï¼šç¨å¾®æ”¾å¯¬æœ€å¤§é™åˆ¶ */
            justify-content: space-between; 
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch; 
        }

        .nav-item { 
            padding: 8px 2px; /* ä¿®æ”¹ï¼šæ¥µé™ç¸®å°æŒ‰éˆ•å·¦å³å…§è· (åŸ 10px 12px) */
            flex: 1 0 auto;   /* ä¿®æ”¹ï¼šè®“é …ç›®å½ˆæ€§ä¼¸ç¸®ï¼Œç›¡é‡å¡é€²åŒä¸€è¡Œ */
            border-radius: 40px; 
            border: none; 
            background: transparent; 
            color: var(--text-secondary); 
            font-size: 0.7rem; /* ä¿®æ”¹ï¼šç¨å¾®ç¸®å°å­—é«” (åŸ 0.75rem) ä»¥é˜²æ›è¡Œ */
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.3s; 
            white-space: nowrap; 
            text-align: center; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 2px;
            min-width: 50px; /* ä¿®æ”¹ï¼šè¨­å®šæœ€å°å¯¬åº¦ï¼Œç¢ºä¿å¥½é»æ“Š */
        }
        .nav-item.active { background: var(--text-primary); color: white; font-weight: bold; }
        .nav-item svg { width: 20px; height: 20px; margin-bottom: 2px; }
        
        .bottom-nav::-webkit-scrollbar { display: none; }
        .bottom-nav { -ms-overflow-style: none; scrollbar-width: none; }

        .section { display: none; animation: fadeIn 0.4s ease forwards; flex: 1; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: rgba(90, 82, 76, 0.9); color: white; padding: 10px 20px; border-radius: 50px; font-size: 0.9rem; z-index: 2005; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px; }
        .toast.show { transform: translateX(-50%) translateY(0); }

        .global-footer-quote {
            text-align: center;
            font-size: 0.85rem;
            color: #D1D1D1;
            padding: 20px 20px 40px;
            line-height: 2;
            letter-spacing: 0.05em;
            font-style: italic;
            width: 100%;
            pointer-events: none;
        }

        /* --- Tag Styles --- */
        .pua-tags-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .pua-tag-container, .decision-tag-container, .shield-tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        .pua-tag, .decision-tag, .shield-tag {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .pua-tag:hover, .decision-tag:hover, .shield-tag:hover {
            background-color: #e0e0e0;
        }
        
        .pua-tag.selected {
            background-color: var(--accent-purple);
            color: white;
            border-color: var(--accent-purple);
            box-shadow: 0 4px 10px rgba(181, 163, 190, 0.4);
        }
        .decision-tag.selected {
            background-color: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
            box-shadow: 0 4px 10px rgba(124, 161, 179, 0.4);
        }
        .shield-tag.selected {
            background-color: var(--accent-warning);
            color: white;
            border-color: var(--accent-warning);
            box-shadow: 0 4px 10px rgba(217, 142, 115, 0.4);
        }

        .refresh-pua-btn { color: var(--accent-purple); border: 1px solid var(--accent-purple); }
        .refresh-pua-btn:hover { background: var(--accent-purple-light); }
        .refresh-decision-btn { color: var(--accent-blue); border: 1px solid var(--accent-blue); }
        .refresh-decision-btn:hover { background: var(--accent-blue-light); }
        .refresh-shield-btn { color: var(--accent-warning); border: 1px solid var(--accent-warning); }
        .refresh-shield-btn:hover { background: #fdf2ee; }
        
        .refresh-pua-btn, .refresh-decision-btn, .refresh-shield-btn {
            background: transparent;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* --- Savings Grid Styles --- */
        .savings-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 cols for mobile friendliness */
            gap: 6px;
            margin-bottom: 20px;
        }
        .savings-cell {
            aspect-ratio: 1;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            background: white;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        .savings-cell.saved {
            background-color: var(--savings-saved-bg);
            color: white; /* ç¢ºä¿æ–‡å­—æ¸…æ™° */
            border-color: var(--savings-saved-bg);
            font-weight: bold;
        }
        .savings-cell:active { transform: scale(0.9); }

        .ai-encourage-box {
            background: rgba(255,255,255,0.7);
            border: 1px dashed var(--accent-blue);
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--text-primary);
            text-align: center;
            font-family: 'Noto Serif TC', serif;
            font-style: italic;
        }

        /* --- Footer Styles --- */
        footer { 
            text-align: center; 
            font-size: 0.75rem; 
            color: #CCC; 
            padding-bottom: 90px; 
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            border-top: 1px dashed var(--border-color);
            margin-top: 20px;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        
        .social-links, .contact-links { display: flex; justify-content: center; align-items: center; gap: 20px; }
        .contact-section { display: flex; flex-direction: column; align-items: center; gap: 8px; margin-top: 5px; }
        .icon-link { color: var(--text-secondary); transition: color 0.3s, transform 0.2s; display: flex; align-items: center; justify-content: center; }
        .icon-link:hover { color: var(--accent-blue); transform: translateY(-2px); }
        .icon-link svg { width: 24px; height: 24px; }
        .contact-label { font-size: 0.8rem; color: var(--text-secondary); font-weight: 500; letter-spacing: 1px; }
        /* ä¿®æ”¹ï¼šå°‡è­¦èªé¡è‰²åŠ æ·±ï¼Œå¾ #D1D1D1 æ”¹ç‚º #9E9791 (èˆ‡æ¬¡è¦æ–‡å­—åŒè‰²) */
        .ai-note { font-size: 0.7rem; color: #9E9791; margin-bottom: 8px; font-style: italic; }

        #quote-comment { font-size: 0.85rem; color: var(--accent-blue); font-style: italic; margin-top: 40px; padding-top: 15px; border-top: 1px dashed #eee; width: 85%; }
    </style>
</head>
<body>

    <!-- å…§éƒ¨æ²å‹•å®¹å™¨ (App Shell) -->
    <div id="scroll-wrapper">
        <header>
            <h1>æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´»</h1>
            <div class="subtitle">Wise Salted Fish Life</div>
        </header>

        <main>
            <!-- é¦–é  -->
            <section id="home" class="section active">
                <div class="card">
                    <div style="position: absolute; top: 20px; right: 20px; background: var(--accent-blue); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem;">é¹¹é­šé¹½åº¦ç›£æ¸¬ä¸­</div>
                    <div class="mascot-container">
                        <svg class="mascot-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <ellipse class="halo" cx="100" cy="50" rx="60" ry="10" fill="none" stroke="#D4B483" stroke-width="3" />
                            <path d="M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z" fill="#7CA1B3" />
                            <path d="M180 130 L 200 110 L 200 150 Z" fill="#7CA1B3" />
                            <ellipse cx="60" cy="135" rx="10" ry="6" fill="#FFAB91" opacity="0.7" />
                            <ellipse cx="140" cy="135" rx="10" ry="6" fill="#FFAB91" opacity="0.7" />
                            <g class="eye">
                                <line x1="75" y1="112" x2="75" y2="128" stroke="white" stroke-width="3" stroke-linecap="round"/><line x1="69" y1="118" x2="81" y2="118" stroke="white" stroke-width="3" stroke-linecap="round"/>
                                <line x1="125" y1="112" x2="125" y2="128" stroke="white" stroke-width="3" stroke-linecap="round"/><line x1="119" y1="118" x2="131" y2="118" stroke="white" stroke-width="3" stroke-linecap="round"/>
                            </g>
                            <line x1="95" y1="145" x2="105" y2="145" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h2 id="daily-status-title">é¹¹é­šé¹½åº¦æ¢æ¸¬ä¸­...</h2>
                    <p id="daily-status-desc" class="text-muted" style="margin-bottom: 15px;">è«‹ä¿æŒå‘¼å¸ï¼Œæ­£åœ¨è¨ˆç®—ä½ èˆ‡å¤©åœ‹çš„è·é›¢...</p>
                    <div style="margin-bottom: 20px;">
                        <button class="preservative-btn" onclick="getPreservative()">âš ï¸ é ˜å–å±¬éˆé˜²è…åŠ‘ (æ€¥æ•‘ç”¨)</button>
                        <div id="preservative-display" class="preservative-box"></div>
                    </div>
                    <button class="btn-icon" onclick="setRandomStatus()">ğŸ”„ é‡æ–°æƒæé¹¹åº¦</button>
                    <div class="bible-plan-panel">
                        <h3 style="font-family:'Noto Serif TC'; font-size:1.1rem; margin-bottom:5px;">é¹¹é­šé†ƒæ¼¬ä¸­</h3>
                        <p class="panel-desc">ã€Œç«‹å¿—åšä¸€æ¢ç”¨è–ç¶“é†ƒæ¼¬çš„é¹¹é­šï¼æ¯å¤©æ’’é»é¹½ï¼ˆè®€ç¶“ï¼‰ï¼Œç”Ÿæ´»æœƒæ›´é¦™å–”ã€‚ã€</p>
                        <div class="progress-bar-bg"><div id="bible-progress" class="progress-bar-fill"></div></div>
                        <div class="progress-info">
                            <div class="progress-row">
                                <span style="display: flex; align-items: center; gap: 5px;">ğŸ“… <span id="current-date-text">--/--</span></span> 
                                <span id="percent-text" style="font-weight:bold; color:var(--accent-blue);">0% å…¥å‘³</span>
                            </div>
                            <div class="progress-row" style="justify-content: flex-start;">ğŸ“– æœ¬æ—¥é€²åº¦ï¼š<span id="plan-scope-text" style="font-weight: bold; margin-left: 5px;">--</span></div>
                            <div class="progress-row" style="justify-content: flex-start;">ğŸ§‚ æœ¬æ—¥åŠ é¹½é‡ï¼š<span id="today-salt-stars" style="margin-left: 5px; color: var(--accent-gold); letter-spacing: 2px;"></span></div>
                            
                            <div class="progress-quote" id="daily-word" onclick="refreshDailyWord()" title="é»æ“Šé‡åˆ·å°èª">
                                <span>ğŸ’¬ æœ¬æ—¥é†ƒæ¼¬å°èª...</span>
                                <span class="refresh-icon">â†»</span>
                            </div>
                        </div>
                        <button class="check-in-btn" onclick="showSection('devotion', document.querySelector('#nav-devotion'))">å‰å¾€é†ƒæ¼¬æ‰“å¡ âœ</button>
                    </div>
                </div>
            </section>

            <!-- éˆä¿® (Devotion) -->
            <section id="devotion" class="section">
                <div class="card">
                    <h2>é¹¹é­šé†ƒæ¼¬è¨ˆåŠƒ</h2>
                    <div class="tab-switcher">
                        <button class="tab-btn active" onclick="switchDevotionTab('bible')">è®€ç¶“</button>
                        <button class="tab-btn" onclick="switchDevotionTab('prayer')">ç¦±å‘Š</button>
                        <button class="tab-btn" onclick="switchDevotionTab('goals')">ç›®æ¨™</button>
                        <button class="tab-btn" onclick="switchDevotionTab('signal')">å¤§è€é—†ç§è¨Š</button>
                    </div>

                    <!-- è®€ç¶“é é¢ -->
                    <div id="tab-bible" class="sub-section active">
                        <div style="text-align: left; margin-bottom: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                            <span id="bible-progress-text">å®Œæˆ 0 / 365</span>
                        </div>
                        <div class="bible-grid" id="bible-grid"></div>
                    </div>

                    <!-- ç¦±å‘Šé é¢ -->
                    <div id="tab-prayer" class="sub-section">
                        <div class="input-group">
                            <input type="text" id="new-prayer-input" placeholder="å¯«ä¸‹ä½ çš„ç¦±å‘Š...">
                            <button class="add-btn" onclick="addPrayer()">ï¼‹</button>
                        </div>
                        
                        <div style="position: relative; margin-bottom: 15px;">
                            <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #ccc;">ğŸ”</span>
                            <input type="text" id="prayer-search" placeholder="æœå°‹ç¦±å‘Šé—œéµå­—æˆ–æ—¥æœŸ..." oninput="renderPrayerList()" style="padding-left: 40px; border-radius: 50px; background: white; border: 1px solid #eee; font-size: 0.9rem; margin-bottom: 0;">
                        </div>

                        <div id="prayer-list"></div>
                        
                        <!-- AI é¼“å‹µèˆ‡çµ±è¨ˆ -->
                        <div style="background: rgba(141, 163, 153, 0.1); padding: 20px; border-radius: 20px; margin-top: 20px;">
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <span>âœ¨</span>
                                <div style="text-align: left;">
                                    <p style="font-size: 0.8rem; font-weight: bold; color: var(--text-primary);">ä¾†è‡ªå¤©çˆ¶çš„æ‚„æ‚„è©±</p>
                                    <p id="ai-encouragement" style="font-family: 'Noto Serif TC'; font-style: italic; color: var(--morandi-green);">--</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div style="background: rgba(255,255,255,0.8); padding: 10px; border-radius: 12px;">
                                    <div id="ongoing-count" style="font-size: 1.2rem; font-weight: bold; color: var(--morandi-pink);">0</div>
                                    <div style="font-size: 0.7rem; color: #999;">ç¦±å‘Šä¸­</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.8); padding: 10px; border-radius: 12px;">
                                    <div id="answered-count" style="font-size: 1.2rem; font-weight: bold; color: var(--morandi-green);">0</div>
                                    <div style="font-size: 0.7rem; color: #999;">å·²å¯¦ç¾</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç›®æ¨™é é¢ -->
                    <div id="tab-goals" class="sub-section">
                        <div style="background: white; border: 1px solid var(--border-color); border-radius: 20px; padding: 20px; margin-bottom: 20px; text-align: center;">
                            <h3 style="font-size: 0.8rem; color: #ccc; text-transform: uppercase; letter-spacing: 1px;">2026 å¹´åº¦é—œéµå­—</h3>
                            <div id="keyword-display" style="padding: 20px 0;">
                                <!-- Keyword content or controls will be rendered here -->
                            </div>
                        </div>

                        <div class="input-group">
                            <input type="text" id="new-goal-input" placeholder="æ–°å¢ä¸€å€‹ç›®æ¨™...">
                            <button class="add-btn" onclick="addGoal()">ï¼‹</button>
                        </div>

                        <div id="goal-list"></div>
                    </div>

                    <!-- è€é—†ç§è¨Šé é¢ -->
                    <div id="tab-signal" class="sub-section">
                        <div style="margin-bottom: 20px;">
                            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 10px;">å®‰éœå¿ƒï¼Œè½è½å¤§è€é—†ï¼ˆä¸Šå¸ï¼‰ä»Šå¤©æƒ³å°ä½ èªªä»€éº¼ï¼Ÿ</p>
                            <textarea id="new-signal-input" class="signal-textarea" placeholder="åœ¨é€™è£¡è¨˜éŒ„ä¸‹å¿ƒä¸­çš„æ„Ÿå‹•æˆ–æ˜¯é ˜å—çš„è©±èª..."></textarea>
                            <button class="btn-primary" onclick="addSignal()" style="background: var(--accent-blue); margin-bottom: 15px;">ğŸ“¥ æ­¸æª”è€é—†æŒ‡ç¤º</button>
                            
                            <div style="position: relative;">
                                <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #ccc;">ğŸ”</span>
                                <input type="text" id="signal-search" placeholder="æœå°‹æ—¥æœŸæˆ–é—œéµå­—..." oninput="renderSignalList()" style="padding-left: 40px; border-radius: 50px; background: white; border: 1px solid #eee; font-size: 0.9rem;">
                            </div>
                        </div>
                        <div id="signal-list"></div>
                    </div>

                    <!-- è³‡æ–™ä¿éšªç®± -->
                    <div class="backup-section">
                        <div class="backup-title">ğŸ”’ è³‡æ–™ä¿éšªç®±</div>
                        <div class="backup-btn-group">
                            <button class="btn-small" onclick="exportData()">ğŸ“¤ åŒ¯å‡ºå‚™ä»½ (æ›æ‰‹æ©Ÿç”¨)</button>
                            <button class="btn-small" onclick="document.getElementById('import-file').click()">ğŸ“¥ åŒ¯å…¥å‚™ä»½</button>
                            <input type="file" id="import-file" style="display: none;" onchange="importData(this)">
                        </div>
                        <p style="font-size: 0.7rem; color: #ccc; margin-top: 5px;">* åŒ…å«è®€ç¶“ã€å­˜éŒ¢ã€é¡˜æœ›ç­‰æ‰€æœ‰ç´€éŒ„ã€‚è³‡æ–™å­˜åœ¨æ‰‹æ©Ÿç€è¦½å™¨ä¸­ï¼Œæ›æ‰‹æ©Ÿå‰è«‹å‹™å¿…åŒ¯å‡ºå‚™ä»½å–”ï¼</p>
                    </div>
                </div>
            </section>

            <!-- é¹¹é­šç¿»èº« -->
            <section id="flip" class="section">
                <div class="card">
                    <!-- çƒé´‰å‹•ç•«å±¤ï¼šæ”¾ç½®åœ¨å¡ç‰‡å…§éƒ¨ï¼Œå— overflow: hidden é™åˆ¶ -->
                    <div id="crow-wrapper" class="crow-anim-wrapper">
                         <div class="crow-body">ğŸ¦â€â¬›</div>
                         <div class="crow-meat" id="crow-meat">ğŸ¥©</div>
                    </div>

                    <div class="flip-container" onclick="flipCard()">
                        <div class="flipper" id="flipper">
                            <div class="front">
                                <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ</div>
                                <h3 style="font-family: 'Noto Serif TC';">é¹¹é­šç¿»èº«</h3>
                                <p class="text-muted" style="margin-top: 10px;">é»æ“Šå¡ç‰‡ï¼Œè«‹ä¸»å»šç‚ºä½ ä¸Šä¸€é“å…¥å‘³çš„ç¿»èº«ç‰¹é¤</p>
                                <p class="text-muted" style="font-size: 0.8rem;">(å« 30% é¹¹é­šé›æ¹¯ï¼Œèˆ‡ 100% ä¸Šå¸ç´”æ·¨æ©å…¸)</p>
                            </div>
                            <div class="back">
                                <p class="quote-content" id="quote-content">æ­£åœ¨å¾Œå°ç†¬è£½äº®å…‰...</p>
                                <p id="quote-source" class="text-muted" style="font-weight:500;">--</p>
                                <p id="quote-comment"> </p>
                                <!-- ä¿®æ”¹æŒ‰éˆ• -->
                                <button class="btn-icon" onclick="saveCardImage(event)" style="margin-top:15px; font-weight:bold;">ğŸ“¸ æ‹ç«‹å¾—æ‰“åŒ… (å­˜åœ–)</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- è°æ˜é¹¹é­š (åŸ æ¸¸åˆƒæœ‰é­š) -->
            <section id="pua" class="section">
                <div class="card">
                    <h2>è°æ˜é¹¹é­š</h2>
                    <div class="text-muted" style="margin-bottom: 45px;">
                        <p><strong>æ‹’çµ•è¢«è£é€²å®—æ•™ç½é ­ï¼</strong></p>
                        <p>è®“ä½ è­˜ç ´å¥—è·¯ï¼Œæ‰¾å›è‡ªç”±ã€‚</p>
                    </div>
                    
                    <div class="pua-tags-header">
                        <label class="label" style="margin-bottom: 0;">ä½ å‰›æ‰è½åˆ°äº†å“ªå¥ã€Œé‡‘å¥ã€ï¼Ÿ</label>
                        <button class="refresh-pua-btn" onclick="renderPuaTags()">ğŸ”„ æ›ä¸€æ‰¹</button>
                    </div>
                    
                    <div id="pua-tag-container" class="pua-tag-container">
                        <!-- JS å°‡è‡ªå‹•å¡«å…¥æ¨™ç±¤ -->
                    </div>

                    <button class="btn-primary" onclick="detectPUA()" style="background-color: var(--accent-purple);">å•Ÿå‹•ç¿»è­¯è’Ÿè’»</button>
                    
                    <div class="pua-result-box" id="pua-result">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span class="pua-label">äººè©±ç¿»è­¯æ©Ÿ</span>
                            <span id="pua-level" class="pua-level-badge"></span>
                        </div>
                        <p class="pua-content" id="pua-translation" style="font-weight: bold;">--</p>
                        <span class="pua-label">é¹¹é­šåæ“Š (å…§å¿ƒ OS)ï¼š</span>
                        <p class="pua-content" id="pua-defense">--</p>
                    </div>

                    <p style="font-size: 0.75rem; color: #D98E73; margin-top: 15px; margin-bottom: 25px; font-style: italic; line-height: 1.5;">
                        âš ï¸ è­¦èªï¼šæœ¬ç¿»è­¯ç”± AI ç”Ÿæˆåƒ…ä¾›å¨›æ¨‚ï¼Œä¸ä»£è¡¨æ¯å€‹äººé€™æ¨£èªªçš„æ„æ€éƒ½æ˜¯é€™æ¨£ã€‚è«‹è¬¹æ…åˆ†è¾¨ï¼Œä¸è¦å°è™Ÿå…¥åº§ï¼Œä¹Ÿä¸è¦ä»¥æ­¤è«–æ–·åˆ¥äººã€‚
                    </p>

                    <button class="btn-secondary" onclick="togglePuaTest()" style="margin-top:25px; border-radius:50px; background:#F8F8F8; padding:12px; border:none; width:100%; cursor:pointer; font-weight:500;">ğŸ§¬ å±¬éˆ PUA ç—…æ¯’å¿«ç¯©</button>
                    
                    <div id="pua-test-area" class="pua-test-area" style="display:none; background:white; border:1px solid var(--border-color); border-radius:var(--radius-main); padding:20px; margin-top:20px; text-align:left;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                            <span style="font-weight:bold; color: var(--accent-purple);">ç’°å¢ƒ PUA æ¯’æ€§æª¢æ¸¬ (7é¡Œ)</span>
                            <button onclick="initPuaTest()" style="border:none; background:none; cursor:pointer; color: var(--text-secondary); font-size: 0.8rem;">ğŸ”„ æ›ä¸€çµ„è©¦åŠ‘</button>
                        </div>
                        <div id="test-list"></div>
                        <button class="btn-primary" onclick="runPuaTest()" style="margin-top:15px; background-color: var(--accent-purple);">ç”Ÿæˆè¨ºæ–·å ±å‘Š</button>
                        <div id="test-result" class="test-result" style="display:none; margin-top:15px;"></div>
                    </div>

                    <!-- æ–°å¢ï¼šPUA å›é¥‹å€å¡Š -->
                    <div class="feedback-section">
                        <p class="feedback-text">é‚„æœ‰è½éæ›´æ‰¯çš„ï¼Ÿæ­¡è¿å›é¥‹çµ¦ä¸»å»šï¼</p>
                        <a href="https://line.me/R/ti/p/@469cjlho" target="_blank" rel="noopener noreferrer" class="btn-line">ğŸ’¬ åŠ  LINE æŠ•ç¨¿ PUA é‡‘å¥</a>
                    </div>
                </div>
            </section>

            <!-- ä¿®æ”¹ï¼šå°‡æ¸¸åˆƒæœ‰é­š (Shield) ç§»åˆ° ç¶½ç¶½æœ‰é­š (Flow) ä¹‹å‰ -->
            <section id="shield" class="section">
                <div class="card">
                    <h2>æ¸¸åˆƒæœ‰é­š</h2>
                    <div class="text-muted" style="margin-bottom: 40px;">
                        <p>é¢å°è®“äººç¿»ç™½çœ¼çš„æå•ï¼Œé€™è£¡æœ‰è®“ä½ å„ªé›…è„«èº«çš„é¹¹é­šæ™ºæ…§ã€‚</p>
                    </div>
                    
                    <div class="pua-tags-header">
                        <label class="label" style="margin-bottom: 0;">ç•¶å°æ–¹å•ä½ é€™äº›å°·å°¬å•é¡Œæ™‚ï¼š</label>
                        <button class="refresh-shield-btn" onclick="renderShieldTags()">ğŸ”„ æ›ä¸€æ‰¹</button>
                    </div>

                    <div id="shield-tag-container" class="shield-tag-container">
                          <!-- JS è‡ªå‹•å¡«å…¥æ¨™ç±¤ -->
                    </div>

                    <button class="btn-primary" onclick="getExcuse()">ç”Ÿæˆç¥å›è¦†</button>
                    <div class="result-box" id="shield-result"><p id="shield-text" style="font-family: 'Noto Serif TC';"></p></div>

                    <!-- æ–°å¢ï¼šShield å›é¥‹å€å¡Š -->
                    <div class="feedback-section" style="margin-top: 30px;">
                        <p class="feedback-text">é‡éæ›´è®“äººç¿»ç™½çœ¼çš„å•é¡Œï¼Ÿ</p>
                        <a href="https://line.me/R/ti/p/@469cjlho" target="_blank" rel="noopener noreferrer" class="btn-line" style="color: var(--accent-warning); border-color: var(--accent-warning);">ğŸ’¬ åŠ  LINE æŠ•ç¨¿å°·å°¬å•é¡Œ</a>
                    </div>
                </div>
            </section>

            <section id="flow" class="section">
                <div class="card">
                    <h2>ç¶½ç¶½æœ‰é­š</h2>
                    <div class="text-muted" style="margin-bottom: 20px;">
                        <p>å³ä½¿åœ¨èººå¹³çš„æ™‚åˆ»ï¼Œæ©å…¸ä¾ç„¶ç¶½ç¶½æœ‰é¤˜ã€‚</p>
                    </div>
                    
                    <div class="tab-switcher">
                        <button class="tab-btn active" onclick="switchFlowTab('savings')">ğŸ’° 365 å­˜éŒ¢</button>
                        <button class="tab-btn" onclick="switchFlowTab('wishlist')">âœ¨ é¡˜æœ›æ¸…å–®</button>
                    </div>

                    <!-- 365 å­˜éŒ¢åˆ†é  -->
                    <div id="tab-savings" class="sub-section active">
                        <div style="text-align: left; margin-bottom: 15px; font-size: 0.9rem; color: var(--text-secondary); display: flex; justify-content: space-between; align-items: center;">
                            <span>ç›®å‰ç´¯è¨ˆï¼š<b id="savings-total" style="color: var(--text-primary); font-size: 1.1rem;">$0</b></span>
                            <span style="font-size: 0.8rem;">ç›®æ¨™ï¼š$66,795</span>
                        </div>
                        <div class="savings-grid" id="savings-grid">
                            <!-- JS è‡ªå‹•ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- é¡˜æœ›æ¸…å–®åˆ†é  -->
                    <div id="tab-wishlist" class="sub-section">
                        <div class="input-group">
                            <input type="text" id="new-wish-input" placeholder="ä½ çš„é¡˜æœ›..." style="flex: 2;">
                            <input type="number" id="new-wish-cost" placeholder="$ é‡‘é¡" style="flex: 1;">
                            <button class="add-btn" onclick="addWish()">ï¼‹</button>
                        </div>
                        
                        <div id="wish-list"></div>

                        <!-- AI é¼“å‹µå€ -->
                        <div class="ai-encourage-box">
                            <p id="financial-encouragement">--</p>
                            <button onclick="refreshFinancialEncouragement()" style="background:none; border:none; color: var(--accent-blue); font-size: 0.8rem; margin-top: 10px; cursor: pointer;">â†» æ›ä¸€å¥é¼“å‹µ</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å…¨åŸŸèƒŒæ™¯èªéŒ„å€ -->
            <div class="global-footer-quote">
                <p>ã€Œä½ å€‘æ˜¯ä¸–ä¸Šçš„é¹½ï¼Œé¹½è‹¥å¤±äº†å‘³â€¦â€¦ã€</p>
                <p>é‚£å°±æš«æ™‚åšä¸€æ¢å¿«æ¨‚çš„é¹¹é­šã€‚</p>
            </div>

            <footer>
                <!-- è¯çµ¡æˆ‘å€‘ (æ•´åˆæ‰€æœ‰ç¤¾ç¾¤é€£çµ) -->
                <div class="contact-section">
                    <span class="contact-label" style="margin-bottom: 12px; font-size: 0.85rem;">è¯çµ¡æˆ‘å€‘</span>
                    <div class="social-links" style="gap: 25px;">
                        <a href="https://www.facebook.com/profile.php?id=100068500932557" class="icon-link" aria-label="Facebook" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                        </a>
                        <a href="https://www.instagram.com/forever.believe.in.jesus/" class="icon-link" aria-label="Instagram" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                        </a>
                        <a href="https://www.threads.net/@forever.believe.in.jesus" class="icon-link" aria-label="Threads" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path></svg>
                        </a>
                        <a href="https://line.me/R/ti/p/@469cjlho" class="icon-link" aria-label="Official Line" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                        </a>
                        <a href="mailto:newthingsinthelittlelight@gmail.com" class="icon-link" aria-label="Email">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        </a>
                    </div>
                </div>

                <div style="margin-top: 25px;">
                    <p class="ai-note">ğŸ’¡ æœ¬ç«™æ‰€æœ‰æ–‡æ¡ˆçš†ç”± AI èˆ‡é¹¹é­šå”åŒé†ƒæ¼¬è€Œæˆï¼Œåƒ…ä¾›å¨›æ¨‚ã€‚</p>
                    <p>&copy; 2026æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´» | è€¶ç©ŒåŠ æ²¹ç«™ x å¾®å…‰æ–°äº‹</p>
                </div>
            </footer>
        </main>
    </div>

    <!-- åº•éƒ¨å°è¦½åˆ— -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="showSection('home', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            é¦–é 
        </button>
        <button class="nav-item" id="nav-devotion" onclick="showSection('devotion', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
            é†ƒæ¼¬é¹¹é­š
        </button>
        <button class="nav-item" onclick="showSection('flip', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
            é¹¹é­šç¿»èº«
        </button>
        <button class="nav-item" onclick="showSection('pua', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            è°æ˜é¹¹é­š
        </button>
        <!-- ä¿®æ”¹ï¼šå°‡ nav-item é †åºä¹Ÿå°èª¿ï¼Œæ¸¸åˆƒæœ‰é­šåœ¨å‰ -->
        <button class="nav-item" onclick="showSection('shield', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            æ¸¸åˆƒæœ‰é­š
        </button>
        <button class="nav-item" onclick="showSection('flow', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            ç¶½ç¶½æœ‰é­š
        </button>
    </nav>

    <!-- è®€ç¶“ç¢ºèªè¦–çª— -->
    <div id="read-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-day" style="font-size: 1.2rem; margin-bottom: 5px;">Day X</h3>
            <p id="modal-reading" style="font-size: 1rem; color: var(--morandi-green); font-weight: bold; margin-bottom: 20px;">å‰µä¸–ç´€ 1-3</p>
            <p style="font-style: italic; color: #999; margin-bottom: 20px;">ã€Œä½ çš„è©±æ˜¯æˆ‘è…³å‰çš„ç‡ˆï¼Œæ˜¯æˆ‘è·¯ä¸Šçš„å…‰ã€‚ã€</p>
            
            <a id="modal-link" href="#" target="_blank" style="display: block; padding: 10px; border: 1px solid #ddd; border-radius: 12px; text-decoration: none; color: #666; margin-bottom: 10px;">ğŸ“– å‰å¾€ YouVersion é–±è®€</a>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="closeModal()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: #f0f0f0;">ç¨å¾Œ</button>
                <button onclick="confirmReading()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: var(--morandi-green); color: white;">å®Œæˆ</button>
            </div>
        </div>
    </div>

    <!-- ç¢ºèªè¦–çª— -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="font-size: 1.2rem; margin-bottom: 15px;">è«‹ç¢ºèª</h3>
            <p id="confirm-msg" style="color: var(--text-primary); margin-bottom: 20px;">ç¢ºå®šè¦åŸ·è¡Œå—ï¼Ÿ</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="closeConfirmModal()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: #f0f0f0;">å–æ¶ˆ</button>
                <button id="confirm-btn-action" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: var(--accent-warning); color: white;">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"><span>å·²æˆåŠŸè¤‡è£½åˆ°éˆé­‚æ·±è™•</span></div>

    <script>
        // --- å‹•æ…‹ç”Ÿæˆ App åœ–ç¤º (è§£æ±º iOS ä¸æ”¯æ´ SVG Data URI çš„å•é¡Œ) ---
        function generateAppIcons() {
            // 1. å»ºç«‹ç•«å¸ƒ
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');

            // 2. ç¹ªè£½èƒŒæ™¯ (è—è‰²)
            ctx.fillStyle = '#7CA1B3'; 
            ctx.fillRect(0, 0, 512, 512);

            // 3. ç¹ªè£½é¹¹é­šåœ–æ¡ˆ
            // å› ç‚ºç”¨ Canvas ç•«è¤‡é›œè·¯å¾‘å¤ªç¹ç‘£ï¼Œæˆ‘å€‘ç›´æ¥å°‡ SVG è½‰ç‚ºåœ–ç‰‡ç•«ä¸Šå»
            const svgString = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
                <!-- èº«é«” (ç™½è‰²) -->
                <path d="M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z" fill="#FFFFFF"/>
                <path d="M180 130 L 200 110 L 200 150 Z" fill="#FFFFFF"/>
                <!-- è…®ç´… -->
                <ellipse cx="60" cy="135" rx="10" ry="6" fill="#FFAB91" opacity="1"/>
                <ellipse cx="140" cy="135" rx="10" ry="6" fill="#FFAB91" opacity="1"/>
                <!-- çœ¼ç› (æ·±è—è‰²ç·šæ¢) -->
                <g stroke="#7CA1B3" stroke-width="5" stroke-linecap="round">
                    <line x1="75" y1="112" x2="75" y2="128"/>
                    <line x1="69" y1="118" x2="81" y2="118"/>
                    <line x1="125" y1="112" x2="125" y2="128"/>
                    <line x1="119" y1="118" x2="131" y2="118"/>
                </g>
                <!-- å˜´å·´ -->
                <line x1="95" y1="145" x2="105" y2="145" stroke="#7CA1B3" stroke-width="5" stroke-linecap="round"/>
                <!-- å…‰ç’° (é‡‘è‰²) -->
                <ellipse cx="100" cy="50" rx="60" ry="10" fill="none" stroke="#D4B483" stroke-width="5"/>
            </svg>`;
            
            const img = new Image();
            // ä½¿ç”¨ encodeURIComponent ç¢ºä¿ SVG å…§å®¹å®‰å…¨è½‰ç‚º Data URI
            img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgString);
            
            img.onload = function() {
                // å°‡ SVG ç•«åœ¨ç•«å¸ƒæ­£ä¸­å¤®
                // ç•«å¸ƒ 512x512ï¼Œæˆ‘å€‘ç•«ä¸€å€‹ 400x400 çš„é­šï¼Œç•™é‚Šè·
                ctx.drawImage(img, 56, 56, 400, 400);
                
                // è½‰å‡º PNG
                const pngUrl = canvas.toDataURL('image/png');
                
                // æ›´æ–° HTML ä¸­çš„é€£çµ
                const favLink = document.getElementById('favicon-link');
                const appleLink = document.getElementById('apple-icon-link');
                
                if(favLink) favLink.href = pngUrl;
                if(appleLink) appleLink.href = pngUrl;
            };
        }

        // --- æ ¸å¿ƒè³‡æ–™ ---
        const bibleBooks = [
            { name: "å‰µä¸–è¨˜", code: "GEN", chapters: 50 }, { name: "å‡ºåŸƒåŠè¨˜", code: "EXO", chapters: 40 }, 
            { name: "åˆ©æœªè¨˜", code: "LEV", chapters: 27 }, { name: "æ°‘æ•¸è¨˜", code: "NUM", chapters: 36 },
            { name: "ç”³å‘½è¨˜", code: "DEU", chapters: 34 }, { name: "ç´„æ›¸äºè¨˜", code: "JOS", chapters: 24 },
            { name: "å£«å¸«è¨˜", code: "JDG", chapters: 21 }, { name: "è·¯å¾—è¨˜", code: "RUT", chapters: 4 },
            { name: "æ’’æ¯è€³è¨˜ä¸Š", code: "1SA", chapters: 31 }, { name: "æ’’æ¯è€³è¨˜ä¸‹", code: "2SA", chapters: 24 },
            { name: "åˆ—ç‹ç´€ä¸Š", code: "1KI", chapters: 22 }, { name: "åˆ—ç‹ç´€ä¸‹", code: "2KI", chapters: 25 },
            { name: "æ­·ä»£å¿—ä¸Š", code: "1CH", chapters: 29 }, { name: "æ­·ä»£å¿—ä¸‹", code: "2CH", chapters: 36 },
            { name: "ä»¥æ–¯æ‹‰è¨˜", code: "EZR", chapters: 10 }, { name: "å°¼å¸Œç±³è¨˜", code: "NEH", chapters: 13 },
            { name: "ä»¥æ–¯å¸–è¨˜", code: "EST", chapters: 10 }, { name: "ç´„ä¼¯è¨˜", code: "JOB", chapters: 42 },
            { name: "è©©ç¯‡", code: "PSA", chapters: 150 }, { name: "ç®´è¨€", code: "PRO", chapters: 31 },
            { name: "å‚³é“æ›¸", code: "ECC", chapters: 12 }, { name: "é›…æ­Œ", code: "SNG", chapters: 8 },
            { name: "ä»¥è³½äºæ›¸", code: "ISA", chapters: 66 }, { name: "è€¶åˆ©ç±³æ›¸", code: "JER", chapters: 52 },
            { name: "è€¶åˆ©ç±³å“€æ­Œ", code: "LAM", chapters: 5 }, { name: "ä»¥è¥¿çµæ›¸", code: "EZE", chapters: 48 },
            { name: "ä½†ä»¥ç†æ›¸", code: "DAN", chapters: 12 }, { name: "ä½•è¥¿é˜¿æ›¸", code: "HOS", chapters: 14 },
            { name: "ç´„ç¥æ›¸", code: "JOL", chapters: 3 }, { name: "é˜¿æ‘©å¸æ›¸", code: "AMO", chapters: 9 },
            { name: "ä¿„å·´åº•äºæ›¸", code: "OBA", chapters: 1 }, { name: "ç´„æ‹¿æ›¸", code: "JON", chapters: 4 },
            { name: "å½Œè¿¦æ›¸", code: "MIC", chapters: 7 }, { name: "é‚£é´»æ›¸", code: "NAM", chapters: 3 },
            { name: "å“ˆå·´è°·æ›¸", code: "HAB", chapters: 3 }, { name: "è¥¿ç•ªé›…æ›¸", code: "ZEP", chapters: 3 },
            { name: "å“ˆè©²æ›¸", code: "HAG", chapters: 2 }, { name: "æ’’è¿¦åˆ©äºæ›¸", code: "ZEC", chapters: 14 },
            { name: "ç‘ªæ‹‰åŸºæ›¸", code: "MAL", chapters: 4 }, { name: "é¦¬å¤ªç¦éŸ³", code: "MAT", chapters: 28 },
            { name: "é¦¬å¯ç¦éŸ³", code: "MRK", chapters: 16 }, { name: "è·¯åŠ ç¦éŸ³", code: "LUK", chapters: 24 },
            { name: "ç´„ç¿°ç¦éŸ³", code: "JHN", chapters: 21 }, { name: "ä½¿å¾’è¡Œå‚³", code: "ACT", chapters: 28 },
            { name: "ç¾…é¦¬æ›¸", code: "ROM", chapters: 16 }, { name: "å“¥æ—å¤šå‰æ›¸", code: "1CO", chapters: 16 },
            { name: "å“¥æ—å¤šå¾Œæ›¸", code: "2CO", chapters: 13 }, { name: "åŠ æ‹‰å¤ªæ›¸", code: "GAL", chapters: 6 },
            { name: "ä»¥å¼—æ‰€æ›¸", code: "EPH", chapters: 6 }, { name: "è…“ç«‹æ¯”æ›¸", code: "PHP", chapters: 4 },
            { name: "æ­Œç¾…è¥¿æ›¸", code: "COL", chapters: 4 }, { name: "å¸–æ’’ç¾…å°¼è¿¦å‰æ›¸", code: "1TH", chapters: 5 },
            { name: "å¸–æ’’ç¾…å°¼è¿¦å¾Œæ›¸", code: "2TH", chapters: 3 }, { name: "ææ‘©å¤ªå‰æ›¸", code: "1TI", chapters: 6 },
            { name: "ææ‘©å¤ªå¾Œæ›¸", code: "2TI", chapters: 4 }, { name: "æå¤šæ›¸", code: "TIT", chapters: 3 },
            { name: "è…“åˆ©é–€æ›¸", code: "PHM", chapters: 1 }, { name: "å¸Œä¼¯ä¾†æ›¸", code: "HEB", chapters: 13 },
            { name: "é›…å„æ›¸", code: "JAS", chapters: 5 }, { name: "å½¼å¾—å‰æ›¸", code: "1PE", chapters: 5 },
            { name: "å½¼å¾—å¾Œæ›¸", code: "2PE", chapters: 3 }, { name: "ç´„ç¿°ä¸€æ›¸", code: "1JN", chapters: 5 },
            { name: "ç´„ç¿°äºŒæ›¸", code: "2JN", chapters: 1 }, { name: "ç´„ç¿°ä¸‰æ›¸", code: "3JN", chapters: 1 },
            { name: "çŒ¶å¤§æ›¸", code: "JUD", chapters: 1 }, { name: "å•Ÿç¤ºéŒ„", code: "REV", chapters: 22 }
        ];

        const encouragements = [
            "ä¸è¦æ€•ï¼Œåªè¦ä¿¡ã€‚", "ä½ çš„ç¦±å‘Šï¼Œç¥éƒ½è½è¦‹äº†ã€‚", "æ‚£é›£ç”Ÿå¿è€ï¼Œå¿è€ç”Ÿè€ç·´ã€‚",
            "æ„›æ˜¯æ°¸ä¸æ­¢æ¯ã€‚", "å‡¡äº‹äº’ç›¸æ•ˆåŠ›ï¼Œå«æ„›ç¥çš„äººå¾—ç›Šè™•ã€‚", "é è‘—é‚£åŠ çµ¦æˆ‘åŠ›é‡çš„ï¼Œå‡¡äº‹éƒ½èƒ½åšã€‚",
            "å–œæ¨‚çš„å¿ƒä¹ƒæ˜¯è‰¯è—¥ã€‚", "å°±åœ¨ä»Šå¤©ï¼Œæ©å…¸å¤ ä½ ç”¨ã€‚", "å …æŒä¸‹å»ï¼Œç¥çš„æ™‚é–“æœ€å®Œç¾ã€‚"
        ];

        const financialEncouragements = [
            "ç©å°‘æˆå¤šï¼Œä¸Šå¸çš„ä¾›æ‡‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚", "ä½ çš„æ¯ä¸€å€‹éŠ…æ¿ï¼Œéƒ½æ˜¯å°æœªä¾†çš„ä¿¡å¿ƒã€‚", 
            "ä¸è¦ç‚ºæ˜å¤©æ†‚æ…®ï¼Œå› ç‚ºæ˜å¤©è‡ªæœ‰æ˜å¤©çš„æ†‚æ…®ã€‚", "è€¶å’Œè¯ä»¥å‹’ï¼Œç¥‚å¿…æœ‰é å‚™ã€‚",
            "ç†è²¡ä¹Ÿæ˜¯ä¸€ç¨®ç®¡å®¶è·åˆ†ï¼Œä½ åšå¾—å¾ˆå¥½ï¼", "å“ªæ€•åªæ˜¯å­˜ä¸‹ä¸€å¡ŠéŒ¢ï¼Œä¹Ÿæ˜¯å‘å¤¢æƒ³é è¿‘çš„ä¸€æ­¥ã€‚",
            "å¯Œè¶³ä¸åœ¨æ–¼æ“æœ‰å¤šå°‘ï¼Œè€Œåœ¨æ–¼çŸ¥è¶³ã€‚", "ç¨®ä»€éº¼æ”¶ä»€éº¼ï¼Œç¾åœ¨çš„å„²è“„æ˜¯æœªä¾†çš„æ”¶æˆã€‚"
        ];

        const keywords = ["çªç ´", "å®‰æ¯", "é‡å»º", "è±ç››", "å‹‡æ°£", "å–œæ¨‚", "å°ˆæ³¨", "è¬™å‘", "ä¿¡å¿ƒ", "æ„›", "æ™ºæ…§", "è€å¿ƒ", "æ›´æ–°", "æ„Ÿæ©", "å¿ å¿ƒ"];

        // --- ç·šä¸Šè³‡æ–™æ±  ---
        let onlineSaltStatusMap = [];
        let onlinePreservativePool = [];
        let onlineFlipQuotes = [];
        let onlinePuaData = [];
        let onlineShieldData = [];
        let dailyQuotesPool = [];

        // --- é è¨­å‚™ç”¨è³‡æ–™æ±  (Fallbacks) ---
        const saltStatusMap = [
            { min: 0, max: 10, title: "å«é¹½é‡ 5%ï¼šæ–°é®®æ·¡æ°´é­š", desc: "è­¦å‘Šï¼šä½ å¤ªæ–°é®®äº†ï¼Œå®Œå…¨æ²’æœ‰é†ƒæ¼¬ç—•è·¡ã€‚å»ºè­°ç«‹åˆ»å»è½é¦–è©©æ­Œå£“å£“é©šã€‚" },
            { min: 11, max: 30, title: "å«é¹½é‡ 20%ï¼šå¾®é¹¹å°é®®è‚‰", desc: "å¾®é¹¹ã€‚å¤§æ¦‚å°±æ˜¯è–¯æ¢å¿˜è¨˜åŠ é¹½çš„ç¨‹åº¦ï¼Œå±¬éˆå‘³é“æ·¡å¦‚æ°´ã€‚" },
            { min: 31, max: 60, title: "å«é¹½é‡ 50%ï¼šå…¥å‘³æ¨™æº–æ¬¾", desc: "é†ƒæ¼¬å¾—æ°åˆ°å¥½è™•ï¼æœ‰å±¬éˆçš„æ°£è³ªï¼Œä¹Ÿæœ‰å±¬ä¸–çš„å¿«æ¨‚ï¼Œç”Ÿæ´»åœ¨æ©å…¸çš„å¹³è¡¡é»ã€‚" },
            { min: 61, max: 90, title: "å«é¹½é‡ 80%ï¼šè³‡æ·±è€é¹¹é­š", desc: "å¤ªè–æ½”äº†ï¼ä½ ç¾åœ¨æ•£ç™¼å‡ºçš„é¹½å‘³è¶³ä»¥è®“å‘¨åœçš„é­”é¬¼æ„Ÿåˆ°ä¹¾æ¸´é›£è€ã€‚" },
            { min: 91, max: 100, title: "å«é¹½é‡ 99%ï¼šå±¬éˆæ ¸å½ˆ", desc: "ä½ å·²ç¶“ä¸æ˜¯é¹¹é­šäº†ï¼Œä½ æ˜¯é¹½æœ¬èº«ã€‚è«‹å–æ¯çå¥¶å¹³è¡¡ä¸€ä¸‹å¤ªéç¥è–çš„é«”è³ªã€‚" }
        ];

        let preservativePool = [
            { tMin: 0, tMax: 30, content: "ä½ æ˜¯ç¥çœ¼ä¸­çš„ç³äººï¼Œå°±ç®—ä½ ç¾åœ¨åªæ˜¯æ¢å»¢é­šï¼Œä¹Ÿæ˜¯æœ€è²´çš„é‚£æ¢ã€‚" },
            { tMin: 0, tMax: 50, content: "æ·±å‘¼å¸ï¼Œå¤©å¡Œä¸‹ä¾†æœ‰è€¶ç©Œé ‚è‘—ï¼Œä½ è² è²¬èººå¹³é ˜å—æ©å…¸å°±å¥½ã€‚" },
            { tMin: 0, tMax: 100, content: "ä¸è«–ä½ ä»Šå¤©å¹¾åº¦ï¼Œç¥æ„›ä½ çš„ç¨‹åº¦å§‹çµ‚æ˜¯ 100%ï¼Œé€™æ‰æ˜¯æœ€çŒ›çš„é˜²è…åŠ‘ã€‚" }
        ];

        const quotes = [
            { text: "å‡¡å‹è‹¦æ“”é‡æ“”çš„äººå¯ä»¥åˆ°æˆ‘é€™è£¡ä¾†ï¼Œæˆ‘å°±ä½¿ä½ å€‘å¾—å®‰æ¯ã€‚", source: "é¦¬å¤ªç¦éŸ³ 11:28", comment: "(é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼šå¿«å»ç¡ï¼Œåˆ¥å†æ»‘æ‰‹æ©Ÿäº†)" },
            { text: "ä½ å€‘è¦ä¼‘æ¯ï¼Œè¦çŸ¥é“æˆ‘æ˜¯ç¥ã€‚", source: "è©©ç¯‡ 46:10", comment: "(é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼šè½è©±ï¼Œç¾åœ¨å°±å»èººå¹³ï¼Œå‰©ä¸‹çš„äº¤çµ¦è€é—†)" },
            { text: "å–œæ¨‚çš„å¿ƒä¹ƒæ˜¯è‰¯è—¥ï¼Œæ†‚å‚·çš„éˆä½¿éª¨æ¯ä¹¾ã€‚", source: "ç®´è¨€ 17:22", comment: "(é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼šå¿ƒæƒ…å¥½æœ€é‡è¦ï¼Œå³ä½¿ä½ åªæ˜¯ä¸€æ¢é¹¹é­š)" }
        ];

        const fullChecklistItems = ["ä½ ä¸é †æœå°±æ˜¯ä¸è’™ç¦", "é€™æ˜¯åœ¨è¨“ç·´ä½ çš„ä¿¡å¿ƒ/ç ´ç¢è€æˆ‘", "ä¸å¯è§¸æ‘¸/è³ªç–‘å—è†è€…", "é€™æ˜¯é­”é¬¼çš„æ”»æ“Š", "é›¢é–‹é€™é–“æ•™æœƒä½ å°±æ²’é®è“‹äº†", "è–éˆæ„Ÿå‹•æˆ‘å«ä½ åšé€™ä»¶äº‹", "ä½ è¦æŠŠä½ çš„ä»¥æ’’(æœ€æ„›çš„)ç»ä¸Š"];

        let puaData = {
            love: { sentence: "ä½ ä¸æœäº‹/ä¸èšæœƒ å°±æ˜¯ä¸æ„›ä¸»ï¼", trans: "æˆ‘éœ€è¦å…è²»å‹å‹•åŠ›ä¾†å¡«è£œè·ç¼ºï¼Œè«‹ä¸è¦è®“æˆ‘é›£åšäººã€‚", defenses: ["ç¥çš„æ„›æ˜¯ç„¡æ¢ä»¶çš„ã€‚æˆ‘çš„ä¼‘æ¯ä¹Ÿæ˜¯ä¸€ç¨®æ•¬æ‹œã€‚", "é¦¬åˆ©äºé¸æ“‡äº†ä¸Šå¥½çš„ç¦åˆ†(èººå¹³)ï¼Œæ˜¯ä¸æœƒè¢«å¥ªå»çš„ã€‚"], level: "â­â­â­" },
            submit: { sentence: "ä½ è¦é †æœæ¬ŠæŸ„ï¼Œä¸è¦å•ç‚ºä»€éº¼ã€‚", trans: "é–‰å˜´ï¼Œè½æˆ‘çš„å°±å¥½ã€‚æˆ‘ä¸æƒ³è§£é‡‹ï¼Œä¹Ÿä¸æƒ³è¢«æŒ‘æˆ°ã€‚", defenses: ["é †æœç¥å¤§æ–¼é †æœäºº.ç›²å¾çµ•å°ä¸æ˜¯é †æœã€‚", "æˆ‘ä¹Ÿåœ¨é †æœç¥çµ¦æˆ‘çš„æ„Ÿå‹•ï¼šç¾åœ¨å…ˆä¸è¦ã€‚"], level: "â­â­â­â­" },
            touch: { sentence: "ä¸å¯è§¸æ‘¸è€¶å’Œè¯çš„å—è†è€…ï¼", trans: "æˆ‘æ˜¯ç‰¹æ¬Šéšç´šï¼Œæˆ‘æœ‰ç¥è–è±å…æ¬Šï¼Œä½ ä¸èƒ½è³ªç–‘æˆ‘çš„éŒ¯èª¤ã€‚", defenses: ["çœŸç†è¶Šè¾¯è¶Šæ˜ã€‚å¦‚æœæ€•è¢«æ‘¸ï¼Œæ˜¯ä¸æ˜¯è£¡é¢æœ‰é¬¼ï¼Ÿ", "æˆ‘å€‘éƒ½æ˜¯å›å°Šçš„ç¥­å¸ï¼Œå¤§å®¶éƒ½æ˜¯å—è†è€…ï¼Œè«‹å¹³ç­‰å°è©±ã€‚"], level: "â­â­â­â­â­" }
        };

        const shields = { 
            marriage: ["æˆ‘åœ¨ç­‰å€™ç¥æ‰€é å‚™çš„äºç•¶/å¤å¨ƒï¼Œé€™äº‹æ€¥ä¸å¾—ã€‚", "ä¿ç¾…èªªå®ˆç´ å®‰å¸¸ä¹Ÿæ˜¯å¥½çš„ã€‚"],
            salary: ["ç©è²¡å¯¶åœ¨å¤©ä¸Šï¼Œåœ°ä¸Šçš„æ•¸å­—å¦‚æµ®é›²ã€‚", "è€¶å’Œè¯ä»¥å‹’å¿…æœ‰é å‚™ã€‚"],
            serve: ["é€™é™£å­ç¥å¸¶é ˜æˆ‘é€²å…¥æ› é‡å­¸ç¿’å®‰éœçš„åŠŸèª²ã€‚", "æˆ‘åœ¨èª¿æ•´å±¬éˆçš„æ­¥ä¼ã€‚"]
        };

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let biblePlan = [];
        let prayers = [];
        let goals = [];
        let userSignals = []; 
        let yearlyKeyword = '';
        let selectedDayId = null;
        let currentPuaSelection = null;
        let currentShieldSelection = null;
        let currentSaltPercent = 0;
        
        // æ–°å¢ç‹€æ…‹
        let savingsPlan = []; // 1-365 array of booleans
        let wishlist = [];

        // --- æ–°å¢ï¼šé€šç”¨ CSV è™•ç† Helper (DRY) ---
        async function fetchAndParseCSV(gid) {
            const sheetId = '2PACX-1vSdgi7Fr-SIVYoVShmmXsGD_ZSYC-nPNaWyp42Haii8fdGtKkLS6jDJ1bPXWyEnknDStJgEkI3WrrYy';
            const url = `https://docs.google.com/spreadsheets/d/e/${sheetId}/pub?gid=${gid}&single=true&output=csv`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network response was not ok');
                const csvText = await response.text();
                
                if (csvText.trim().toLowerCase().startsWith('<!doctype html')) {
                    throw new Error('Received HTML instead of CSV');
                }

                const rows = csvText.split(/\r?\n/);
                if (rows.length === 0) return [];

                // Simple CSV Parser logic reused
                const parseCSVLine = (line) => {
                    const cols = [];
                    let inQuote = false;
                    let currentVal = '';
                    for(let j=0; j<line.length; j++) {
                        const char = line[j];
                        if(char === '"') inQuote = !inQuote;
                        else if(char === ',' && !inQuote) {
                            cols.push(currentVal); currentVal = '';
                        } else currentVal += char;
                    }
                    cols.push(currentVal);
                    return cols.map(c => c.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                };

                const headers = parseCSVLine(rows[0]).map(h => h.trim().toLowerCase().replace(/^\ufeff/, ''));
                
                return { headers, rows: rows.slice(1), parser: parseCSVLine };
            } catch (error) {
                console.warn(`Failed to load CSV for GID ${gid}:`, error);
                // éœæ…‹éƒ¨ç½²é™¤éŒ¯ç”¨ï¼šæç¤ºä½¿ç”¨è€…è¡¨æ ¼å¯èƒ½æœªç™¼å¸ƒ
                if (gid !== '0' && document.readyState === 'complete') {
                    showToast(`âš ï¸ ç„¡æ³•è¼‰å…¥ç·šä¸Šè³‡æ–™ (GID:${gid})ï¼Œè«‹ç¢ºèª Google è¡¨æ ¼æ˜¯å¦å·²ç™¼å¸ƒç‚º CSVã€‚`);
                }
                return null;
            }
        }

        // --- UI Helper Functions ---
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.querySelector('span').innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function saveToStorage(key, value) {
            try {
                localStorage.setItem(key, value);
            } catch (e) {
                if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
                    showToast('âš ï¸ å„²å­˜å¤±æ•—ï¼šç€è¦½å™¨ç©ºé–“å·²æ»¿ï¼');
                } else {
                    showToast('âš ï¸ å„²å­˜å¤±æ•—ï¼šè«‹æª¢æŸ¥æ‰‹æ©Ÿè¨­å®šã€‚');
                }
            }
        }

        // --- Data Loading Functions ---

        async function loadOnlineQuotes() {
            const data = await fetchAndParseCSV('1349046456');
            if (!data) return;

            const { headers, rows, parser } = data;
            const targetHeaders = ['text', 'quote', 'content', 'å…§å®¹', 'èªéŒ„', 'é‡‘å¥', 'text(æœ¬æ—¥é†ƒæ¼¬å°èª)'];
            let textIndex = headers.findIndex(h => targetHeaders.includes(h));
            if (textIndex === -1) textIndex = 0;

            dailyQuotesPool = [];
            rows.forEach(line => {
                if(!line.trim()) return;
                const cols = parser(line);
                if (cols.length > textIndex && cols[textIndex]) dailyQuotesPool.push(cols[textIndex]);
            });

            if (dailyQuotesPool.length > 0) refreshDailyWord();
        }

        async function loadSaltStatusMap() {
            const data = await fetchAndParseCSV('138033526');
            if (!data) return;

            const { headers, rows, parser } = data;
            const minIdx = headers.indexOf('min_percent');
            const maxIdx = headers.indexOf('max_percent');
            const titleIdx = headers.indexOf('status_title');
            const descIdx = headers.indexOf('status_desc');

            if (minIdx !== -1 && maxIdx !== -1 && titleIdx !== -1 && descIdx !== -1) {
                onlineSaltStatusMap = [];
                rows.forEach(line => {
                    if(!line.trim()) return;
                    const cols = parser(line);
                    const min = parseInt(cols[minIdx]);
                    const max = parseInt(cols[maxIdx]);
                    if (!isNaN(min) && !isNaN(max)) {
                        onlineSaltStatusMap.push({ min, max, title: cols[titleIdx], desc: cols[descIdx] });
                    }
                });
            }
        }

        async function loadPreservativePool() {
            // GID Updated by User Request
            const data = await fetchAndParseCSV('159897993');
            if (!data) return;

            const { headers, rows, parser } = data;
            
            let minIdx = -1, maxIdx = -1, contentIdx = -1;
            headers.forEach((h, i) => {
                if (h.includes('min')) minIdx = i;
                if (h.includes('max')) maxIdx = i;
                if (h.includes('content') || h.includes('text') || h.includes('å…§å®¹')) contentIdx = i;
            });

            // Content Sniffing Fallback
            if (minIdx === -1 && headers.length >= 3) { minIdx = 0; maxIdx = 1; contentIdx = 2; }

            if (minIdx !== -1 && maxIdx !== -1 && contentIdx !== -1) {
                onlinePreservativePool = [];
                rows.forEach(line => {
                    if(!line.trim()) return;
                    const cols = parser(line);
                    const tMin = parseInt(cols[minIdx]);
                    const tMax = parseInt(cols[maxIdx]);
                    if (!isNaN(tMin) && !isNaN(tMax) && cols[contentIdx]) {
                        onlinePreservativePool.push({ tMin, tMax, content: cols[contentIdx] });
                    }
                });
            }
        }

        async function loadFlipQuotes() {
            const data = await fetchAndParseCSV('1402400724');
            if (!data) return;

            const { headers, rows, parser } = data;
            let contentIdx = -1, sourceIdx = -1, commentIdx = -1;
            
            headers.forEach((h, i) => {
                if (h.includes('content') || h === 'text') contentIdx = i;
                if (h.includes('source')) sourceIdx = i;
                if (h.includes('comment') || h.includes('å¿ƒè²')) commentIdx = i;
            });

            if (contentIdx === -1 && headers.length >= 3) { contentIdx = 0; sourceIdx = 1; commentIdx = 2; }

            if (contentIdx !== -1) {
                onlineFlipQuotes = [];
                rows.forEach(line => {
                    if(!line.trim()) return;
                    const cols = parser(line);
                    if (cols[contentIdx]) {
                        onlineFlipQuotes.push({ 
                            text: cols[contentIdx], 
                            source: (sourceIdx !== -1) ? cols[sourceIdx] : "", 
                            comment: (commentIdx !== -1) ? cols[commentIdx] : "" 
                        });
                    }
                });
            }
        }

        async function loadPuaData() {
            const data = await fetchAndParseCSV('0');
            if (!data) { renderPuaTags(); return; } // Fallback

            const { headers, rows, parser } = data;
            let sentenceIdx = -1, transIdx = -1, defenseIdx = -1, levelIdx = -1;

            headers.forEach((h, i) => {
                if (h.includes('pua') || h.includes('sentence') || h.includes('é‡‘å¥')) sentenceIdx = i;
                if (h.includes('trans') || h.includes('ç¿»è­¯')) transIdx = i;
                if (h.includes('defense') || h.includes('åæ“Š')) defenseIdx = i;
                if (h.includes('level') || h.includes('ç­‰ç´š')) levelIdx = i;
            });

            if (sentenceIdx === -1) { sentenceIdx = 0; transIdx = 1; defenseIdx = 2; }

            if (sentenceIdx !== -1) {
                onlinePuaData = [];
                rows.forEach((line, i) => {
                    if(!line.trim()) return;
                    const cols = parser(line);
                    const sentence = cols[sentenceIdx];
                    if (sentence) {
                        let defenses = [];
                        const rawDefense = (defenseIdx !== -1) ? cols[defenseIdx] : "";
                        if (rawDefense) defenses = rawDefense.split(/[|\n]/).map(d => d.trim()).filter(d => d);
                        if (defenses.length === 0) defenses = ["(ä¿æŒå¾®ç¬‘å³å¯)"];

                        onlinePuaData.push({ 
                            key: `pua_${i}`, 
                            sentence, 
                            trans: (transIdx !== -1) ? cols[transIdx] : "", 
                            defenses,
                            level: (levelIdx !== -1) ? cols[levelIdx] : ""
                        });
                    }
                });
                renderPuaTags();
            }
        }

        async function loadShieldData() {
            const data = await fetchAndParseCSV('1087555591');
            if (!data) { renderShieldTags(); return; }

            const { headers, rows, parser } = data;
            let labelIdx = -1, optionsIdx = -1;

            headers.forEach((h, i) => {
                if (h.includes('label') || h.includes('æƒ…å¢ƒ') || h.includes('å•é¡Œ')) labelIdx = i;
                if (h.includes('options') || h.includes('å›è¦†')) optionsIdx = i;
            });

            if (labelIdx === -1) { labelIdx = 0; optionsIdx = 1; }

            if (labelIdx !== -1) {
                onlineShieldData = [];
                rows.forEach(line => {
                    if(!line.trim()) return;
                    const cols = parser(line);
                    const label = cols[labelIdx];
                    const optionsRaw = cols[optionsIdx];

                    if (label && optionsRaw) {
                        let options = optionsRaw.split(/[|\n]/).map(o => o.trim()).filter(o => o);
                        if (options.length <= 1 && optionsRaw.includes(',')) options = optionsRaw.split(',').map(o => o.trim()).filter(o => o);
                        
                        onlineShieldData.push({ label, options });
                    }
                });
                renderShieldTags();
            }
        }

        // --- Core Logic ---

        let pendingConfirmAction = null;
        function showConfirm(msg, action) {
            document.getElementById('confirm-msg').innerText = msg;
            pendingConfirmAction = action;
            document.getElementById('confirm-modal').classList.add('show');
        }
        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.remove('show');
            pendingConfirmAction = null;
        }
        document.getElementById('confirm-btn-action').onclick = function() {
            if (pendingConfirmAction) pendingConfirmAction();
            closeConfirmModal();
        };

        function renderShieldTags() {
            const container = document.getElementById('shield-tag-container');
            const resultBox = document.getElementById('shield-result');
            const resultText = document.getElementById('shield-text');
            if (!container) return;
            container.innerHTML = '';
            
            currentShieldSelection = null;
            if(resultBox) resultBox.style.opacity = 0;
            if(resultText) resultText.innerText = '';

            let sourceData = [];
            if (onlineShieldData.length > 0) {
                sourceData = [...onlineShieldData];
            } else {
                const labels = { "marriage": "ä»€éº¼æ™‚å€™è¦çµå©šï¼Ÿ", "salary": "è–ªæ°´ç¾åœ¨å¤šå°‘å•Šï¼Ÿ", "serve": "æœ€è¿‘æ€éº¼æ²’ä¾†æœäº‹ï¼Ÿ" };
                sourceData = Object.keys(shields).map(k => ({ label: labels[k] || k, options: shields[k] }));
            }

            for (let i = sourceData.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [sourceData[i], sourceData[j]] = [sourceData[j], sourceData[i]];
            }
            
            sourceData.slice(0, 7).forEach(item => {
                const tag = document.createElement('button');
                tag.className = 'shield-tag';
                tag.innerText = item.label;
                tag.onclick = () => {
                    document.querySelectorAll('.shield-tag').forEach(t => t.classList.remove('selected'));
                    tag.classList.add('selected');
                    currentShieldSelection = item;
                };
                container.appendChild(tag);
            });
        }

        function renderPuaTags() {
            const container = document.getElementById('pua-tag-container');
            const resultBox = document.getElementById('pua-result');
            if (!container) return;
            container.innerHTML = '';
            
            currentPuaSelection = null;
            if(resultBox) resultBox.style.opacity = 0;

            let sourceData = [];
            if (onlinePuaData.length > 0) {
                sourceData = [...onlinePuaData];
            } else {
                sourceData = Object.keys(puaData).map(k => ({
                    key: k, sentence: puaData[k].sentence, trans: puaData[k].trans, defenses: puaData[k].defenses, level: puaData[k].level
                }));
            }

            for (let i = sourceData.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [sourceData[i], sourceData[j]] = [sourceData[j], sourceData[i]];
            }
            
            sourceData.slice(0, 7).forEach(item => {
                const tag = document.createElement('button');
                tag.className = 'pua-tag';
                tag.innerText = item.sentence;
                tag.onclick = () => {
                    document.querySelectorAll('.pua-tag').forEach(t => t.classList.remove('selected'));
                    tag.classList.add('selected');
                    currentPuaSelection = item.key;
                };
                container.appendChild(tag);
            });
        }

        function refreshDailyWord() {
            const display = document.getElementById('daily-word');
            if (!display) return;
            
            let randomMsg = "è¼‰å…¥ä¸­...";
            if (dailyQuotesPool.length > 0) {
                randomMsg = dailyQuotesPool[Math.floor(Math.random() * dailyQuotesPool.length)];
            } else {
                randomMsg = preservativePool[Math.floor(Math.random() * preservativePool.length)].content;
            }
            
            const icon = display.querySelector('.refresh-icon');
            if(icon) {
                icon.style.transition = 'transform 0.5s';
                icon.style.transform = 'rotate(360deg)';
                setTimeout(() => { icon.style.transform = 'rotate(0deg)'; }, 500);
            }
            display.innerHTML = `<span>ğŸ’¬ æœ¬æ—¥é†ƒæ¼¬å°èªï¼š${randomMsg}</span> <span class="refresh-icon">â†»</span>`;
        }
        
        function showSection(sectionId, btnElement) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            const target = document.getElementById(sectionId);
            if (target) {
                target.classList.add('active');
                const scrollWrapper = document.getElementById('scroll-wrapper');
                if (scrollWrapper) scrollWrapper.scrollTo(0, 0); 
                resetSectionState(sectionId);
            }
            if (btnElement) {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                btnElement.classList.add('active');
            }
        }

        function resetSectionState(sectionId) {
            if (sectionId === 'pua') {
                currentPuaSelection = null;
                document.querySelectorAll('#pua-tag-container .pua-tag').forEach(t => t.classList.remove('selected'));
                const puaResult = document.getElementById('pua-result');
                if (puaResult) {
                    puaResult.style.opacity = 0;
                    setTimeout(() => {
                        document.getElementById('pua-translation').innerText = '--';
                        document.getElementById('pua-defense').innerText = '--';
                        document.getElementById('pua-level').style.display = 'none';
                    }, 200);
                }
            } else if (sectionId === 'shield') {
                currentShieldSelection = null;
                document.querySelectorAll('#shield-tag-container .shield-tag').forEach(t => t.classList.remove('selected'));
                const shieldResult = document.getElementById('shield-result');
                if (shieldResult) shieldResult.style.opacity = 0;
                const shieldText = document.getElementById('shield-text');
                if (shieldText) shieldText.innerText = '';
            }
        }

        function initData() {
            const savedBible = localStorage.getItem('biblePlan');
            let needRegenerate = false;
            if (savedBible) {
                try {
                    biblePlan = JSON.parse(savedBible);
                    if (biblePlan.length > 0 && !biblePlan[0].dateStr) needRegenerate = true;
                } catch(e) { needRegenerate = true; }
            } else { needRegenerate = true; }

            if (needRegenerate) {
                const oldStatusMap = {};
                if (biblePlan.length > 0) biblePlan.forEach((d, i) => oldStatusMap[i] = d.completed);
                biblePlan = generateBiblePlan();
                biblePlan.forEach((d, i) => { if (oldStatusMap[i]) d.completed = true; });
                saveToStorage('biblePlan', JSON.stringify(biblePlan));
            }

            const savedPrayers = localStorage.getItem('prayers');
            if (savedPrayers) { try { prayers = JSON.parse(savedPrayers); } catch(e) {} }

            const savedGoals = localStorage.getItem('goals');
            if (savedGoals) { try { goals = JSON.parse(savedGoals); } catch(e) {} }

            const savedSignals = localStorage.getItem('userSignals');
            if (savedSignals) {
                try { 
                    userSignals = JSON.parse(savedSignals); 
                    let modified = false;
                    userSignals = userSignals.map((s, idx) => {
                        if (!s.id) { s.id = Date.now() + idx; modified = true; }
                        return s;
                    });
                    if (modified) saveToStorage('userSignals', JSON.stringify(userSignals));
                } catch(e) { userSignals = []; }
            }

            yearlyKeyword = localStorage.getItem('yearlyKeyword') || '';
            
            // --- Savings Init ---
            const savedSavings = localStorage.getItem('savingsPlan');
            if (savedSavings) { try { savingsPlan = JSON.parse(savedSavings); } catch(e) { savingsPlan = new Array(366).fill(false); } }
            else { savingsPlan = new Array(366).fill(false); } // index 0 unused, 1-365

            // --- Wishlist Init ---
            const savedWishlist = localStorage.getItem('wishlist');
            if (savedWishlist) { try { wishlist = JSON.parse(savedWishlist); } catch(e) { wishlist = []; } }

            const aiEnc = document.getElementById('ai-encouragement');
            if(aiEnc) aiEnc.innerText = encouragements[Math.floor(Math.random() * encouragements.length)];
            refreshDailyWord();
            
            refreshFinancialEncouragement();
        }

        function setRandomStatus() {
            const titleEl = document.getElementById('daily-status-title');
            const descEl = document.getElementById('daily-status-desc');
            if (!titleEl || !descEl) return;
            currentSaltPercent = Math.floor(Math.random() * 101);
            
            const sourceMap = (onlineSaltStatusMap.length > 0) ? onlineSaltStatusMap : saltStatusMap;
            const status = sourceMap.find(s => currentSaltPercent >= s.min && currentSaltPercent <= s.max) || sourceMap[0];
            
            titleEl.style.opacity = 0; descEl.style.opacity = 0;
            setTimeout(() => {
                if (!status.title.includes('%')) {
                     titleEl.innerText = `å«é¹½é‡ ${currentSaltPercent}%ï¼š${status.title}`;
                } else {
                     titleEl.innerText = status.title.replace(/\d+%/, currentSaltPercent + "%");
                }
                descEl.innerText = status.desc;
                titleEl.style.opacity = 1; descEl.style.opacity = 1;
            }, 200);
            refreshDailyWord();
        }

        function getPreservative() {
            const display = document.getElementById('preservative-display');
            if (!display) return;
            const pool = (onlinePreservativePool.length > 0) ? onlinePreservativePool : preservativePool;
            const availableMsg = pool.filter(p => currentSaltPercent >= p.tMin && (p.tMax ? currentSaltPercent <= p.tMax : true));
            const finalPool = (availableMsg.length > 0) ? availableMsg : pool;
            const randomMsg = finalPool[Math.floor(Math.random() * finalPool.length)].content;
            
            display.style.opacity = 0;
            setTimeout(() => { display.innerText = `ã€Œ${randomMsg}ã€`; display.style.opacity = 1; }, 200);
        }

        function generateBiblePlan() {
            let plan = [];
            let currentBookIndex = 0;
            let currentChapter = 1;
            const currentYear = new Date().getFullYear();
            const totalBooks = bibleBooks.length;

            for (let i = 0; i < 365; i++) {
                let date = new Date(currentYear, 0, 1);
                date.setDate(date.getDate() + i);
                let month = date.getMonth() + 1;
                let day = date.getDate();
                let dateStr = `${month}/${day}`;
                
                if (currentBookIndex >= totalBooks) {
                        plan.push({ day: i + 1, dateStr: dateStr, reading: "ğŸ‰ æ­å–œè®€å®Œï¼", link: "", completed: false });
                        continue;
                }

                let chaptersToday = 0;
                let startChap = currentChapter;
                let book = bibleBooks[currentBookIndex];
                let targetChapters = ((i + 1) % 3 === 0) ? 4 : 3; 

                while (chaptersToday < targetChapters && currentBookIndex < totalBooks) {
                    currentChapter++;
                    chaptersToday++;
                    if (currentChapter > bibleBooks[currentBookIndex].chapters) {
                        currentBookIndex++;
                        if (currentBookIndex < totalBooks) currentChapter = 1;
                    }
                }
                
                let endChap = currentChapter - 1;
                let readingText = `${book.name} ${startChap}${startChap <= endChap ? (startChap !== endChap ? '-' + endChap : '') : '-çµæŸ'}ç« `;
                let link = `https://www.bible.com/bible/46/${book.code}.${startChap}.CUNP`;

                if (endChap < startChap) readingText = `${book.name} ${startChap}ç«  - æ–°æ›¸å·`; 
                
                plan.push({ day: i + 1, dateStr: dateStr, reading: readingText, link: link, completed: false, chapterCount: chaptersToday });
            }
            return plan;
        }

        function renderDevotionUI() { 
            renderBibleGrid(); renderPrayerList(); renderGoalList(); renderKeyword(); renderSignalList(); 
            // Savings & Wishlist
            renderSavingsGrid(); renderWishlist();
        }
        
        function renderBibleGrid() {
            const grid = document.getElementById('bible-grid');
            grid.innerHTML = '';
            let completedCount = 0;
            const now = new Date();
            const todayStr = `${now.getMonth() + 1}/${now.getDate()}`;
            biblePlan.forEach((day, index) => {
                if(day.completed) completedCount++;
                const div = document.createElement('div');
                const isToday = day.dateStr === todayStr;
                div.className = `day-cell ${day.completed ? 'completed' : ''} ${isToday ? 'today' : ''}`;
                div.onclick = () => openReadingModal(index);
                div.innerHTML = `<span class="day-num">${day.dateStr}</span><span class="day-read">${day.reading.split(' ')[0]}<br>${day.reading.split(' ')[1] || ''}</span>`;
                grid.appendChild(div);
                if (isToday && !window.hasScrolledToToday) window.hasScrolledToToday = true;
            });
            document.getElementById('bible-progress-text').innerText = `å®Œæˆ ${completedCount} / 365`;
            const percent = ((completedCount / 365) * 100).toFixed(1);
            const progressBar = document.getElementById('bible-progress');
            if(progressBar) progressBar.style.width = `${percent}%`;
            document.getElementById('percent-text').innerText = `${percent}% å…¥å‘³`;
            
            const todayPlan = biblePlan.find(d => d.dateStr === todayStr) || biblePlan[0];
            const scopeText = document.getElementById('plan-scope-text');
            if(scopeText) scopeText.innerHTML = `${todayPlan.reading}`;
            
            const saltStars = document.getElementById('today-salt-stars');
            if (saltStars && todayPlan) {
                const count = todayPlan.chapterCount || 0; 
                saltStars.innerText = count > 0 ? 'â­'.repeat(count) : 'â­â­â­â­â­';
            }
            const dateText = document.getElementById('current-date-text');
            if (dateText) dateText.innerText = todayStr;
        }

        function openReadingModal(index) {
            selectedDayId = index;
            const day = biblePlan[index];
            document.getElementById('modal-day').innerText = `${day.dateStr} (Day ${day.day})`; 
            document.getElementById('modal-reading').innerText = day.reading;
            document.getElementById('modal-link').href = day.link;
            document.getElementById('read-modal').classList.add('show');
        }
        function closeModal() { document.getElementById('read-modal').classList.remove('show'); }
        function confirmReading() {
            if (selectedDayId !== null) {
                biblePlan[selectedDayId].completed = true;
                saveToStorage('biblePlan', JSON.stringify(biblePlan));
                renderBibleGrid();
                closeModal();
            }
        }

        function renderPrayerList() {
            const list = document.getElementById('prayer-list');
            const searchInput = document.getElementById('prayer-search');
            const filterText = searchInput ? searchInput.value.toLowerCase() : '';
            list.innerHTML = '';
            let ongoing = 0; let answered = 0;
            prayers.forEach(p => { if(p.status === 'answered') answered++; else ongoing++; });
            document.getElementById('ongoing-count').innerText = ongoing;
            document.getElementById('answered-count').innerText = answered;
            const filteredPrayers = prayers.filter(p => {
                const date = new Date(p.startDate).toLocaleDateString();
                return p.content.toLowerCase().includes(filterText) || date.includes(filterText);
            });
            if (filteredPrayers.length === 0) { list.innerHTML = `<div style="text-align:center; color:#ccc; font-size:0.9rem; padding: 20px;">æ‰¾ä¸åˆ°ç›¸é—œç¦±å‘Š ğŸ™</div>`; return; }
            filteredPrayers.forEach((p) => {
                const div = document.createElement('div');
                div.className = `prayer-item ${p.status === 'answered' ? 'answered' : ''}`;
                const date = new Date(p.startDate).toLocaleDateString();
                let meta = `é–‹å§‹: ${date}`;
                if(p.status === 'answered') meta += ` (å·²å¯¦ç¾)`;
                div.innerHTML = `<div class="prayer-content"><div class="prayer-text" style="${p.status === 'answered' ? 'text-decoration:line-through; color:#999;' : ''}">${p.content}</div><div class="prayer-meta">${meta}</div></div><div style="display: flex; align-items: center; gap: 5px; z-index: 10;">${p.status === 'ongoing' ? `<button class="action-btn" onclick="markPrayerAnswered(${p.id})" title="æ¨™è¨˜ç‚ºå·²å¯¦ç¾">âœ”ï¸</button>` : ''}<button class="action-btn" onclick="deletePrayer(${p.id}, event)" title="åˆªé™¤">ğŸ—‘ï¸</button></div>`;
                list.prepend(div);
            });
        }

        function addPrayer() {
            const input = document.getElementById('new-prayer-input');
            if(!input.value.trim()) return;
            prayers.push({ id: Date.now(), content: input.value, startDate: new Date().toISOString(), status: 'ongoing', answeredDate: null });
            saveToStorage('prayers', JSON.stringify(prayers));
            input.value = '';
            const searchInput = document.getElementById('prayer-search');
            if(searchInput) searchInput.value = '';
            renderPrayerList();
        }
        function markPrayerAnswered(id) {
            const p = prayers.find(p => p.id === id);
            if(p) { p.status = 'answered'; p.answeredDate = new Date().toISOString(); saveToStorage('prayers', JSON.stringify(prayers)); renderPrayerList(); }
        }
        function deletePrayer(id, event) {
            if(event) event.stopPropagation();
            showConfirm("ç¢ºå®šè¦åˆªé™¤é€™å‰‡ç¦±å‘Šå—ï¼Ÿ", () => {
                prayers = prayers.filter(p => p.id !== id);
                saveToStorage('prayers', JSON.stringify(prayers));
                renderPrayerList();
                showToast("åˆªé™¤æˆåŠŸ ğŸ—‘ï¸");
            });
        }

        function renderGoalList() {
            const list = document.getElementById('goal-list');
            list.innerHTML = '';
            goals.forEach(g => {
                const div = document.createElement('div');
                div.className = `goal-item ${g.status === 'done' ? 'done' : ''}`;
                div.innerHTML = `<div class="prayer-content"><div class="prayer-text goal-text">${g.content}</div></div><div style="display:flex;"><button class="action-btn" onclick="toggleGoalStatus(${g.id})">${g.status === 'done' ? 'â†©ï¸' : 'â­•'}</button><button class="action-btn" onclick="deleteGoal(${g.id})">ğŸ—‘ï¸</button></div>`;
                list.appendChild(div);
            });
        }
        function addGoal() {
            const input = document.getElementById('new-goal-input');
            if(!input.value.trim()) return;
            goals.push({ id: Date.now(), content: input.value, status: 'todo' });
            saveToStorage('goals', JSON.stringify(goals));
            input.value = '';
            renderGoalList();
        }
        function toggleGoalStatus(id) {
            const g = goals.find(g => g.id === id);
            if(g) { g.status = g.status === 'todo' ? 'done' : 'todo'; saveToStorage('goals', JSON.stringify(goals)); renderGoalList(); }
        }
        function deleteGoal(id) {
            showConfirm("ç¢ºå®šåˆªé™¤é€™å€‹ç›®æ¨™ï¼Ÿ", () => {
                goals = goals.filter(g => g.id !== id);
                saveToStorage('goals', JSON.stringify(goals));
                renderGoalList();
                showToast("åˆªé™¤æˆåŠŸ ğŸ—‘ï¸");
            });
        }

        function renderKeyword() {
            const div = document.getElementById('keyword-display');
            if(yearlyKeyword) {
                div.innerHTML = `<div style="font-size: 2rem; font-weight: bold; color: var(--text-primary); margin-bottom: 10px;">${yearlyKeyword}</div><button onclick="clearKeyword()" style="background:none; border:none; text-decoration:underline; color:#999; cursor:pointer;">é‡ç½®</button>`;
            } else {
                div.innerHTML = `<button class="btn-primary" onclick="generateKeyword()" style="background: var(--morandi-green); margin-bottom: 15px;">âœ¨ AI éˆæ„Ÿç”Ÿæˆ</button><div style="display: flex; gap: 5px; align-items: center; justify-content: center;"><span style="font-size: 0.8rem; color: #999;">or</span></div><div style="display: flex; gap: 5px; margin-top: 10px;"><input type="text" id="manual-keyword-input" placeholder="è‡ªè¡Œè¼¸å…¥..." style="margin-bottom: 0; padding: 10px; font-size: 0.9rem;"><button onclick="saveManualKeyword()" style="background: var(--accent-blue); color: white; border: none; padding: 0 15px; border-radius: 12px; cursor: pointer;">å„²å­˜</button></div>`;
            }
        }
        function generateKeyword() { yearlyKeyword = keywords[Math.floor(Math.random() * keywords.length)]; saveToStorage('yearlyKeyword', yearlyKeyword); renderKeyword(); }
        function saveManualKeyword() {
            const input = document.getElementById('manual-keyword-input');
            if(input && input.value.trim()) { yearlyKeyword = input.value.trim(); saveToStorage('yearlyKeyword', yearlyKeyword); renderKeyword(); showToast("å¹´åº¦é—œéµå­—å·²è¨­å®š âœ¨"); } else { showToast("è«‹è¼¸å…¥é—œéµå­—"); }
        }
        function clearKeyword() { yearlyKeyword = ''; saveToStorage('yearlyKeyword', ''); renderKeyword(); }

        function renderSignalList() {
            const list = document.getElementById('signal-list');
            const searchInput = document.getElementById('signal-search');
            const filterText = searchInput ? searchInput.value.toLowerCase() : '';
            list.innerHTML = '';
            const filteredSignals = userSignals.filter(s => {
                const dateStr = new Date(s.date).toLocaleString();
                return s.content.toLowerCase().includes(filterText) || dateStr.includes(filterText);
            });
            if (filteredSignals.length === 0) { list.innerHTML = `<div style="text-align:center; color:#ccc; font-size:0.9rem; padding: 20px;">æ‰¾ä¸åˆ°ç›¸é—œç´€éŒ„ ğŸ¡</div>`; return; }
            filteredSignals.slice().reverse().forEach(s => {
                const div = document.createElement('div');
                div.className = 'signal-item';
                div.innerHTML = `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; border-bottom: 1px dashed #f0f0f0; padding-bottom: 8px; position: relative; z-index: 2;"><span class="signal-date">${new Date(s.date).toLocaleString()}</span><button class="action-btn" onclick="deleteSignal(${s.id}, event)" title="åˆªé™¤" style="padding: 4px; font-size: 0.9rem; position: relative; z-index: 100; cursor: pointer;">ğŸ—‘ï¸</button></div><div class="signal-content">${s.content.replace(/\n/g, '<br>')}</div>`;
                list.appendChild(div);
            });
        }
        function addSignal() {
            const input = document.getElementById('new-signal-input');
            if(!input.value.trim()) return;
            userSignals.push({ id: Date.now(), content: input.value, date: new Date().toISOString() });
            saveToStorage('userSignals', JSON.stringify(userSignals)); 
            input.value = '';
            const searchInput = document.getElementById('signal-search');
            if(searchInput) searchInput.value = '';
            renderSignalList();
        }
        function deleteSignal(id, event) {
            if(event) event.stopPropagation();
            id = Number(id);
            showConfirm("ç¢ºå®šè¦åˆªé™¤é€™æ¢ç´€éŒ„å—ï¼Ÿ", () => {
                userSignals = userSignals.filter(s => s.id !== id);
                saveToStorage('userSignals', JSON.stringify(userSignals));
                renderSignalList();
                showToast("åˆªé™¤æˆåŠŸ ğŸ—‘ï¸");
            });
        }

        function exportData() {
            const data = { 
                biblePlan: localStorage.getItem('biblePlan'), 
                prayers: localStorage.getItem('prayers'), 
                goals: localStorage.getItem('goals'), 
                userSignals: localStorage.getItem('userSignals'), 
                yearlyKeyword: localStorage.getItem('yearlyKeyword'),
                savingsPlan: localStorage.getItem('savingsPlan'),
                wishlist: localStorage.getItem('wishlist')
            };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `salted-fish-backup-${new Date().toISOString().slice(0,10)}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        }
        function importData(input) {
            const file = input.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.biblePlan) saveToStorage('biblePlan', data.biblePlan);
                    if (data.prayers) saveToStorage('prayers', data.prayers);
                    if (data.goals) saveToStorage('goals', data.goals);
                    if (data.userSignals) saveToStorage('userSignals', data.userSignals);
                    if (data.yearlyKeyword) saveToStorage('yearlyKeyword', data.yearlyKeyword);
                    if (data.savingsPlan) saveToStorage('savingsPlan', data.savingsPlan);
                    if (data.wishlist) saveToStorage('wishlist', data.wishlist);
                    showToast('åŒ¯å…¥æˆåŠŸï¼é é¢å°‡é‡æ–°æ•´ç†ã€‚'); setTimeout(() => location.reload(), 1500);
                } catch (err) { showToast('åŒ¯å…¥å¤±æ•—ï¼Œæª”æ¡ˆæ ¼å¼å¯èƒ½éŒ¯èª¤ã€‚'); }
            };
            reader.readAsText(file);
        }

        function switchDevotionTab(tabName) {
            const parent = document.getElementById('devotion');
            parent.querySelectorAll('.sub-section').forEach(el => el.classList.remove('active'));
            parent.querySelector(`#tab-${tabName}`).classList.add('active');
            parent.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function switchFlowTab(tabName) {
            const parent = document.getElementById('flow');
            parent.querySelectorAll('.sub-section').forEach(el => el.classList.remove('active'));
            parent.querySelector(`#tab-${tabName}`).classList.add('active');
            parent.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function flipCard() {
            const container = document.querySelector('.flip-container');
            if (!container.classList.contains('flipped')) {
                const pool = (onlineFlipQuotes.length > 0) ? onlineFlipQuotes : quotes;
                const randomQuote = pool[Math.floor(Math.random() * pool.length)];

                const contentEl = document.getElementById('quote-content');
                const sourceEl = document.getElementById('quote-source');
                const commentEl = document.getElementById('quote-comment');
                
                if (contentEl) contentEl.innerText = randomQuote.text;
                if (sourceEl) sourceEl.innerText = randomQuote.source;
                if (commentEl) {
                    let commentText = randomQuote.comment;
                    commentText = commentText.replace('(é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼š', '').replace(')', '').replace('é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼š', '').trim();
                    commentEl.innerHTML = `<strong>é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼š</strong><br>${commentText}`;
                }
                container.classList.add('flipped');
                
                // è§¸ç™¼çƒé´‰å‹•ç•«
                triggerCrow();
            } else { 
                container.classList.remove('flipped'); 
                // é‡ç½®å‹•ç•«
                resetCrow();
            }
        }

        // --- çƒé´‰å‹•ç•«é‚è¼¯ ---
        function triggerCrow() {
            const crow = document.getElementById('crow-wrapper');
            const meat = document.getElementById('crow-meat');
            if(!crow || !meat) return;

            // 1. é‡ç½®ç‹€æ…‹
            crow.classList.remove('flying');
            meat.classList.remove('dropping');
            void crow.offsetWidth; // Force reflow

            // 2. é–‹å§‹é£›è¡Œ
            crow.classList.add('flying');

            // 3. åœ¨é£›è¡Œä¸­é€” (ç´„ 40% é€²åº¦è™•ï¼Œå³ 1.6s) æ‰è½è‚‰å¡Š
            // é€™è£¡è¨­å®š 1.8s è®“å®ƒåœ¨æ‡¸åœéšæ®µæ‰è½
            setTimeout(() => {
                meat.classList.add('dropping');
                showToast('ğŸ¥© çƒé´‰ç‚ºä½ å¼ä¾†äº†æ©å…¸ï¼'); 
            }, 1800);
        }

        function resetCrow() {
            const crow = document.getElementById('crow-wrapper');
            const meat = document.getElementById('crow-meat');
            if(crow) crow.classList.remove('flying');
            if(meat) meat.classList.remove('dropping');
        }

        function detectPUA() {
            const key = currentPuaSelection;
            if (!key) { showToast("è«‹å…ˆé»é¸ä¸€å€‹é‡‘å¥æ¨™ç±¤ ğŸ·ï¸"); return; }

            const resultBox = document.getElementById('pua-result');
            const levelBadge = document.getElementById('pua-level');
            if (!resultBox) return;

            let translation = "--", defense = "--", level = "";

            if (onlinePuaData.length > 0) {
                const item = onlinePuaData.find(d => d.key === key);
                if (item) {
                    translation = item.trans;
                    defense = item.defenses[Math.floor(Math.random() * item.defenses.length)];
                    level = item.level;
                }
            } else {
                const data = puaData[key];
                if (data) {
                    translation = data.trans;
                    defense = data.defenses[Math.floor(Math.random() * data.defenses.length)];
                    level = data.level;
                }
            }

            resultBox.style.opacity = 0;
            setTimeout(() => {
                const transEl = document.getElementById('pua-translation');
                const defenseEl = document.getElementById('pua-defense');
                if (transEl) transEl.innerText = translation;
                if (defenseEl) defenseEl.innerText = defense;
                
                if (level && level.trim() !== "") {
                    levelBadge.innerText = `æ¯’æ€§ç­‰ç´š: ${level}`;
                    levelBadge.style.display = 'inline-block';
                } else {
                    levelBadge.style.display = 'none';
                }
                resultBox.style.opacity = 1;
            }, 200);
        }

        function getExcuse() {
            const resultText = document.getElementById('shield-text');
            const resultBox = document.getElementById('shield-result');
            
            if (!currentShieldSelection) { showToast("è«‹å…ˆé¸æ“‡ä¸€å€‹å•é¡Œæƒ…å¢ƒ ğŸ›¡ï¸"); return; }

            if (resultText && resultBox) {
                const opts = currentShieldSelection.options;
                if (!opts || opts.length === 0) { showToast("ä¸»å»šé‚„æ²’æƒ³åˆ°è—‰å£ ğŸ˜…"); return; }

                resultBox.style.opacity = 0;
                setTimeout(() => {
                    resultText.innerText = `ã€Œ${opts[Math.floor(Math.random() * opts.length)]}ã€`; 
                    resultBox.style.opacity = 1;
                }, 100);
            }
        }

        function copyText(id, e) {
            e.stopPropagation();
            const text = document.getElementById(id).innerText;
            const area = document.createElement("textarea"); area.value = text; document.body.appendChild(area); area.select();
            document.execCommand('copy'); document.body.removeChild(area);
            showToast('å·²æˆåŠŸè¤‡è£½åˆ°éˆé­‚æ·±è™•');
        }

        // --- Savings Logic ---
        function renderSavingsGrid() {
            const grid = document.getElementById('savings-grid');
            if(!grid) return;
            grid.innerHTML = '';
            
            let totalSaved = 0;
            for (let i = 1; i <= 365; i++) {
                const saved = savingsPlan[i];
                if (saved) totalSaved += i;
                
                const cell = document.createElement('div');
                cell.className = `savings-cell ${saved ? 'saved' : ''}`;
                cell.innerText = i;
                cell.onclick = () => confirmSave(i);
                grid.appendChild(cell);
            }
            document.getElementById('savings-total').innerText = `$${totalSaved.toLocaleString()}`;
        }

        function confirmSave(amount) {
            const isSaved = savingsPlan[amount];
            const msg = isSaved ? `è¦å–æ¶ˆå­˜å…¥ $${amount} å—ï¼Ÿ` : `ç¢ºå®šä»Šå¤©è¦å­˜ $${amount} å—ï¼Ÿ\n(åˆ¥å¿˜äº†æŠŠéŒ¢çœŸçš„å­˜èµ·ä¾†å–”)`;
            
            showConfirm(msg, () => {
                savingsPlan[amount] = !isSaved;
                saveToStorage('savingsPlan', JSON.stringify(savingsPlan));
                renderSavingsGrid();
                
                if (!isSaved) { // If act was saving
                    let currentTotal = savingsPlan.reduce((acc, val, idx) => val ? acc + idx : acc, 0);
                    showToast(`ğŸ’° å­˜å…¥æˆåŠŸï¼è·é›¢ç›®æ¨™åˆæ¥è¿‘äº† $${amount}ï¼Œç´¯è¨ˆ $${currentTotal.toLocaleString()}`);
                }
            });
        }

        // --- Wishlist Logic ---
        function renderWishlist() {
            const list = document.getElementById('wish-list');
            if(!list) return;
            list.innerHTML = '';
            
            if(wishlist.length === 0) {
                list.innerHTML = `<div style="text-align:center; color:#ccc; font-size:0.9rem; padding: 20px;">é‚„æ²’æœ‰è¨±é¡˜å–” âœ¨</div>`;
                return;
            }

            wishlist.forEach((w) => {
                const div = document.createElement('div');
                div.className = `wish-item ${w.fulfilled ? 'fulfilled' : ''}`;
                div.innerHTML = `
                    <div class="wish-content">
                        <div class="wish-text">${w.content}</div>
                        <div class="wish-meta">$${w.cost ? parseInt(w.cost).toLocaleString() : '--'}</div>
                    </div>
                    <div style="display:flex;">
                        <button class="action-btn" onclick="toggleWishStatus(${w.id})" title="${w.fulfilled ? 'æœªé”æˆ' : 'å·²é”æˆ'}">${w.fulfilled ? 'â†©ï¸' : 'ğŸ'}</button>
                        <button class="action-btn" onclick="deleteWish(${w.id})" title="åˆªé™¤">ğŸ—‘ï¸</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function addWish() {
            const input = document.getElementById('new-wish-input');
            const costInput = document.getElementById('new-wish-cost');
            
            if(!input.value.trim()) return;
            
            wishlist.push({ 
                id: Date.now(), 
                content: input.value.trim(), 
                cost: costInput.value, 
                fulfilled: false 
            });
            saveToStorage('wishlist', JSON.stringify(wishlist));
            
            input.value = '';
            costInput.value = '';
            renderWishlist();
            showToast("é¡˜æœ›å·²æ”¾å…¥å£è¢‹åå–®ä¸¦å„²å­˜ âœ¨");
        }

        function toggleWishStatus(id) {
            const w = wishlist.find(item => item.id === id);
            if(w) { 
                w.fulfilled = !w.fulfilled; 
                saveToStorage('wishlist', JSON.stringify(wishlist)); 
                renderWishlist(); 
            }
        }

        function deleteWish(id) {
            showConfirm("ç¢ºå®šåˆªé™¤é€™å€‹é¡˜æœ›ï¼Ÿ", () => {
                wishlist = wishlist.filter(item => item.id !== id);
                saveToStorage('wishlist', JSON.stringify(wishlist));
                renderWishlist();
                showToast("é¡˜æœ›å·²åˆªé™¤ ğŸ—‘ï¸");
            });
        }

        function refreshFinancialEncouragement() {
            const el = document.getElementById('financial-encouragement');
            if(el) {
                el.innerText = financialEncouragements[Math.floor(Math.random() * financialEncouragements.length)];
            }
        }

        // --- PUA & Toggle Test ---
        function togglePuaTest() {
            const area = document.getElementById('pua-test-area');
            area.style.display = (area.style.display === 'none' || area.style.display === '') ? 'block' : 'none';
            if(area.style.display === 'block') initPuaTest();
        }

        function initPuaTest() {
            const list = document.getElementById('test-list');
            if (!list) return;
            list.innerHTML = '';
            const shuffled = [...fullChecklistItems].sort(() => 0.5 - Math.random());
            shuffled.slice(0, 7).forEach((item) => {
                const div = document.createElement('div');
                div.style.marginBottom = "10px";
                div.style.cursor = "pointer";
                div.innerHTML = `<input type="checkbox" style="margin-right:8px;"> <span>${item}</span>`;
                div.onclick = function(e) { if(e.target.tagName !== 'INPUT'){ const cb = this.querySelector('input'); cb.checked = !cb.checked; } };
                list.appendChild(div);
            });
        }

        function runPuaTest() {
            const count = document.querySelectorAll('#test-list input:checked').length;
            const resultDiv = document.getElementById('test-result');
            if (!resultDiv) return;
            resultDiv.style.display = 'block';
            let msg = count <= 2 ? "è¨ºæ–·ï¼šè¼•å¾®æ“¦å‚·ã€‚å¤šçœ‹é¹¹é­šèªéŒ„å³å¯ã€‚" : count <= 5 ? "è¨ºæ–·ï¼šä¸­æ¯’åæ·±ã€‚å»ºè­°é–‹å•Ÿ PUA é£›è¡Œæ¨¡å¼ã€‚" : "è­¦å‘Šï¼šé‡åº¦å—ç½æˆ¶ï¼å»ºè­°ç«‹åˆ»å•Ÿå‹•ä¸€éµèººå¹³ï¼";
            resultDiv.innerText = msg;
            resultDiv.style.background = "#F3EAF5";
            resultDiv.style.padding = "15px";
            resultDiv.style.borderRadius = "10px";
            resultDiv.style.textAlign = "center";
            resultDiv.style.fontWeight = "bold";
        }

        // æ–°å¢ï¼šå°‡ç¿»è½‰å¡ç‰‡å…§å®¹å­˜ç‚ºåœ–ç‰‡ (è§£æ±º 3D ç¿»è½‰æˆªåœ–å•é¡Œ)
        function saveCardImage(e) {
            e.stopPropagation();
            showToast('ğŸ‘¨â€ğŸ³ æ­£åœ¨ç‚ºæ‚¨æ‰“åŒ…ç‰¹é¤åœ–å¡...');

            // 1. å–å¾—ç•¶å‰å…§å®¹
            const content = document.getElementById('quote-content').innerText;
            const source = document.getElementById('quote-source').innerText;
            const commentHTML = document.getElementById('quote-comment').innerHTML;

            // 2. å‰µå»ºä¸€å€‹è‡¨æ™‚çš„å…‹éš†å¡ç‰‡ (é¿å… 3D æ—‹è½‰é€ æˆçš„æˆªåœ–ç©ºç™½)
            // é€™å€‹å¡ç‰‡æœƒè¢«æ”¾åœ¨è¢å¹•å¤–æˆ–éš±è—ï¼Œå°ˆé–€ç”¨ä¾†æ‹ç…§
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'fixed';
            
            // ä¿®æ­£ï¼šé‡å°æ‰‹æ©Ÿè£ç½®ï¼Œé¿å…åº§æ¨™éå¤§å°è‡´æ¸²æŸ“å¤±æ•—ï¼Œæ”¹ç”¨å·¦ä¸Šè§’ä¸¦ç”¨ z-index éš±è—
            tempContainer.style.top = '0';
            tempContainer.style.left = '0';
            tempContainer.style.zIndex = '-9999';
            tempContainer.style.width = '350px'; // å›ºå®šå¯¬åº¦ï¼Œç¢ºä¿æ’ç‰ˆå¥½çœ‹
            
            // è¤‡è£½ .back çš„æ¨£å¼
            const cardHTML = `
                <div style="
                    background: #FDFBF7; 
                    border: 2px solid var(--accent-blue); 
                    border-radius: 24px; 
                    padding: 40px 30px; 
                    display: flex; 
                    flex-direction: column; 
                    align-items: center; 
                    justify-content: center; 
                    text-align: center;
                    font-family: 'Noto Sans TC', sans-serif;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                ">
                    <p style="
                        font-family: 'Noto Serif TC', serif; 
                        font-size: 1.4rem; 
                        margin-bottom: 20px; 
                        color: #5A524C; 
                        line-height: 1.6;
                    ">${content}</p>
                    <p style="
                        color: #9E9791; 
                        font-size: 0.9rem; 
                        font-weight: 500; 
                        margin-bottom: 30px;
                    ">â€”â€” ${source}</p>
                    <div style="
                        font-size: 0.95rem; 
                        color: #7CA1B3; 
                        font-style: italic; 
                        margin-top: 20px; 
                        padding-top: 15px; 
                        border-top: 1px dashed #eee; 
                        width: 100%;
                    ">
                        ${commentHTML}
                    </div>
                    <div style="
                        margin-top: 30px; 
                        font-size: 0.75rem; 
                        color: #D4B483; 
                        letter-spacing: 2px;
                    ">æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´» | Wise Salted Fish Life</div>
                </div>
            `;
            
            tempContainer.innerHTML = cardHTML;
            document.body.appendChild(tempContainer);

            // 3. ä½¿ç”¨ html2canvas æˆªåœ–
            html2canvas(tempContainer.firstElementChild, {
                scale: 2, // æé«˜è§£æåº¦
                backgroundColor: null, // é€æ˜èƒŒæ™¯
                useCORS: true // å…è¨±è·¨åŸŸåœ–ç‰‡
            }).then(canvas => {
                // 4. ä¸‹è¼‰åœ–ç‰‡
                const link = document.createElement('a');
                link.download = `salted-fish-special-meal-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // 5. æ¸…ç†ç¾å ´
                document.body.removeChild(tempContainer);
                showToast('âœ… ç‰¹é¤å·²æ‰“åŒ…å®Œæˆï¼(å·²å„²å­˜åœ–ç‰‡)');
            }).catch(err => {
                console.error(err);
                if(document.body.contains(tempContainer)) {
                    document.body.removeChild(tempContainer);
                }
                showToast('âš ï¸ æ‰“åŒ…å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            });
        }

        // --- Move initialization logic to bottom to ensure functions are defined ---
        window.onload = function() {
            generateAppIcons(); // æ–°å¢ï¼šå•Ÿå‹•æ™‚è‡ªå‹•ç”Ÿæˆ PNG åœ–ç¤º
            initData();
            loadOnlineQuotes();
            loadPreservativePool();
            loadFlipQuotes();
            loadPuaData();
            // loadDecisionData(); // Removed for savings plan
            loadShieldData();
            loadSaltStatusMap().then(() => setRandomStatus()); 
            renderDevotionUI();
        };
    </script>
</body>
</html>