<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´» | Wise Salted Fish Life</title>
    <meta name="description" content="ä¸€å€‹çµ¦åŸºç£å¾’çš„è¼•é¬†éˆä¿®èˆ‡ç”Ÿæ´»å°å·¥å…·ï¼Œæ‹’çµ•å±¬éˆç„¦æ…®ï¼Œå¿«æ¨‚åšé¹¹é­šã€‚">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'm-brown': '#A68C76',
                        'm-brown-light': '#F2EBE5',
                        'm-green': '#8DA399',
                        'm-blue': '#8F9EAC',
                        'm-rose': '#C8A8A4',
                        'text-main': '#5E5A54',
                        'bg-cream': '#FDFCF8'
                    }
                }
            },
            corePlugins: {
                preflight: true, 
            }
        }
    </script>

    <!-- PWA / Icons -->
    <link rel="icon" id="favicon-link" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' rx='40' fill='%237CA1B3'/%3E%3Cellipse cx='100' cy='50' rx='60' ry='10' fill='none' stroke='%23D4B483' stroke-width='6'/%3E%3Cpath d='M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z' fill='%23FFFFFF'/%3E%3Cpath d='M180 130 L 200 110 L 200 150 Z' fill='%23FFFFFF'/%3E%3Cellipse cx='60' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cellipse cx='140' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cg stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'%3E%3Cline x1='75' y1='112' x2='75' y2='128'/%3E%3Cline x1='69' y1='118' x2='81' y2='118'/%3E%3Cline x1='125' y1='112' x2='125' y2='128'/%3E%3Cline x1='119' y1='118' x2='131' y2='118'/%3E%3C/g%3E%3Cline x1='95' y1='145' x2='105' y2='145' stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'/%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="apple-touch-icon" id="apple-icon-link" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%237CA1B3'/%3E%3Cellipse cx='100' cy='50' rx='60' ry='10' fill='none' stroke='%23D4B483' stroke-width='6'/%3E%3Cpath d='M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z' fill='%23FFFFFF'/%3E%3Cpath d='M180 130 L 200 110 L 200 150 Z' fill='%23FFFFFF'/%3E%3Cellipse cx='60' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cellipse cx='140' cy='135' rx='10' ry='6' fill='%23FFAB91' opacity='0.8'/%3E%3Cg stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'%3E%3Cline x1='75' y1='112' x2='75' y2='128'/%3E%3Cline x1='69' y1='118' x2='81' y2='118'/%3E%3Cline x1='125' y1='112' x2='125' y2='128'/%3E%3Cline x1='119' y1='118' x2='131' y2='118'/%3E%3C/g%3E%3Cline x1='95' y1='145' x2='105' y2='145' stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'/%3E%3C/svg%3E">
    <link rel="manifest" href="manifest.json" id="manifest-placeholder">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#FDFCF8">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <style>
        /* --- åŸæœ¬ App çš„æ ¸å¿ƒæ¨£å¼ (ä¿ç•™) --- */
        :root {
            --bg-color: #FDFCF8;
            --card-bg: #FFFFFF;
            --text-primary: #5A524C;
            --text-secondary: #9E9791;
            --accent-blue: #7CA1B3;
            --accent-blue-light: #E8F1F5; 
            --accent-gold: #D4B483;
            --accent-warning: #D98E73;
            --accent-green: #8FB3A3;
            --accent-purple: #B5A3BE;
            --accent-purple-light: #F3EAF5;
            --border-color: #F0EAE4;
            --shadow-soft: 0 10px 40px -10px rgba(90, 82, 76, 0.08);
            --radius-main: 24px;
            --radius-btn: 12px;
            --morandi-green: #8DA399;
            --morandi-pink: #D4A5A5;
            --morandi-bg-gray: #F7F7F7;
            --savings-saved-bg: #5A7D8F; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        /* Tailwind Preflight Fixes: æ¢å¾©è¢« Tailwind é‡ç½®çš„æ¨™é¡Œæ¨£å¼ */
        h1, h2, h3, h4, h5, h6 { font-size: revert; font-weight: revert; }
        button { background-color: transparent; } /* Reset button for Tailwind but keep defaults */

        html, body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.7;
            height: 100vh; height: 100dvh; width: 100vw;
            overflow: hidden;
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%235a524c' fill-opacity='0.03'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z'/%3E%3C/g%3E%3C/svg%3E");
        }

        #scroll-wrapper { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden; 
            -webkit-overflow-scrolling: touch; 
            width: 100%; 
            height: 100%; 
            position: relative; 
            scroll-behavior: smooth; 
            padding-bottom: 100px; 
        }

        header { text-align: center; padding: 50px 20px 30px; }
        .main-title { font-family: 'Noto Serif TC', serif; font-size: 2rem; font-weight: 700; color: var(--text-primary); letter-spacing: 0.05em; margin-bottom: 6px; }
        .subtitle { font-family: 'Noto Sans TC', sans-serif; font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.2em; }
        
        /* é è¨­å®¹å™¨å¯¬åº¦é™åˆ¶ - åƒ…åœ¨ééˆä¿®æ¨¡å¼æ™‚ä½¿ç”¨ */
        main.container-limited { padding: 0 20px; max-width: 500px; margin: 0 auto; width: 100%; display: flex; flex-direction: column; }
        /* éˆä¿®æ¨¡å¼æ™‚ä½¿ç”¨å…¨å¯¬ */
        main.container-full { width: 100%; height: 100%; padding: 0; overflow: hidden; display: flex; flex-direction: column; }

        .card { background: var(--card-bg); border-radius: var(--radius-main); padding: 30px; box-shadow: var(--shadow-soft); text-align: center; margin-bottom: 25px; border: 1px solid var(--border-color); transition: transform 0.3s ease; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, transparent, var(--accent-blue), transparent); opacity: 0.5; }

        .mascot-container { width: 140px; height: 140px; margin: 0 auto 20px; position: relative; }
        .mascot-svg { width: 100%; height: 100%; animation: float 3.5s ease-in-out infinite; filter: drop-shadow(0 10px 15px rgba(124, 161, 179, 0.3)); }
        .halo { transform-origin: center; animation: halo-glow 3s ease-in-out infinite alternate; }
        .eye { transform-origin: center; animation: blink 4s infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-8px) rotate(1deg); } }
        @keyframes halo-glow { 0% { opacity: 0.6; stroke-width: 2px; } 100% { opacity: 1; stroke-width: 3px; } }
        @keyframes blink { 0%, 48%, 52%, 100% { transform: scaleY(1); } 50% { transform: scaleY(0.1); } }

        /* General UI Elements */
        h2 { font-family: 'Noto Serif TC', serif; font-size: 1.4rem; color: var(--text-primary); margin-bottom: 15px; }
        p { color: var(--text-primary); font-weight: 300; }
        .text-muted { color: var(--text-secondary); font-size: 0.9rem; }
        
        .btn-primary { background: var(--text-primary); color: white; border: none; padding: 14px 30px; border-radius: 50px; font-size: 1rem; cursor: pointer; font-weight: 500; width: 100%; transition: all 0.2s ease; box-shadow: 0 4px 15px rgba(90, 82, 76, 0.2); }
        .btn-primary:active { transform: scale(0.97); }
        .btn-icon { background: transparent; border: none; cursor: pointer; padding: 8px; color: var(--accent-blue); transition: transform 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .btn-icon:hover { background-color: var(--accent-blue-light); border-radius: 50%; }

        .preservative-btn { background: white; border: 1px solid var(--accent-green); color: var(--accent-green); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; margin-bottom: 15px; display: inline-flex; align-items: center; gap: 5px; transition: all 0.2s; }
        .preservative-box { font-family: 'Noto Serif TC', serif; font-size: 1rem; color: var(--text-primary); min-height: 40px; margin-bottom: 15px; font-style: italic; opacity: 0; transition: opacity 0.5s; }

        .bible-plan-panel { margin-top: 25px; padding-top: 20px; border-top: 1px dashed var(--border-color); text-align: left; }
        .panel-desc { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 15px; font-weight: 400; font-style: italic; line-height: 1.6; }
        .progress-bar-bg { background: #eee; border-radius: 10px; height: 16px; overflow: hidden; width: 100%; margin-bottom: 10px; position: relative; }
        .progress-bar-fill { background: linear-gradient(90deg, var(--accent-blue), #A3C4BC); height: 100%; width: 0%; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); border-radius: 10px; }
        .progress-info { background: #FAFAFA; padding: 15px; border-radius: 15px; border: 1px solid var(--border-color); margin-bottom: 15px; }
        .progress-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-primary); }
        
        .progress-quote { font-size: 0.9rem; color: var(--accent-blue); font-style: italic; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee; display: flex; align-items: flex-start; gap: 5px; cursor: pointer; transition: color 0.2s; }
        .progress-quote:hover { color: var(--accent-green); }
        .refresh-icon { font-size: 1.1rem; opacity: 0.7; margin-top: 1px; margin-left: 5px; }

        .check-in-btn { background: var(--accent-blue); color: white; border: none; padding: 10px 0; border-radius: 30px; font-size: 0.9rem; cursor: pointer; width: 100%; box-shadow: 0 4px 10px rgba(124, 161, 179, 0.3); transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .check-in-btn.checked { background: var(--accent-green); cursor: default; }

        /* --- Devotion Section Specifics (NEW JOURNAL UI) --- */
        /* æ–‡é’é¢¨æ¨™é¡Œèˆ‡ç¶“æ–‡å°ˆç”¨å­—é«” */
        .serif-font, .bible-text { font-family: 'Noto Serif TC', serif; }
        .bible-text { line-height: 2.2; font-size: 1.15rem; letter-spacing: 0.05em; }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢ - æ¥µç°¡ç´°ç·š */
        .journal-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
        .journal-scroll::-webkit-scrollbar-track { background: transparent; }
        .journal-scroll::-webkit-scrollbar-thumb { background-color: #D6D0C8; border-radius: 10px; }
        .journal-scroll::-webkit-scrollbar-thumb:hover { background-color: #A68C76; }

        /* è¼‰å…¥å‹•ç•« */
        .loader { border: 2px solid #F2EBE5; border-top: 2px solid #A68C76; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* å¿ƒæƒ…é¸æ“‡å™¨æ¨£å¼ */
        .mood-btn.active { transform: scale(1.25); opacity: 1; filter: grayscale(0%) drop-shadow(0 2px 4px rgba(166, 140, 118, 0.2)); background-color: #fff; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .mood-btn { opacity: 0.6; filter: grayscale(80%); transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .mood-btn:hover { opacity: 1; filter: grayscale(0%); transform: scale(1.1); background-color: #fff; }

        /* Other App Sections */
        .flip-container { perspective: 1000px; width: 100%; height: 340px; cursor: pointer; }
        .flipper { position: relative; width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
        .flip-container.flipped .flipper { transform: rotateY(180deg); }
        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: var(--radius-main); box-shadow: var(--shadow-soft); background: var(--card-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; border: 1px solid var(--border-color); }
        .back { transform: rotateY(180deg); background: #FDFBF7; border: 2px solid var(--accent-blue); }
        .quote-content { font-family: 'Noto Serif TC', serif; font-size: 1.25rem; margin-bottom: 20px; color: var(--text-primary); line-height: 1.6; text-align: center; }
        .result-box { background: var(--accent-blue-light); border-radius: var(--radius-btn); padding: 25px; margin-top: 20px; margin-bottom: 10px; min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; opacity: 0; transition: all 0.5s ease; border: 1px solid var(--border-color); color: var(--text-primary); font-family: 'Noto Serif TC', serif; font-size: 1.1rem; position: relative; overflow: hidden; }
        .pua-result-box { background: #F8F5FA; border: 1px solid var(--accent-purple); border-radius: var(--radius-btn); padding: 20px; margin-top: 20px; text-align: left; opacity: 0; transition: opacity 0.5s; }
        .pua-label { font-size: 0.8rem; color: var(--accent-purple); font-weight: bold; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 1px; }
        .pua-content { font-size: 1rem; color: var(--text-primary); margin-bottom: 15px; line-height: 1.5; }
        .pua-level-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 12px; background-color: #F3EAF5; color: var(--accent-purple); font-weight: bold; display: none; border: 1px solid rgba(181, 163, 190, 0.3); }
        
        /* Other specific components */
        .tab-switcher { display: flex; background: #F2F2F2; padding: 5px; border-radius: 50px; margin-bottom: 25px; gap: 2px; }
        .tab-btn { flex: 1; border: none; background: transparent; padding: 10px 5px; border-radius: 40px; color: var(--text-secondary); cursor: pointer; font-size: 0.85rem; transition: all 0.3s; font-weight: 500; white-space: nowrap;}
        .tab-btn.active { background: white; color: var(--text-primary); shadow: 0 2px 5px rgba(0,0,0,0.05); font-weight: bold; }
        .sub-section { display: none; animation: fadeIn 0.3s ease; }
        .sub-section.active { display: block; }
        .savings-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-bottom: 20px; }
        .savings-cell { aspect-ratio: 1; border: 1px solid var(--border-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; background: white; transition: all 0.2s; color: var(--text-secondary); }
        .savings-cell.saved { background-color: var(--savings-saved-bg); color: white; border-color: var(--savings-saved-bg); font-weight: bold; }
        .savings-cell:active { transform: scale(0.9); }
        .ai-encourage-box { background: rgba(255,255,255,0.7); border: 1px dashed var(--accent-blue); padding: 15px; border-radius: 15px; margin-top: 20px; font-size: 0.9rem; color: var(--text-primary); text-align: center; font-family: 'Noto Serif TC', serif; font-style: italic; }
        
        .pua-tags-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .pua-tag-container, .decision-tag-container, .shield-tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .pua-tag, .decision-tag, .shield-tag { background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 20px; padding: 8px 16px; font-size: 0.9rem; color: var(--text-primary); cursor: pointer; transition: all 0.2s; user-select: none; }
        .pua-tag:hover, .decision-tag:hover, .shield-tag:hover { background-color: #e0e0e0; }
        .pua-tag.selected { background-color: var(--accent-purple); color: white; border-color: var(--accent-purple); box-shadow: 0 4px 10px rgba(181, 163, 190, 0.4); }
        .decision-tag.selected { background-color: var(--accent-blue); color: white; border-color: var(--accent-blue); box-shadow: 0 4px 10px rgba(124, 161, 179, 0.4); }
        .shield-tag.selected { background-color: var(--accent-warning); color: white; border-color: var(--accent-warning); box-shadow: 0 4px 10px rgba(217, 142, 115, 0.4); }
        .refresh-pua-btn, .refresh-decision-btn, .refresh-shield-btn { background: transparent; padding: 4px 12px; border-radius: 15px; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; border: 1px solid currentColor; }
        .refresh-pua-btn { color: var(--accent-purple); } .refresh-decision-btn { color: var(--accent-blue); } .refresh-shield-btn { color: var(--accent-warning); }
        
        .feedback-section { margin-top: 60px; padding-top: 20px; border-top: 1px dashed var(--border-color); text-align: center; }
        .feedback-text { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 15px; }
        .btn-line { background-color: transparent; color: var(--accent-purple); border: 1px solid var(--accent-purple); padding: 10px 20px; border-radius: 50px; font-size: 0.9rem; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease; font-weight: 500; }
        .btn-line:hover { background-color: var(--accent-purple); color: white; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); backdrop-filter: blur(3px); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-content { background: white; width: 85%; max-width: 350px; padding: 30px; border-radius: 30px; text-align: center; transform: scale(0.9); transition: transform 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.1); max-height: 85vh; overflow-y: auto; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        
        /* Help Modal Specifics */
        #help-modal .modal-content { max-width: 600px; text-align: left; }
        #help-modal h2 { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 1rem; border-bottom: 2px solid var(--accent-blue); padding-bottom: 0.5rem; font-family: 'Noto Serif TC', serif; }
        #help-modal h3 { font-size: 1.1rem; font-weight: 600; color: var(--accent-blue); margin-top: 1.5rem; margin-bottom: 0.5rem; }
        #help-modal h4 { font-size: 1rem; font-weight: 600; color: var(--text-primary); margin-top: 1rem; margin-bottom: 0.25rem; }
        #help-modal p, #help-modal li { font-size: 0.95rem; color: var(--text-primary); line-height: 1.6; margin-bottom: 0.5rem; }
        #help-modal ul { list-style-type: disc; padding-left: 1.5rem; }
        #help-modal strong { color: #A68C76; }

        footer { text-align: center; font-size: 0.75rem; color: #CCC; padding-bottom: 90px; padding-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px; border-top: 1px dashed var(--border-color); margin-top: 20px; width: 90%; margin-left: auto; margin-right: auto; }
        .social-links, .contact-links { display: flex; justify-content: center; align-items: center; gap: 20px; }
        .contact-section { display: flex; flex-direction: column; align-items: center; gap: 8px; margin-top: 5px; }
        .icon-link { color: var(--text-secondary); transition: color 0.3s, transform 0.2s; display: flex; align-items: center; justify-content: center; }
        .icon-link:hover { color: var(--accent-blue); transform: translateY(-2px); }
        .icon-link svg { width: 24px; height: 24px; }
        .contact-label { font-size: 0.8rem; color: var(--text-secondary); font-weight: 500; letter-spacing: 1px; }
        .ai-note { font-size: 0.7rem; color: #9E9791; margin-bottom: 8px; font-style: italic; }

        .bottom-nav { position: fixed; bottom: 20px; bottom: calc(20px + env(safe-area-inset-bottom)); left: 50%; transform: translateX(-50%); background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); padding: 8px 4px; border-radius: 50px; display: flex; gap: 2px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); z-index: 99999; width: 98%; max-width: 460px; justify-content: space-between; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .nav-item { padding: 8px 2px; flex: 1 0 auto; border-radius: 40px; border: none; background: transparent; color: var(--text-secondary); font-size: 0.7rem; font-weight: 500; cursor: pointer; transition: all 0.3s; white-space: nowrap; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; min-width: 50px; }
        .nav-item.active { background: var(--text-primary); color: white; font-weight: bold; }
        .nav-item svg { width: 20px; height: 20px; margin-bottom: 2px; }
        .bottom-nav::-webkit-scrollbar { display: none; }
        .bottom-nav { -ms-overflow-style: none; scrollbar-width: none; }
        
        .section { display: none; animation: fadeIn 0.4s ease forwards; flex: 1; }
        .section.active { display: flex; flex-direction: column; } /* Adjusted for flex layouts */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: rgba(90, 82, 76, 0.9); color: white; padding: 10px 20px; border-radius: 50px; font-size: 0.9rem; z-index: 2005; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px; }
        .toast.show { transform: translateX(-50%) translateY(0); }
        .global-footer-quote { text-align: center; font-size: 0.85rem; color: #D1D1D1; padding: 20px 20px 40px; line-height: 2; letter-spacing: 0.05em; font-style: italic; width: 100%; pointer-events: none; }
        
        /* éš±è— App Shell æ¨™é ­ï¼Œç•¶è™•æ–¼éˆä¿®æ¨¡å¼æ™‚ (å› ç‚ºæœ‰è‡ªå·±çš„ Header) */
        body.devotion-mode header { display: none; }
        body.devotion-mode .global-footer-quote { display: none; }
        /* éˆä¿®æ¨¡å¼ä¸‹ Main éœ€è¦å…¨å¯¬ */
        body.devotion-mode #app-main { padding: 0; max-width: 100%; height: 100%; overflow: hidden; }
        body.devotion-mode #scroll-wrapper { overflow: hidden; } /* ç¦æ­¢å¤–å±¤æ²å‹•ï¼Œæ”¹ç”¨å…§éƒ¨æ²å‹• */
        
        /* è¼¸å…¥æ¡† placeholder é¡è‰²ä¿®æ­£ */
        input::placeholder, textarea::placeholder { color: #D6D0C8; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <!-- å…§éƒ¨æ²å‹•å®¹å™¨ (App Shell) -->
    <div id="scroll-wrapper">
        <header>
            <h1 class="main-title">æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´»</h1>
            <div class="subtitle">Wise Salted Fish Life</div>
            <!-- Move Banner Here -->
            <div onclick="showHelpModal()" class="mt-4 inline-block px-4 py-2 bg-[#F9F7F5] border border-[#EBE6DE] rounded-lg cursor-pointer hover:bg-[#F2EBE5] transition-colors shadow-sm">
                <p class="text-xs text-[#94908A] hover:text-[#A68C76] tracking-widest flex items-center justify-center gap-1">
                    <span class="animate-pulse">âš ï¸</span> æŠ•è³‡å¤©åœ‹ç©©è³ºä¸è³ ï¼Œé†ƒæ¼¬å‰è«‹è©³é–±å…¬é–‹èªªæ˜æ›¸
                </p>
            </div>
        </header>

        <main id="app-main" class="container-limited">
            <!-- é¦–é  -->
            <section id="home" class="section active">
                <div class="card">
                    
                    <div style="position: absolute; top: 20px; right: 20px; background: var(--accent-blue); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem;">é¹¹é­šé¹½åº¦ç›£æ¸¬ä¸­</div>
                    <div class="mascot-container">
                        <svg class="mascot-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <ellipse class="halo" cx="100" cy="50" rx="60" ry="10" fill="none" stroke='%23D4B483' stroke-width='6' />
                            <path d="M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z" fill="#7CA1B3" />
                            <path d="M180 130 L 200 110 L 200 150 Z" fill="#7CA1B3" />
                            <ellipse cx="60" cy="135" rx="10" ry="6" fill="#FFAB91" opacity="0.7" />
                            <ellipse cx="140" cy="135" rx="10" ry="6" fill="#FFAB91" opacity="0.7" />
                            <g class="eye">
                                <line x1="75" y1="112" x2="75" y2="128" stroke="white" stroke-width="3" stroke-linecap="round"/><line x1="69" y1="118" x2="81" y2="118" stroke="white" stroke-width="3" stroke-linecap="round"/>
                                <line x1="125" y1="112" x2="125" y2="128" stroke="white" stroke-width="3" stroke-linecap="round"/><line x1="119" y1="118" x2="131" y2="118" stroke="white" stroke-width="3" stroke-linecap="round"/>
                            </g>
                            <line x1="95" y1="145" x2="105" y2="145" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h2 id="daily-status-title">é¹¹é­šé¹½åº¦æ¢æ¸¬ä¸­...</h2>
                    <p id="daily-status-desc" class="text-muted" style="margin-bottom: 15px;">è«‹ä¿æŒå‘¼å¸ï¼Œæ­£åœ¨è¨ˆç®—ä½ èˆ‡å¤©åœ‹çš„è·é›¢...</p>
                    <div style="margin-bottom: 20px;">
                        <button class="preservative-btn" onclick="getPreservative()">âš ï¸ é ˜å–å±¬éˆé˜²è…åŠ‘ (æ€¥æ•‘ç”¨)</button>
                        <div id="preservative-display" class="preservative-box"></div>
                    </div>
                    <!-- ä¿®æ”¹æŒ‰éˆ•æ–‡å­—ç‚º åˆ·æ–°ä»Šæ—¥å°èª -->
                    <button class="btn-icon" onclick="refreshDailyWord()">ğŸ”„ åˆ·æ–°ä»Šæ—¥å°èª</button>
                    <div class="bible-plan-panel">
                        <h3 style="font-family:'Noto Serif TC'; font-size:1.1rem; margin-bottom:5px;">é¹¹é­šé†ƒæ¼¬ä¸­</h3>
                        <p class="panel-desc">ã€Œç«‹å¿—åšä¸€æ¢ç”¨è–ç¶“é†ƒæ¼¬çš„é¹¹é­šï¼æ¯å¤©æ’’é»é¹½ï¼ˆè®€ç¶“ï¼‰ï¼Œç”Ÿæ´»æœƒæ›´é¦™å–”ã€‚ã€</p>
                        <div class="progress-bar-bg"><div id="bible-progress" class="progress-bar-fill"></div></div>
                        <div class="progress-info">
                            <div class="progress-row">
                                <span style="display: flex; align-items: center; gap: 5px;">ğŸ“… <span id="current-date-text">--/--</span></span> 
                                <span id="percent-text" style="font-weight:bold; color:var(--accent-blue);">0% å…¥å‘³</span>
                            </div>
                            <div class="progress-row" style="justify-content: flex-start;">ğŸ“– æœ¬æ—¥é€²åº¦ï¼š<span id="plan-scope-text" style="font-weight: bold; margin-left: 5px;">--</span></div>
                            <div class="progress-row" style="justify-content: flex-start;">ğŸ§‚ æœ¬æ—¥åŠ é¹½é‡ï¼š<span id="today-salt-stars" style="margin-left: 5px; color: var(--accent-gold); letter-spacing: 2px;"></span></div>
                            
                            <div class="progress-quote" id="daily-word" onclick="refreshDailyWord()" title="é»æ“Šé‡åˆ·å°èª">
                                <span>ğŸ’¬ æœ¬æ—¥é†ƒæ¼¬å°èª...</span>
                                <span class="refresh-icon">â†»</span>
                            </div>
                        </div>
                        <button class="check-in-btn" onclick="showSection('devotion', document.querySelector('#nav-devotion'))">å‰å¾€é†ƒæ¼¬æ‰“å¡ âœ</button>
                    </div>

                    <!-- è³‡æ–™ä¿éšªç®± (æ¢å¾©é¡¯ç¤º) -->
                    <div class="mt-6 pt-4 border-t border-dashed border-[#EBE6DE] text-center">
                        <p class="text-xs text-[#94908A] mb-2">è³‡æ–™ä¿éšªç®±</p>
                        <div class="flex justify-center gap-2">
                            <button onclick="exportData()" class="text-xs border border-[#EBE6DE] rounded-lg px-3 py-1 text-[#5E5A54] hover:bg-[#F2EBE5]">åŒ¯å‡ºå‚™ä»½</button>
                            <button onclick="document.getElementById('import-file').click()" class="text-xs border border-[#EBE6DE] rounded-lg px-3 py-1 text-[#5E5A54] hover:bg-[#F2EBE5]">åŒ¯å…¥å‚™ä»½</button>
                            <input type="file" id="import-file" style="display: none;" onchange="importData(this)">
                        </div>
                    </div>
                </div>
            </section>

            <!-- éˆä¿® (Devotion) - NEW JOURNAL UI -->
            <section id="devotion" class="section h-full w-full bg-[#FDFCF8]">
                <!-- å…§åµŒçš„éˆä¿®å…§å®¤ UI -->
                <div class="h-full flex flex-col w-full">
                    <!-- é ‚éƒ¨å°è¦½åˆ— (Journal Style) -->
                    <header class="bg-white/80 backdrop-blur-md border-b border-[#EBE6DE] sticky top-0 z-20 shrink-0 w-full" style="display:block!important; padding: 0;">
                        <div class="max-w-7xl mx-auto px-4 md:px-6 flex justify-between items-center h-16 gap-3 md:gap-6">
                            <!-- Logo & Date -->
                            <div class="flex items-center gap-3 shrink-0">
                                <div class="flex items-center gap-2">
                                    <span class="text-2xl opacity-80">ğŸŸ</span>
                                    <h1 class="hidden md:block text-xl font-bold tracking-widest text-[#5E5A54] m-0">é†ƒæ¼¬é¹¹é­š</h1>
                                </div>
                                <div class="flex items-center bg-[#F9F7F5] rounded-full px-3 py-1.5 border border-[#EBE6DE] hover:border-[#D6D0C8] transition-colors">
                                    <input type="date" id="journal-date-picker" class="bg-transparent border-none text-xs md:text-sm font-medium focus:ring-0 outline-none cursor-pointer w-[110px] md:w-auto text-[#5E5A54]">
                                    <button id="journal-checkin-btn" class="ml-2 text-xs text-gray-400 hover:text-m-green" title="æ‰“å¡å®Œæˆ">âœ”ï¸</button>
                                </div>
                            </div>

                            <!-- æœå°‹æ¡† -->
                            <div class="flex-1 max-w-md relative">
                                <div class="relative group w-full">
                                    <input type="text" id="journal-search-input" 
                                           class="serif-font block w-full pl-4 pr-10 py-2 border border-[#EBE6DE] rounded-full leading-5 bg-[#FDFCF8] text-[#5E5A54] placeholder-[#B0AAA3] focus:outline-none focus:bg-white focus:border-[#A68C76] focus:ring-1 focus:ring-[#A68C76]/20 text-sm transition-all" 
                                           placeholder="æœå°‹ç¶“æ–‡...">
                                    <button id="journal-search-btn" class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer text-[#94908A] hover:text-[#A68C76] transition-colors">
                                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- å„²å­˜ç‹€æ…‹ -->
                            <div class="flex items-center shrink-0 w-16 justify-end hidden md:flex">
                                <div id="save-status" class="text-xs font-medium text-[#8DA399] opacity-0 transition-opacity duration-500 flex items-center gap-1 bg-[#8DA399]/10 px-3 py-1 rounded-full tracking-wider">
                                    <span>SAVED</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- ä¸»è¦å…§å®¹å€ -->
                    <div class="flex-1 w-full max-w-7xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8 overflow-y-auto lg:overflow-hidden relative">
                        
                        <!-- å·¦æ¬„ï¼šè®€ç¶“é€²åº¦ (Desktop) -->
                        <aside class="hidden lg:flex lg:col-span-2 flex-col gap-4 overflow-hidden h-full">
                            <div class="h-full flex flex-col">
                                <h3 class="text-xs font-semibold text-[#94908A] uppercase tracking-[0.2em] mb-4 pl-1 shrink-0">Reading Plan</h3>
                                <div class="flex-1 overflow-y-auto pr-2 pl-1 pb-4 space-y-4 journal-scroll" id="plan-list">
                                    <!-- JS ç”Ÿæˆ -->
                                </div>
                            </div>
                        </aside>

                        <!-- æ‰‹æ©Ÿç‰ˆé€²åº¦é¸å–® -->
                        <div class="lg:hidden col-span-1 bg-[#FDFCF8] p-4 rounded-xl border border-[#EBE6DE] shadow-sm overflow-x-auto whitespace-nowrap flex gap-4 no-scrollbar items-center shrink-0 min-h-[110px]" id="mobile-plan-list">
                            <!-- JS ç”Ÿæˆ -->
                        </div>

                        <!-- ä¸­æ¬„ï¼šè–ç¶“é–±è®€å™¨ -->
                        <section class="lg:col-span-5 flex flex-col bg-white rounded-2xl shadow-[0_4px_20px_-10px_rgba(0,0,0,0.05)] border border-[#EBE6DE] overflow-hidden h-[50vh] lg:h-full relative group">
                            <div class="h-1 w-full bg-[#F2EBE5] shrink-0"></div>
                            <div class="px-8 py-5 border-b border-[#F5F2EA] flex justify-between items-start bg-white sticky top-0 z-10 shrink-0">
                                <div class="flex flex-col gap-1 overflow-hidden">
                                    <span class="text-[10px] font-bold text-[#A68C76] uppercase tracking-widest" id="bible-book-tag">SCRIPTURE</span>
                                    <h2 id="bible-title" class="text-xl text-[#5E5A54] font-medium tracking-wide truncate pr-2 m-0">è«‹é¸æ“‡é€²åº¦</h2>
                                </div>
                                <button id="copy-btn" class="hidden flex items-center gap-1.5 px-3 py-1.5 text-[#94908A] hover:text-[#A68C76] hover:bg-[#FAF9F6] rounded-lg text-xs transition-all tracking-widest shrink-0">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                                    è¤‡è£½
                                </button>
                            </div>
                            <div id="bible-content" class="flex-1 overflow-y-auto p-8 bible-text text-[#5E5A54] bg-white scroll-smooth selection:bg-[#F2EBE5] selection:text-[#5E5A54] journal-scroll">
                                <div class="h-full flex flex-col items-center justify-center text-[#B0AAA3] gap-6 text-center">
                                    <div class="w-20 h-20 rounded-full bg-[#FDFCF8] border border-[#F2EBE5] flex items-center justify-center">
                                        <span class="text-3xl opacity-40 grayscale">ğŸ“–</span>
                                    </div>
                                    <div>
                                        <p class="text-base font-serif text-[#94908A]">æº–å‚™å¥½è¢«é†ƒæ¼¬äº†å—ï¼Ÿ</p>
                                        <p class="text-xs mt-2 font-light tracking-wider opacity-60">é»æ“Šå·¦å´ç¶“æ–‡ï¼Œè®“ç¥çš„è©±èªæ…¢æ…¢å…¥å‘³ã€‚</p>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- å³æ¬„ï¼šéˆä¿®ç­†è¨˜ -->
                        <section class="lg:col-span-5 flex flex-col h-full min-h-[500px]">
                            <div class="bg-white rounded-2xl shadow-[0_4px_20px_-10px_rgba(0,0,0,0.05)] border border-[#EBE6DE] flex-1 flex flex-col overflow-hidden">
                                <div class="h-1 w-full bg-[#EBE6DE] shrink-0"></div>
                                <div class="px-8 py-5 border-b border-[#F5F2EA] flex flex-col gap-4 shrink-0">
                                    <div class="flex items-center justify-between">
                                        <h3 class="font-serif text-lg text-[#5E5A54] flex items-center gap-3 m-0">
                                            <span class="text-lg opacity-60">âœğŸ»</span> é†ƒæ¼¬ç­†è¨˜
                                        </h3>
                                        <!-- ä¿®æ”¹ï¼šæ”¹ç‚ºæ–‡å­—æŒ‰éˆ• -->
                                        <div class="flex items-center gap-3">
                                            <button onclick="shareNote()" class="text-xs text-[#A68C76] hover:text-[#5E5A54] transition-colors font-medium tracking-widest px-2 py-1 hover:bg-[#F9F7F5] rounded">åˆ†äº«</button>
                                            <button onclick="downloadNote()" class="text-xs text-[#A68C76] hover:text-[#5E5A54] transition-colors font-medium tracking-widest px-2 py-1 hover:bg-[#F9F7F5] rounded">ä¸‹è¼‰</button>
                                        </div>
                                    </div>
                                    <div class="mood-selector-container rounded-xl p-2.5 flex items-center justify-between gap-2">
                                        <span class="text-[10px] font-bold text-[#A68C76] uppercase tracking-widest pl-2">MOOD</span>
                                        <div class="flex items-center gap-2 md:gap-3" id="mood-selector">
                                            <button class="mood-btn text-lg" data-mood="â˜€ï¸" title="å……æ»¿ç›¼æœ›">â˜€ï¸</button>
                                            <button class="mood-btn text-lg" data-mood="â˜ï¸" title="å¹³éœå®‰ç©©">â˜ï¸</button>
                                            <button class="mood-btn text-lg" data-mood="ğŸŒ§ï¸" title="ä½è°·/æ†‚å‚·">ğŸŒ§ï¸</button>
                                            <button class="mood-btn text-lg" data-mood="ğŸ”¥" title="ç«ç†±/æ¸´æ…•">ğŸ”¥</button>
                                            <button class="mood-btn text-lg" data-mood="ğŸŒ±" title="æ›´æ–°/æˆé•·">ğŸŒ±</button>
                                        </div>
                                        <input type="hidden" id="note-mood">
                                    </div>
                                </div>
                                <div class="flex-1 overflow-y-auto p-8 space-y-8 bg-white selection:bg-[#F2EBE5] journal-scroll">
                                    <div class="group relative pl-4 border-l-2 border-[#C8A8A4]/30 focus-within:border-[#C8A8A4] transition-colors">
                                        <label class="block text-xs font-bold text-[#C8A8A4] uppercase mb-2 tracking-widest">Rhema / æ„Ÿå‹•</label>
                                        <textarea id="note-scripture" placeholder="é»é¸å·¦å´ç¶“æ–‡ï¼Œæˆ–æ˜¯æ‰‹å‹•è¼¸å…¥é‚£äº›è®“ä½ å¿ƒé ­ä¸€éœ‡çš„è©±..." class="w-full bg-transparent border-none p-0 focus:ring-0 outline-none bible-text text-base min-h-[100px] resize-none placeholder-[#D6D0C8] text-[#5E5A54]"></textarea>
                                    </div>
                                    <div class="group relative pl-4 border-l-2 border-[#8F9EAC]/30 focus-within:border-[#8F9EAC] transition-colors">
                                        <label class="block text-xs font-bold text-[#8F9EAC] uppercase mb-2 tracking-widest">Reflection / é ˜å—</label>
                                        <textarea id="note-reflection" placeholder="éš¨ç­†è¨˜éŒ„å¿ƒä¸­çš„æ„Ÿå‹•ï¼Œé€™äº›éƒ½æ˜¯æ©å…¸çš„çµæ™¶..." class="w-full bg-transparent border-none p-0 focus:ring-0 outline-none text-[#5E5A54] min-h-[140px] resize-none placeholder-[#D6D0C8] leading-relaxed font-light"></textarea>
                                    </div>
                                    <div class="group relative pl-4 border-l-2 border-[#8DA399]/30 focus-within:border-[#8DA399] transition-colors">
                                        <label class="block text-xs font-bold text-[#8DA399] uppercase mb-2 tracking-widest">Prayer / ç¦±å‘Š</label>
                                        <textarea id="note-prayer" placeholder="èˆ‡å¤§è€é—†çš„ç§å¯†å°è©±æ™‚é–“..." class="w-full bg-transparent border-none p-0 focus:ring-0 outline-none text-[#5E5A54] min-h-[100px] resize-none placeholder-[#D6D0C8] leading-relaxed font-light"></textarea>
                                    </div>

                                    <!-- æ–°å¢ï¼šåˆ†éš”ç·šèˆ‡åŒ¯å‡ºå€å¡Š -->
                                    <div class="h-px w-full bg-[#F2EBE5] my-6"></div>
                                    <div class="text-center pb-8">
                                        <p class="text-xs text-[#94908A] font-serif mb-4 italic tracking-wider">é€™ä»½æ„Ÿå‹•å€¼å¾—è¢«æ°¸ä¹…çè—...</p>
                                        <button onclick="downloadNote()" class="bg-[#F2EBE5] text-[#5E5A54] hover:bg-[#EBE6DE] px-6 py-2 rounded-full text-sm font-medium tracking-widest transition-all shadow-sm hover:shadow-md">
                                            åŒ¯å‡ºæ—¥è¨˜
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </section>

            <!-- é¹¹é­šç¿»èº« -->
            <section id="flip" class="section">
                <div class="card">
                    <div class="flip-container" onclick="flipCard()">
                        <div class="flipper" id="flipper">
                            <div class="front">
                                <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ</div>
                                <h3 style="font-family: 'Noto Serif TC';">é¹¹é­šç¿»èº«</h3>
                                <p class="text-muted" style="margin-top: 10px;">é»æ“Šå¡ç‰‡ï¼Œè«‹ä¸»å»šç‚ºä½ ä¸Šä¸€é“å…¥å‘³çš„ç¿»èº«ç‰¹é¤</p>
                                <p class="text-muted" style="font-size: 0.8rem;">(å« 30% é¹¹é­šé›æ¹¯ï¼Œèˆ‡ 100% ä¸Šå¸ç´”æ·¨æ©å…¸)</p>
                            </div>
                            <div class="back">
                                <p class="quote-content" id="quote-content">æ­£åœ¨å¾Œå°ç†¬è£½äº®å…‰...</p>
                                <p id="quote-source" class="text-muted" style="font-weight:500;">--</p>
                                <p id="quote-comment"> </p>
                                <!-- ä¿®æ”¹æŒ‰éˆ• -->
                                <button class="btn-icon" onclick="saveCardImage(event)" style="margin-top:15px; font-weight:bold;">ğŸ“¸ æ‹ç«‹å¾—æ‰“åŒ… (å­˜åœ–)</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- è°æ˜é¹¹é­š (åŸ æ¸¸åˆƒæœ‰é­š) -->
            <section id="pua" class="section">
                <div class="card">
                    <h2>è°æ˜é¹¹é­š</h2>
                    <div class="text-muted" style="margin-bottom: 45px;">
                        <p><strong>æ‹’çµ•è¢«è£é€²å®—æ•™ç½é ­ï¼</strong></p>
                        <p>è®“ä½ è­˜ç ´å¥—è·¯ï¼Œæ‰¾å›è‡ªç”±ã€‚</p>
                    </div>
                    
                    <div class="pua-tags-header">
                        <label class="label" style="margin-bottom: 0;">ä½ å‰›æ‰è½åˆ°äº†å“ªå¥ã€Œé‡‘å¥ã€ï¼Ÿ</label>
                        <button class="refresh-pua-btn" onclick="renderPuaTags()">ğŸ”„ æ›ä¸€æ‰¹</button>
                    </div>
                    
                    <div id="pua-tag-container" class="pua-tag-container">
                        <!-- JS å°‡è‡ªå‹•å¡«å…¥æ¨™ç±¤ -->
                    </div>

                    <button class="btn-primary" onclick="detectPUA()" style="background-color: var(--accent-purple);">å•Ÿå‹•ç¿»è­¯è’Ÿè’»</button>
                    
                    <div class="pua-result-box" id="pua-result">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span class="pua-label">äººè©±ç¿»è­¯æ©Ÿ</span>
                            <span id="pua-level" class="pua-level-badge"></span>
                        </div>
                        <p class="pua-content" id="pua-translation" style="font-weight: bold;">--</p>
                        <span class="pua-label">é¹¹é­šåæ“Š (å…§å¿ƒ OS)ï¼š</span>
                        <p class="pua-content" id="pua-defense">--</p>
                    </div>

                    <p style="font-size: 0.75rem; color: #D98E73; margin-top: 15px; margin-bottom: 25px; font-style: italic; line-height: 1.5;">
                        âš ï¸ è­¦èªï¼šæœ¬ç¿»è­¯ç”± AI ç”Ÿæˆåƒ…ä¾›å¨›æ¨‚ï¼Œä¸ä»£è¡¨æ¯å€‹äººé€™æ¨£èªªçš„æ„æ€éƒ½æ˜¯é€™æ¨£ã€‚è«‹è¬¹æ…åˆ†è¾¨ï¼Œä¸è¦å°è™Ÿå…¥åº§ï¼Œä¹Ÿä¸è¦ä»¥æ­¤è«–æ–·åˆ¥äººã€‚
                    </p>

                    <button class="btn-secondary" onclick="togglePuaTest()" style="margin-top:25px; border-radius:50px; background:#F8F8F8; padding:12px; border:none; width:100%; cursor:pointer; font-weight:500;">ğŸ§¬ å±¬éˆ PUA ç—…æ¯’å¿«ç¯©</button>
                    
                    <div id="pua-test-area" class="pua-test-area" style="display:none; background:white; border:1px solid var(--border-color); border-radius:var(--radius-main); padding:20px; margin-top:20px; text-align:left;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                            <span style="font-weight:bold; color: var(--accent-purple);">ç’°å¢ƒ PUA æ¯’æ€§æª¢æ¸¬ (7é¡Œ)</span>
                            <button onclick="initPuaTest()" style="border:none; background:none; cursor:pointer; color: var(--text-secondary); font-size: 0.8rem;">ğŸ”„ æ›ä¸€çµ„è©¦åŠ‘</button>
                        </div>
                        <div id="test-list"></div>
                        <button class="btn-primary" onclick="runPuaTest()" style="margin-top:15px; background-color: var(--accent-purple);">ç”Ÿæˆè¨ºæ–·å ±å‘Š</button>
                        <div id="test-result" class="test-result" style="display:none; margin-top:15px;"></div>
                    </div>

                    <!-- æ–°å¢ï¼šPUA å›é¥‹å€å¡Š -->
                    <div class="feedback-section">
                        <p class="feedback-text">é‚„æœ‰è½éæ›´æ‰¯çš„ï¼Ÿæ­¡è¿å›é¥‹çµ¦ä¸»å»šï¼</p>
                        <a href="https://line.me/R/ti/p/@469cjlho" target="_blank" rel="noopener noreferrer" class="btn-line">ğŸ’¬ åŠ  LINE æŠ•ç¨¿ PUA é‡‘å¥</a>
                    </div>
                </div>
            </section>

            <!-- ä¿®æ”¹ï¼šå°‡æ¸¸åˆƒæœ‰é­š (Shield) ç§»åˆ° ç¶½ç¶½æœ‰é­š (Flow) ä¹‹å‰ -->
            <section id="shield" class="section">
                <div class="card">
                    <h2>æ¸¸åˆƒæœ‰é­š</h2>
                    <div class="text-muted" style="margin-bottom: 40px;">
                        <p>é¢å°è®“äººç¿»ç™½çœ¼çš„æå•ï¼Œé€™è£¡æœ‰è®“ä½ å„ªé›…è„«èº«çš„é¹¹é­šæ™ºæ…§ã€‚</p>
                    </div>
                    
                    <div class="pua-tags-header">
                        <label class="label" style="margin-bottom: 0;">ç•¶å°æ–¹å•ä½ é€™äº›å°·å°¬å•é¡Œæ™‚ï¼š</label>
                        <button class="refresh-shield-btn" onclick="renderShieldTags()">ğŸ”„ æ›ä¸€æ‰¹</button>
                    </div>

                    <div id="shield-tag-container" class="shield-tag-container">
                          <!-- JS è‡ªå‹•å¡«å…¥æ¨™ç±¤ -->
                    </div>

                    <button class="btn-primary" onclick="getExcuse()">ç”Ÿæˆç¥å›è¦†</button>
                    <div class="result-box" id="shield-result"><p id="shield-text" style="font-family: 'Noto Serif TC';"></p></div>

                    <!-- æ–°å¢ï¼šShield å›é¥‹å€å¡Š -->
                    <div class="feedback-section" style="margin-top: 30px;">
                        <p class="feedback-text">é‡éæ›´è®“äººç¿»ç™½çœ¼çš„å•é¡Œï¼Ÿ</p>
                        <a href="https://line.me/R/ti/p/@469cjlho" target="_blank" rel="noopener noreferrer" class="btn-line" style="color: var(--accent-warning); border-color: var(--accent-warning);">ğŸ’¬ åŠ  LINE æŠ•ç¨¿å°·å°¬å•é¡Œ</a>
                    </div>
                </div>
            </section>

            <section id="flow" class="section">
                <div class="card">
                    <h2>ç¶½ç¶½æœ‰é­š</h2>
                    <div class="text-muted" style="margin-bottom: 20px;">
                        <p>å³ä½¿åœ¨èººå¹³çš„æ™‚åˆ»ï¼Œæ©å…¸ä¾ç„¶ç¶½ç¶½æœ‰é¤˜ã€‚</p>
                    </div>
                    
                    <div class="tab-switcher">
                        <button class="tab-btn active" onclick="switchFlowTab('savings')">ğŸ’° 365 å­˜éŒ¢</button>
                        <button class="tab-btn" onclick="switchFlowTab('wishlist')">âœ¨ é¡˜æœ›æ¸…å–®</button>
                    </div>

                    <!-- 365 å­˜éŒ¢åˆ†é  -->
                    <div id="tab-savings" class="sub-section active">
                        <div style="text-align: left; margin-bottom: 15px; font-size: 0.9rem; color: var(--text-secondary); display: flex; justify-content: space-between; align-items: center;">
                            <span>ç›®å‰ç´¯è¨ˆï¼š<b id="savings-total" style="color: var(--text-primary); font-size: 1.1rem;">$0</b></span>
                            <span style="font-size: 0.8rem;">ç›®æ¨™ï¼š$66,795</span>
                        </div>
                        <div class="savings-grid" id="savings-grid">
                            <!-- JS è‡ªå‹•ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- é¡˜æœ›æ¸…å–®åˆ†é  -->
                    <div id="tab-wishlist" class="sub-section">
                        <div class="input-group">
                            <input type="text" id="new-wish-input" placeholder="ä½ çš„é¡˜æœ›..." style="flex: 2;">
                            <input type="number" id="new-wish-cost" placeholder="$ é‡‘é¡" style="flex: 1;">
                            <button class="add-btn" onclick="addWish()">ï¼‹</button>
                        </div>
                        
                        <div id="wish-list"></div>

                        <!-- AI é¼“å‹µå€ -->
                        <div class="ai-encourage-box">
                            <p id="financial-encouragement">--</p>
                            <button onclick="refreshFinancialEncouragement()" style="background:none; border:none; color: var(--accent-blue); font-size: 0.8rem; margin-top: 10px; cursor: pointer;">â†» æ›ä¸€å¥é¼“å‹µ</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å…¨åŸŸèƒŒæ™¯èªéŒ„å€ -->
            <div class="global-footer-quote">
                <p>ã€Œä½ å€‘æ˜¯ä¸–ä¸Šçš„é¹½ï¼Œé¹½è‹¥å¤±äº†å‘³â€¦â€¦ã€</p>
                <p>é‚£å°±æš«æ™‚åšä¸€æ¢å¿«æ¨‚çš„é¹¹é­šã€‚</p>
            </div>

            <footer>
                <!-- è¯çµ¡æˆ‘å€‘ (æ•´åˆæ‰€æœ‰ç¤¾ç¾¤é€£çµ) -->
                <div class="contact-section">
                    <span class="contact-label" style="margin-bottom: 12px; font-size: 0.85rem;">è¯çµ¡æˆ‘å€‘</span>
                    <div class="social-links" style="gap: 25px;">
                        <a href="https://www.facebook.com/profile.php?id=100068500932557" class="icon-link" aria-label="Facebook" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                        </a>
                        <a href="https://www.instagram.com/forever.believe.in.jesus/" class="icon-link" aria-label="Instagram" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                        </a>
                        <a href="https://www.threads.net/@forever.believe.in.jesus" class="icon-link" aria-label="Threads" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path></svg>
                        </a>
                        <a href="https://line.me/R/ti/p/@469cjlho" class="icon-link" aria-label="Official Line" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                        </a>
                        <a href="mailto:newthingsinthelittlelight@gmail.com" class="icon-link" aria-label="Email">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        </a>
                    </div>
                    
                    <!-- ä½¿ç”¨æ‰‹å†Šé€£çµ -->
                    <a href="#" onclick="showHelpModal(); return false;" style="margin-top: 12px; font-size: 0.8rem; color: var(--accent-blue); text-decoration: none; border-bottom: 1px dotted var(--accent-blue);">ğŸ“– ä½¿ç”¨èªªæ˜æ›¸</a>
                </div>

                <div style="margin-top: 25px;">
                    <p class="ai-note">ğŸ’¡ æœ¬ç«™æ‰€æœ‰æ–‡æ¡ˆçš†ç”± AI èˆ‡é¹¹é­šå”åŒé†ƒæ¼¬è€Œæˆï¼Œåƒ…ä¾›å¨›æ¨‚ã€‚</p>
                    <p style="font-size: 0.65rem; color: #CCC;">Ver 1.6 (Data Fix & Auto-Regen)</p>
                    <p>&copy; 2026æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´» | è€¶ç©ŒåŠ æ²¹ç«™ x å¾®å…‰æ–°äº‹</p>
                </div>
            </footer>
        </main>
    </div>

    <!-- åº•éƒ¨å°è¦½åˆ— -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="showSection('home', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            é¦–é 
        </button>
        <button class="nav-item" id="nav-devotion" onclick="showSection('devotion', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
            é†ƒæ¼¬é¹¹é­š
        </button>
        <button class="nav-item" onclick="showSection('flip', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
            é¹¹é­šç¿»èº«
        </button>
        <button class="nav-item" onclick="showSection('pua', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            è°æ˜é¹¹é­š
        </button>
        <button class="nav-item" onclick="showSection('shield', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            æ¸¸åˆƒæœ‰é­š
        </button>
        <button class="nav-item" onclick="showSection('flow', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            ç¶½ç¶½æœ‰é­š
        </button>
    </nav>

    <!-- ç¢ºèªè¦–çª— -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="font-size: 1.2rem; margin-bottom: 15px;">è«‹ç¢ºèª</h3>
            <p id="confirm-msg" style="color: var(--text-primary); margin-bottom: 20px;">ç¢ºå®šè¦åŸ·è¡Œå—ï¼Ÿ</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="closeConfirmModal()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: #f0f0f0;">å–æ¶ˆ</button>
                <button id="confirm-btn-action" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: var(--accent-warning); color: white;">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal-overlay">
        <div class="modal-content relative">
            <button onclick="closeHelpModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            
            <div class="prose prose-sm max-w-none text-[#5E5A54]">
                <h2>ğŸ“– æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´» | ä½¿ç”¨èªªæ˜æ›¸</h2>

                <p>è¦ªæ„›çš„é¹¹é­šå¤¥ä¼´ï¼Œå¹³å®‰ï¼š</p>
                <p>æ­¡è¿ä¾†åˆ°é€™å€‹å°ˆç‚ºã€Œä¸æƒ³éåº¦åŠªåŠ›è€Œå…§è€—ã€çš„åŸºç£å¾’æ‰“é€ çš„å±¬éˆé¿é›£æ‰€ã€‚åœ¨é€™è£¡ï¼Œæˆ‘å€‘æ‹’çµ•å±¬éˆç„¦æ…®ï¼Œä¸»å¼µåœ¨æ©å…¸ä¸­å¿«æ¨‚èººå¹³ã€‚ç‚ºäº†è®“æ‚¨èƒ½å®‰å¿ƒåœ°åœ¨é€™è£¡é†ƒæ¼¬è‡ªå·±ï¼Œè«‹èŠ±ä¸€é»æ™‚é–“é–±è®€é€™ä»½èªªæ˜æ›¸ã€‚</p>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 my-4 rounded-r">
                    <h4 class="text-yellow-800 font-bold m-0">ğŸ’¾ é‡è¦ï¼šé—œæ–¼è³‡æ–™ä¿å­˜èˆ‡å‚™ä»½ï¼ˆå¿…è®€ï¼ï¼‰</h4>
                    <p class="text-sm text-yellow-700 mt-2">é€™æ˜¯æœ¬ç«™æœ€é‡è¦çš„éƒ¨åˆ†ã€‚ç‚ºäº†ä¿è­·æ‚¨çš„éš±ç§ï¼Œæœ¬ç«™æ¡ç”¨ <strong>ã€Œæœ¬åœ°å„²å­˜ (Local Storage)ã€</strong> æŠ€è¡“ã€‚</p>
                </div>

                <h3>1. è³‡æ–™å­˜åœ¨å“ªè£¡ï¼Ÿ</h3>
                <p>æ‚¨å¯«ä¸‹çš„æ¯ä¸€å€‹å­—ï¼ˆéˆä¿®ç­†è¨˜ã€å­˜éŒ¢ç´€éŒ„ã€é¡˜æœ›æ¸…å–®ï¼‰ï¼Œéƒ½ç›´æ¥å„²å­˜åœ¨æ‚¨ <strong>ç›®å‰ä½¿ç”¨çš„é€™å°è£ç½®ï¼ˆæ‰‹æ©Ÿæˆ–é›»è…¦ï¼‰çš„ç€è¦½å™¨å…§éƒ¨</strong>ï¼Œæˆ‘å€‘ä¸æœƒï¼ˆä¹Ÿç„¡æ³•ï¼‰å°‡è³‡æ–™ä¸Šå‚³åˆ°ä»»ä½•é›²ç«¯ä¼ºæœå™¨ã€‚</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>âœ… <strong>å„ªé»</strong>ï¼šéš±ç§æ€§æ¥µé«˜ï¼Œåªæœ‰å¤©çŸ¥ã€åœ°çŸ¥ã€ä½ çŸ¥ï¼Œä¸”é›¢ç·šä¹Ÿèƒ½ä½¿ç”¨ã€‚</li>
                    <li>âš ï¸ <strong>ç‰¹æ€§</strong>ï¼šè³‡æ–™æ˜¯ã€Œè·Ÿè‘—ç€è¦½å™¨ã€èµ°çš„ã€‚</li>
                </ul>

                <h3>2. ä»€éº¼æƒ…æ³ä¸‹è³‡æ–™æœƒä¸è¦‹ï¼Ÿ</h3>
                <p>ç”±æ–¼è³‡æ–™å­˜æ”¾åœ¨ç€è¦½å™¨å…§ï¼Œä»¥ä¸‹æƒ…æ³æœƒå°è‡´æ‚¨çš„ç´€éŒ„æ¶ˆå¤±ï¼š</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>æ¸…é™¤ç€è¦½å™¨ç´€éŒ„</strong>ï¼šè‹¥æ‰‹å‹•æ¸…é™¤äº†ã€ŒCookieã€æˆ–ã€Œå¿«å–è³‡æ–™ã€ï¼Œè³‡æ–™æœƒè¢«åˆªé™¤ã€‚</li>
                    <li><strong>ä½¿ç”¨ç„¡ç—•æ¨¡å¼ (Incognito)</strong>ï¼šç„¡ç—•è¦–çª—é—œé–‰å¾Œï¼Œæ‰€æœ‰è³‡æ–™æœƒè‡ªå‹•éŠ·æ¯€ã€‚</li>
                    <li><strong>æ›´æ›è£ç½®æˆ–ç€è¦½å™¨</strong>ï¼šæ‰‹æ©Ÿ Chrome çš„è³‡æ–™ï¼Œç„¡æ³•åœ¨é›»è…¦ Chrome æˆ–æ‰‹æ©Ÿ Safari ä¸Šçœ‹åˆ°ã€‚</li>
                    <li><strong>æ‰‹æ©Ÿé‡ç½®</strong>ï¼šæ¢å¾©åŸå» è¨­å®šå¾Œï¼Œè³‡æ–™æœƒæ¶ˆå¤±ã€‚</li>
                </ul>

                <h3>3. å¦‚ä½•æ°¸ä¹…ä¿å­˜ï¼Ÿï¼ˆå¼·çƒˆå»ºè­°ï¼‰</h3>
                <p>æˆ‘å€‘æä¾›äº†å…©ç¨®å±¤ç´šçš„ä¿å­˜æ–¹å¼ï¼Œå»ºè­°æ‚¨é¤Šæˆå¥½ç¿’æ…£ï¼š</p>

                <h4>A. å…¨ç«™è³‡æ–™å‚™ä»½ï¼ˆæ›æ‰‹æ©Ÿå¿…ç”¨ï¼‰</h4>
                <p>ä½æ–¼ <strong>ã€Œé¦–é ã€</strong> æœ€ä¸‹æ–¹çš„ <strong>ã€ŒğŸ”’ è³‡æ–™ä¿éšªç®±ã€</strong>ã€‚</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>ğŸ“¤ åŒ¯å‡ºå‚™ä»½</strong>ï¼šé»æ“Šå¾Œæœƒä¸‹è¼‰ä¸€å€‹ <code>.json</code> æª”æ¡ˆã€‚é€™åŒ…å«äº†æ‚¨åœ¨ç¶²ç«™ä¸Šçš„ <strong>æ‰€æœ‰ç´€éŒ„</strong>ã€‚è«‹å°‡æ­¤æª”æ¡ˆå¦¥å–„ä¿å­˜åœ¨é›²ç«¯ç¡¬ç¢Ÿæˆ– Email ä¸­ã€‚</li>
                    <li><strong>ğŸ“¥ åŒ¯å…¥å‚™ä»½</strong>ï¼šç•¶æ‚¨æ›æ–°æ‰‹æ©Ÿæˆ–ä¸å°å¿ƒæ¸…ç©ºè³‡æ–™æ™‚ï¼Œè¼‰å…¥é€™å€‹æª”æ¡ˆå³å¯é‚„åŸã€‚</li>
                </ul>

                <h4>B. å–®æ—¥éˆä¿®åˆ†äº«ï¼ˆæ¯æ—¥ç”¨ï¼‰</h4>
                <p>ä½æ–¼ <strong>ã€Œé†ƒæ¼¬é¹¹é­šï¼ˆéˆä¿®ï¼‰ã€</strong> é é¢çš„ç­†è¨˜å€ã€‚</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>ä¸‹è¼‰</strong>ï¼šå°‡ç•¶å¤©çš„ç¶“æ–‡ã€é ˜å—èˆ‡ç¦±å‘Šæ•´ç†æˆæ–‡å­—æª”ä¸‹è¼‰ã€‚</li>
                    <li><strong>åˆ†äº«</strong>ï¼šæ‰‹æ©Ÿç‰ˆå¯ç›´æ¥å–šèµ·ç³»çµ±é¸å–®ï¼ˆå­˜å…¥ Keepã€å‚™å¿˜éŒ„ï¼‰ï¼›é›»è…¦ç‰ˆå‰‡æœƒè‡ªå‹•è¤‡è£½å…¨æ–‡ï¼Œæ–¹ä¾¿æ‚¨è²¼åˆ°ç¿’æ…£çš„ç­†è¨˜è»Ÿé«”ã€‚</li>
                </ul>

                <hr class="my-6 border-dashed border-gray-300">

                <h3>ğŸŸ åŠŸèƒ½ä»‹ç´¹</h3>

                <h4>1. é¦–é ï¼šé¹¹åº¦ç›£æ¸¬èˆ‡è¨ˆç•«</h4>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>é¹¹é­šé¹½åº¦ç›£æ¸¬</strong>ï¼šæ¯å¤©æ¸¬æ¸¬çœ‹ä½ æœ‰å¤šã€Œé¹¹ã€ï¼Œç´”å±¬å¨›æ¨‚ã€‚</li>
                    <li><strong>å±¬éˆé˜²è…åŠ‘</strong>ï¼šç•¶ä½ è¦ºå¾—å¿«æ’ä¸ä¸‹å»æ™‚ï¼Œé ˜å–ä¸€å¥æ€¥æ•‘é‡‘å¥ã€‚</li>
                    <li><strong>è®€ç¶“é€²åº¦æ¢</strong>ï¼šç›´è§€é¡¯ç¤ºæ‚¨çš„ä¸€å¹´è®€ç¶“é€²åº¦ã€‚</li>
                </ul>

                <h4>2. é†ƒæ¼¬é¹¹é­šï¼ˆéˆä¿®å…§å®¤ï¼‰</h4>
                <p>é€™æ˜¯æ‚¨çš„æ ¸å¿ƒéˆä¿®å€ï¼Œæ¡ç”¨ <strong>ã€Œä¸€å¹´è®€ç¶“è¨ˆç•«ã€</strong> æ··åˆåˆ¶ï¼š</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>æ¯æ—¥é€²åº¦</strong>ï¼šç³»çµ±è‡ªå‹•å®‰æ’ <strong>èˆŠç´„ + æ–°ç´„ + è©©ç¯‡ + ç®´è¨€</strong>ã€‚</li>
                    <li><strong>è‡ªå‹•ç¶“æ–‡è¼‰å…¥</strong>ï¼šé»æ“Šé€²åº¦å¡ç‰‡ï¼Œç³»çµ±æœƒè‡ªå‹•å¹«æ‚¨æŠ“å–ç¶“æ–‡ï¼Œç›´æ¥é–±è®€ã€‚</li>
                </ul>

                <h4>3. é¹¹é­šç¿»èº«ï¼ˆæŠ½å¡ï¼‰</h4>
                <ul class="list-disc pl-5 space-y-1">
                    <li>æ¯å¤©ç¿»ä¸€å¼µå¡ï¼Œç²å¾—ä¸»å»šç‰¹è£½çš„ã€Œé¹¹é­šé›æ¹¯ã€æˆ–ã€Œæ©å…¸äº®å…‰ã€ã€‚</li>
                    <li><strong>ğŸ“¸ æ‹ç«‹å¾—æ‰“åŒ…</strong>ï¼šå°‡å¡ç‰‡è®Šæˆä¸€å¼µç²¾ç¾çš„åœ–ç‰‡ä¸‹è¼‰ã€‚</li>
                </ul>
                
                <p class="mt-6 text-sm text-gray-500 italic text-center">æŠŠé€™è£¡ç•¶ä½œæ˜¯ä¸€å€‹å®‰éœçš„æ›¸æ¡Œï¼Œè¨˜å¾—åœ¨çµæŸéˆä¿®å¾Œï¼Œé»æ“Šä¸€ä¸‹ã€Œåˆ†äº«ã€æˆ–ã€ŒåŒ¯å‡ºã€ï¼Œå°‡é€™ä»½æ„Ÿå‹•å¥½å¥½æ”¶è—èµ·ä¾†å–”ï¼</p>
                <p class="text-sm text-gray-500 italic text-center">é¡˜æ‚¨çš„é¹¹é­šç”Ÿæ´»ï¼Œæœ‰æ»‹æœ‰å‘³ï¼Œæ©å…¸å¤ ç”¨ã€‚</p>
            </div>
            
            <div class="mt-6 text-center">
                <button onclick="closeHelpModal()" class="bg-[#A68C76] text-white px-6 py-2 rounded-full hover:bg-[#8e7662] transition-colors">æˆ‘çŸ¥é“äº†</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"><span>å·²æˆåŠŸè¤‡è£½åˆ°éˆé­‚æ·±è™•</span></div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™ (ä¿æŒä¸è®Š) ---
        const bibleBooks = [
            { name: "å‰µä¸–è¨˜", abbr: "å‰µ", code: "GEN", chapters: 50, type: 1 }, { name: "å‡ºåŸƒåŠè¨˜", abbr: "å‡º", code: "EXO", chapters: 40, type: 1 }, 
            { name: "åˆ©æœªè¨˜", abbr: "åˆ©", code: "LEV", chapters: 27, type: 1 }, { name: "æ°‘æ•¸è¨˜", abbr: "æ°‘", code: "NUM", chapters: 36, type: 1 },
            { name: "ç”³å‘½è¨˜", abbr: "ç”³", code: "DEU", chapters: 34, type: 1 }, { name: "ç´„æ›¸äºè¨˜", abbr: "æ›¸", code: "JOS", chapters: 24, type: 1 },
            { name: "å£«å¸«è¨˜", abbr: "å£«", code: "JDG", chapters: 21, type: 1 }, { name: "è·¯å¾—è¨˜", abbr: "å¾—", code: "RUT", chapters: 4, type: 1 },
            { name: "æ’’æ¯è€³è¨˜ä¸Š", abbr: "æ’’ä¸Š", code: "1SA", chapters: 31, type: 1 }, { name: "æ’’æ¯è€³è¨˜ä¸‹", abbr: "æ’’ä¸‹", code: "2SA", chapters: 24, type: 1 },
            { name: "åˆ—ç‹ç´€ä¸Š", abbr: "ç‹ä¸Š", code: "1KI", chapters: 22, type: 1 }, { name: "åˆ—ç‹ç´€ä¸‹", abbr: "ç‹ä¸‹", code: "2KI", chapters: 25, type: 1 },
            { name: "æ­·ä»£å¿—ä¸Š", abbr: "ä»£ä¸Š", code: "1CH", chapters: 29, type: 1 }, { name: "æ­·ä»£å¿—ä¸‹", abbr: "ä»£ä¸‹", code: "2CH", chapters: 36, type: 1 },
            { name: "ä»¥æ–¯æ‹‰è¨˜", abbr: "æ‹‰", code: "EZR", chapters: 10, type: 1 }, { name: "å°¼å¸Œç±³è¨˜", abbr: "å°¼", code: "NEH", chapters: 13, type: 1 },
            { name: "ä»¥æ–¯å¸–è¨˜", abbr: "æ–¯", code: "EST", chapters: 10, type: 1 }, { name: "ç´„ä¼¯è¨˜", abbr: "ä¼¯", code: "JOB", chapters: 42, type: 1 },
            { name: "è©©ç¯‡", abbr: "è©©", code: "PSA", chapters: 150, type: 3 }, { name: "ç®´è¨€", abbr: "ç®´", code: "PRO", chapters: 31, type: 4 },
            { name: "å‚³é“æ›¸", abbr: "å‚³", code: "ECC", chapters: 12, type: 1 }, { name: "é›…æ­Œ", abbr: "æ­Œ", code: "SNG", chapters: 8, type: 1 },
            { name: "ä»¥è³½äºæ›¸", abbr: "è³½", code: "ISA", chapters: 66, type: 1 }, { name: "è€¶åˆ©ç±³æ›¸", abbr: "è€¶", code: "JER", chapters: 52, type: 1 },
            { name: "è€¶åˆ©ç±³å“€æ­Œ", abbr: "å“€", code: "LAM", chapters: 5, type: 1 }, { name: "ä»¥è¥¿çµæ›¸", abbr: "çµ", code: "EZE", chapters: 48, type: 1 },
            { name: "ä½†ä»¥ç†æ›¸", abbr: "ä½†", code: "DAN", chapters: 12, type: 1 }, { name: "ä½•è¥¿é˜¿æ›¸", abbr: "ä½•", code: "HOS", chapters: 14, type: 1 },
            { name: "ç´„ç¥æ›¸", abbr: "ç¥", code: "JOL", chapters: 3, type: 1 }, { name: "é˜¿æ‘©å¸æ›¸", abbr: "æ‘©", code: "AMO", chapters: 9, type: 1 },
            { name: "ä¿„å·´åº•äºæ›¸", abbr: "ä¿„", code: "OBA", chapters: 1, type: 1 }, { name: "ç´„æ‹¿æ›¸", abbr: "æ‹¿", code: "JON", chapters: 4, type: 1 },
            { name: "å½Œè¿¦æ›¸", abbr: "å½Œ", code: "MIC", chapters: 7, type: 1 }, { name: "é‚£é´»æ›¸", abbr: "é´»", code: "NAM", chapters: 3, type: 1 },
            { name: "å“ˆå·´è°·æ›¸", abbr: "å“ˆ", code: "HAB", chapters: 3, type: 1 }, { name: "è¥¿ç•ªé›…æ›¸", abbr: "ç•ª", code: "ZEP", chapters: 3, type: 1 },
            { name: "å“ˆè©²æ›¸", abbr: "è©²", code: "HAG", chapters: 2, type: 1 }, { name: "æ’’è¿¦åˆ©äºæ›¸", abbr: "äº", code: "ZEC", chapters: 14, type: 1 },
            { name: "ç‘ªæ‹‰åŸºæ›¸", abbr: "ç‘ª", code: "MAL", chapters: 4, type: 1 }, 
            { name: "é¦¬å¤ªç¦éŸ³", abbr: "å¤ª", code: "MAT", chapters: 28, type: 2 }, { name: "é¦¬å¯ç¦éŸ³", abbr: "å¯", code: "MRK", chapters: 16, type: 2 }, 
            { name: "è·¯åŠ ç¦éŸ³", abbr: "è·¯", code: "LUK", chapters: 24, type: 2 }, { name: "ç´„ç¿°ç¦éŸ³", abbr: "ç´„", code: "JHN", chapters: 21, type: 2 }, 
            { name: "ä½¿å¾’è¡Œå‚³", abbr: "å¾’", code: "ACT", chapters: 28, type: 2 }, { name: "ç¾…é¦¬æ›¸", abbr: "ç¾…", code: "ROM", chapters: 16, type: 2 }, 
            { name: "å“¥æ—å¤šå‰æ›¸", abbr: "æ—å‰", code: "1CO", chapters: 16, type: 2 }, { name: "å“¥æ—å¤šå¾Œæ›¸", abbr: "æ—å¾Œ", code: "2CO", chapters: 13, type: 2 }, 
            { name: "åŠ æ‹‰å¤ªæ›¸", abbr: "åŠ ", code: "GAL", chapters: 6, type: 2 }, { name: "ä»¥å¼—æ‰€æ›¸", abbr: "å¼—", code: "EPH", chapters: 6, type: 2 }, 
            { name: "è…“ç«‹æ¯”æ›¸", abbr: "è…“", code: "PHP", chapters: 4, type: 2 }, { name: "æ­Œç¾…è¥¿æ›¸", abbr: "è¥¿", code: "COL", chapters: 4, type: 2 }, 
            { name: "å¸–æ’’ç¾…å°¼è¿¦å‰æ›¸", abbr: "å¸–å‰", code: "1TH", chapters: 5, type: 2 }, { name: "å¸–æ’’ç¾…å°¼è¿¦å¾Œæ›¸", abbr: "å¸–å¾Œ", code: "2TH", chapters: 3, type: 2 }, 
            { name: "ææ‘©å¤ªå‰æ›¸", abbr: "æå‰", code: "1TI", chapters: 6, type: 2 }, { name: "ææ‘©å¤ªå¾Œæ›¸", abbr: "æå¾Œ", code: "2TI", chapters: 4, type: 2 }, 
            { name: "æå¤šæ›¸", abbr: "å¤š", code: "TIT", chapters: 3, type: 2 }, { name: "è…“åˆ©é–€æ›¸", abbr: "é–€", code: "PHM", chapters: 1, type: 2 }, 
            { name: "å¸Œä¼¯ä¾†æ›¸", abbr: "ä¾†", code: "HEB", chapters: 13, type: 2 }, { name: "é›…å„æ›¸", abbr: "é›…", code: "JAS", chapters: 5, type: 2 }, 
            { name: "å½¼å¾—å‰æ›¸", abbr: "å½¼å‰", code: "1PE", chapters: 5, type: 2 }, { name: "å½¼å¾—å¾Œæ›¸", abbr: "å½¼å¾Œ", code: "2PE", chapters: 3, type: 2 }, 
            { name: "ç´„ç¿°ä¸€æ›¸", abbr: "ç´„ä¸€", code: "1JN", chapters: 5, type: 2 }, { name: "ç´„ç¿°äºŒæ›¸", abbr: "ç´„äºŒ", code: "2JN", chapters: 1, type: 2 }, 
            { name: "ç´„ç¿°ä¸‰æ›¸", abbr: "ç´„ä¸‰", code: "3JN", chapters: 1, type: 2 }, { name: "çŒ¶å¤§æ›¸", abbr: "çŒ¶", code: "JUD", chapters: 1, type: 2 }, 
            { name: "å•Ÿç¤ºéŒ„", abbr: "å•Ÿ", code: "REV", chapters: 22, type: 2 }
        ];

        const encouragements = ["ä¸è¦æ€•ï¼Œåªè¦ä¿¡ã€‚", "ä½ çš„ç¦±å‘Šï¼Œç¥éƒ½è½è¦‹äº†ã€‚", "æ‚£é›£ç”Ÿå¿è€ï¼Œå¿è€ç”Ÿè€ç·´ã€‚", "æ„›æ˜¯æ°¸ä¸æ­¢æ¯ã€‚", "å‡¡äº‹äº’ç›¸æ•ˆåŠ›ï¼Œå«æ„›ç¥çš„äººå¾—ç›Šè™•ã€‚", "é è‘—é‚£åŠ çµ¦æˆ‘åŠ›é‡çš„ï¼Œå‡¡äº‹éƒ½èƒ½åšã€‚", "å–œæ¨‚çš„å¿ƒä¹ƒæ˜¯è‰¯è—¥ã€‚", "å°±åœ¨ä»Šå¤©ï¼Œæ©å…¸å¤ ä½ ç”¨ã€‚", "å …æŒä¸‹å»ï¼Œç¥çš„æ™‚é–“æœ€å®Œç¾ã€‚"];
        const financialEncouragements = ["ç©å°‘æˆå¤šï¼Œä¸Šå¸çš„ä¾›æ‡‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚", "ä½ çš„æ¯ä¸€å€‹éŠ…æ¿ï¼Œéƒ½æ˜¯å°æœªä¾†çš„ä¿¡å¿ƒã€‚", "ä¸è¦ç‚ºæ˜å¤©æ†‚æ…®ï¼Œå› ç‚ºæ˜å¤©è‡ªæœ‰æ˜å¤©çš„æ†‚æ…®ã€‚", "è€¶å’Œè¯ä»¥å‹’ï¼Œç¥‚å¿…æœ‰é å‚™ã€‚", "ç†è²¡ä¹Ÿæ˜¯ä¸€ç¨®ç®¡å®¶è·åˆ†ï¼Œä½ åšå¾—å¾ˆå¥½ï¼", "å“ªæ€•åªæ˜¯å­˜ä¸‹ä¸€å¡ŠéŒ¢ï¼Œä¹Ÿæ˜¯å‘å¤¢æƒ³é è¿‘çš„ä¸€æ­¥ã€‚", "å¯Œè¶³ä¸åœ¨æ–¼æ“æœ‰å¤šå°‘ï¼Œè€Œåœ¨æ–¼çŸ¥è¶³ã€‚", "ç¨®ä»€éº¼æ”¶ä»€éº¼ï¼Œç¾åœ¨çš„å„²è“„æ˜¯æœªä¾†çš„æ”¶æˆã€‚"];
        const keywords = ["çªç ´", "å®‰æ¯", "é‡å»º", "è±ç››", "å‹‡æ°£", "å–œæ¨‚", "å°ˆæ³¨", "è¬™å‘", "ä¿¡å¿ƒ", "æ„›", "æ™ºæ…§", "è€å¿ƒ", "æ›´æ–°", "æ„Ÿæ©", "å¿ å¿ƒ"];
        
        let onlineSaltStatusMap = [], onlinePreservativePool = [], onlineFlipQuotes = [], onlinePuaData = [], onlineShieldData = [], dailyQuotesPool = [];
        const saltStatusMap = [{ min: 0, max: 10, title: "å«é¹½é‡ 5%ï¼šæ–°é®®æ·¡æ°´é­š", desc: "è­¦å‘Šï¼šä½ å¤ªæ–°é®®äº†ï¼Œå®Œå…¨æ²’æœ‰é†ƒæ¼¬ç—•è·¡ã€‚å»ºè­°ç«‹åˆ»å»è½é¦–è©©æ­Œå£“å£“é©šã€‚" }, { min: 11, max: 30, title: "å«é¹½é‡ 20%ï¼šå¾®é¹¹å°é®®è‚‰", desc: "å¾®é¹¹ã€‚å¤§æ¦‚å°±æ˜¯è–¯æ¢å¿˜è¨˜åŠ é¹½çš„ç¨‹åº¦ï¼Œå±¬éˆå‘³é“æ·¡å¦‚æ°´ã€‚" }, { min: 31, max: 60, title: "å«é¹½é‡ 50%ï¼šå…¥å‘³æ¨™æº–æ¬¾", desc: "é†ƒæ¼¬å¾—æ°åˆ°å¥½è™•ï¼æœ‰å±¬éˆçš„æ°£è³ªï¼Œä¹Ÿæœ‰å±¬ä¸–çš„å¿«æ¨‚ï¼Œç”Ÿæ´»åœ¨æ©å…¸çš„å¹³è¡¡é»ã€‚" }, { min: 61, max: 90, title: "å«é¹½é‡ 80%ï¼šè³‡æ·±è€é¹¹é­š", desc: "å¤ªè–æ½”äº†ï¼ä½ ç¾åœ¨æ•£ç™¼å‡ºçš„é¹½å‘³è¶³ä»¥è®“å‘¨åœçš„é­”é¬¼æ„Ÿåˆ°ä¹¾æ¸´é›£è€ã€‚" }, { min: 91, max: 100, title: "å«é¹½é‡ 99%ï¼šå±¬éˆæ ¸å½ˆ", desc: "ä½ å·²ç¶“ä¸æ˜¯é¹¹é­šäº†ï¼Œä½ æ˜¯é¹½æœ¬èº«ã€‚è«‹å–æ¯çå¥¶å¹³è¡¡ä¸€ä¸‹å¤ªéç¥è–çš„é«”è³ªã€‚" }];
        let preservativePool = [{ tMin: 0, tMax: 30, content: "ä½ æ˜¯ç¥çœ¼ä¸­çš„ç³äººï¼Œå°±ç®—ä½ ç¾åœ¨åªæ˜¯æ¢å»¢é­šï¼Œä¹Ÿæ˜¯æœ€è²´çš„é‚£æ¢ã€‚" }, { tMin: 0, tMax: 50, content: "æ·±å‘¼å¸ï¼Œå¤©å¡Œä¸‹ä¾†æœ‰è€¶ç©Œé ‚è‘—ï¼Œä½ è² è²¬èººå¹³é ˜å—æ©å…¸å°±å¥½ã€‚" }, { tMin: 0, tMax: 100, content: "ä¸è«–ä½ ä»Šå¤©å¹¾åº¦ï¼Œç¥æ„›ä½ çš„ç¨‹åº¦å§‹çµ‚æ˜¯ 100%ï¼Œé€™æ‰æ˜¯æœ€çŒ›çš„é˜²è…åŠ‘ã€‚" }];
        const quotes = [{ text: "å‡¡å‹è‹¦æ“”é‡æ“”çš„äººå¯ä»¥åˆ°æˆ‘é€™è£¡ä¾†ï¼Œæˆ‘å°±ä½¿ä½ å€‘å¾—å®‰æ¯ã€‚", source: "é¦¬å¤ªç¦éŸ³ 11:28", comment: "(é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼šå¿«å»ç¡ï¼Œåˆ¥å†æ»‘æ‰‹æ©Ÿäº†)" }, { text: "ä½ å€‘è¦ä¼‘æ¯ï¼Œè¦çŸ¥é“æˆ‘æ˜¯ç¥ã€‚", source: "è©©ç¯‡ 46:10", comment: "(é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼šè½è©±ï¼Œç¾åœ¨å°±å»èººå¹³ï¼Œå‰©ä¸‹çš„äº¤çµ¦è€é—†)" }, { text: "å–œæ¨‚çš„å¿ƒä¹ƒæ˜¯è‰¯è—¥ï¼Œæ†‚å‚·çš„éˆä½¿éª¨æ¯ä¹¾ã€‚", source: "ç®´è¨€ 17:22", comment: "(é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼šå¿ƒæƒ…å¥½æœ€é‡è¦ï¼Œå³ä½¿ä½ åªæ˜¯ä¸€æ¢é¹¹é­š)" }];
        const fullChecklistItems = ["ä½ ä¸é †æœå°±æ˜¯ä¸è’™ç¦", "é€™æ˜¯åœ¨è¨“ç·´ä½ çš„ä¿¡å¿ƒ/ç ´ç¢è€æˆ‘", "ä¸å¯è§¸æ‘¸/è³ªç–‘å—è†è€…", "é€™æ˜¯é­”é¬¼çš„æ”»æ“Š", "é›¢é–‹é€™é–“æ•™æœƒä½ å°±æ²’é®è“‹äº†", "è–éˆæ„Ÿå‹•æˆ‘å«ä½ åšé€™ä»¶äº‹", "ä½ è¦æŠŠä½ çš„ä»¥æ’’(æœ€æ„›çš„)ç»ä¸Š"];
        let puaData = { love: { sentence: "ä½ ä¸æœäº‹/ä¸èšæœƒ å°±æ˜¯ä¸æ„›ä¸»ï¼", trans: "æˆ‘éœ€è¦å…è²»å‹å‹•åŠ›ä¾†å¡«è£œè·ç¼ºï¼Œè«‹ä¸è¦è®“æˆ‘é›£åšäººã€‚", defenses: ["ç¥çš„æ„›æ˜¯ç„¡æ¢ä»¶çš„ã€‚æˆ‘çš„ä¼‘æ¯ä¹Ÿæ˜¯ä¸€ç¨®æ•¬æ‹œã€‚", "é¦¬åˆ©äºé¸æ“‡äº†ä¸Šå¥½çš„ç¦åˆ†(èººå¹³)ï¼Œæ˜¯ä¸æœƒè¢«å¥ªå»çš„ã€‚"], level: "â­â­â­" }, submit: { sentence: "ä½ è¦é †æœæ¬ŠæŸ„ï¼Œä¸è¦å•ç‚ºä»€éº¼ã€‚", trans: "é–‰å˜´ï¼Œè½æˆ‘çš„å°±å¥½ã€‚æˆ‘ä¸æƒ³è§£é‡‹ï¼Œä¹Ÿä¸æƒ³è¢«æŒ‘æˆ°ã€‚", defenses: ["é †æœç¥å¤§æ–¼é †æœäºº.ç›²å¾çµ•å°ä¸æ˜¯é †æœã€‚", "æˆ‘ä¹Ÿåœ¨é †æœç¥çµ¦æˆ‘çš„æ„Ÿå‹•ï¼šç¾åœ¨å…ˆä¸è¦ã€‚"], level: "â­â­â­â­" }, touch: { sentence: "ä¸å¯è§¸æ‘¸è€¶å’Œè¯çš„å—è†è€…ï¼", trans: "æˆ‘æ˜¯ç‰¹æ¬Šéšç´šï¼Œæˆ‘æœ‰ç¥è–è±å…æ¬Šï¼Œä½ ä¸èƒ½è³ªç–‘æˆ‘çš„éŒ¯èª¤ã€‚", defenses: ["çœŸç†è¶Šè¾¯è¶Šæ˜ã€‚å¦‚æœæ€•è¢«æ‘¸ï¼Œæ˜¯ä¸æ˜¯è£¡é¢æœ‰é¬¼ï¼Ÿ", "æˆ‘å€‘éƒ½æ˜¯å›å°Šçš„ç¥­å¸ï¼Œå¤§å®¶éƒ½æ˜¯å—è†è€…ï¼Œè«‹å¹³ç­‰å°è©±ã€‚"], level: "â­â­â­â­â­" } };
        const shields = { marriage: ["æˆ‘åœ¨ç­‰å€™ç¥æ‰€é å‚™çš„äºç•¶/å¤å¨ƒï¼Œé€™äº‹æ€¥ä¸å¾—ã€‚", "ä¿ç¾…èªªå®ˆç´ å®‰å¸¸ä¹Ÿæ˜¯å¥½çš„ã€‚"], salary: ["ç©è²¡å¯¶åœ¨å¤©ä¸Šï¼Œåœ°ä¸Šçš„æ•¸å­—å¦‚æµ®é›²ã€‚", "è€¶å’Œè¯ä»¥å‹’å¿…æœ‰é å‚™ã€‚"], serve: ["é€™é™£å­ç¥å¸¶é ˜æˆ‘é€²å…¥æ› é‡å­¸ç¿’å®‰éœçš„åŠŸèª²ã€‚", "æˆ‘åœ¨èª¿æ•´å±¬éˆçš„æ­¥ä¼ã€‚"] };

        let biblePlan = [];
        let prayers = [], goals = [], userSignals = [], savingsPlan = [], wishlist = [];
        let yearlyKeyword = '';
        let currentPuaSelection = null, currentShieldSelection = null, currentSaltPercent = 0;
        let currentFullText = ""; // ç”¨æ–¼è¤‡è£½åŠŸèƒ½

        // --- Helper Functions ---
        async function fetchAndParseCSV(gid) {
            const sheetId = '2PACX-1vSdgi7Fr-SIVYoVShmmXsGD_ZSYC-nPNaWyp42Haii8fdGtKkLS6jDJ1bPXWyEnknDStJgEkI3WrrYy';
            const url = `https://docs.google.com/spreadsheets/d/e/${sheetId}/pub?gid=${gid}&single=true&output=csv`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network error');
                const csvText = await response.text();
                if (csvText.startsWith('<!doctype html')) throw new Error('HTML received');
                const rows = csvText.split(/\r?\n/);
                if (rows.length === 0) return [];
                const parseCSVLine = (line) => {
                    const cols = []; let inQuote = false; let currentVal = '';
                    for(let j=0; j<line.length; j++) {
                        const char = line[j];
                        if(char === '"') inQuote = !inQuote;
                        else if(char === ',' && !inQuote) { cols.push(currentVal); currentVal = ''; } else currentVal += char;
                    }
                    cols.push(currentVal);
                    return cols.map(c => c.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                };
                const headers = parseCSVLine(rows[0]).map(h => h.trim().toLowerCase().replace(/^\ufeff/, ''));
                return { headers, rows: rows.slice(1), parser: parseCSVLine };
            } catch (error) { return null; }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.querySelector('span').innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function saveToStorage(key, value) {
            try { localStorage.setItem(key, value); } 
            catch (e) { showToast('âš ï¸ å„²å­˜å¤±æ•—ï¼šç©ºé–“ä¸è¶³æˆ–è¨­å®šå•é¡Œ'); }
        }

        function generateAppIcons() {
            const canvas = document.createElement('canvas'); canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d'); ctx.fillStyle = '#7CA1B3'; ctx.fillRect(0, 0, 512, 512);
            const svgString = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><path d="M100 80 C 150 80, 180 110, 180 130 C 180 150, 150 170, 100 170 C 50 170, 20 150, 20 130 C 20 110, 50 80, 100 80 Z" fill="#FFFFFF"/><path d="M180 130 L 200 110 L 200 150 Z" fill="#FFFFFF"/><ellipse cx="60" cy="135" rx="10" ry="6" fill='%23FFAB91' opacity='1'/><ellipse cx="140" cy="135" rx="10" ry="6" fill='%23FFAB91' opacity='1'/><g stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'><line x1='75' y1='112' x2='75' y2='128'/><line x1='69' y1='118' x2='81' y2='118'/><line x1='125' y1='112' x2='125' y2='128'/><line x1='119' y1='118' x2='131' y2='118'/></g><line x1='95' y1='145' x2='105' y2='145' stroke='%237CA1B3' stroke-width='5' stroke-linecap='round'/><ellipse cx='100' cy='50' rx='60' ry='10' fill='none' stroke='%23D4B483' stroke-width='5'/></svg>`;
            const img = new Image(); img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgString);
            img.onload = function() { ctx.drawImage(img, 56, 56, 400, 400); const pngUrl = canvas.toDataURL('image/png'); const favLink = document.getElementById('favicon-link'); const appleLink = document.getElementById('apple-icon-link'); if(favLink) favLink.href = pngUrl; if(appleLink) appleLink.href = pngUrl; };
        }

        // --- è®€ç¶“è¨ˆç•«ç”Ÿæˆ (ä¿ç•™åŸæœ¬é‚è¼¯) ---
        function generateBiblePlan() {
            let plan = [];
            const otBooks = bibleBooks.filter(b => b.type === 1);
            const ntBooks = bibleBooks.filter(b => b.type === 2);
            const psBooks = bibleBooks.filter(b => b.type === 3); 
            
            let pointers = {
                ot: { bookIdx: 0, chap: 1, rate: 2.05, acc: 0 },
                nt: { bookIdx: 0, chap: 1, rate: 1, acc: 0, loop: true },
                ps: { bookIdx: 0, chap: 1, rate: 1, acc: 0, loop: true }
            };

            const getReadingForTrack = (trackName, books) => {
                let p = pointers[trackName];
                if (!p.loop && p.bookIdx >= books.length) return null; 
                p.acc += p.rate;
                let chaptersToRead = Math.floor(p.acc);
                if (p.loop && chaptersToRead < 1) chaptersToRead = 1;
                if (plan.length === 0 && chaptersToRead === 0 && trackName === 'ot') chaptersToRead = 1;
                if (chaptersToRead === 0) return null;
                p.acc -= chaptersToRead;
                let readings = [];
                let startChap = p.chap;
                if (p.loop && p.bookIdx >= books.length) { p.bookIdx = 0; p.chap = 1; startChap = 1; }
                let currentBook = books[p.bookIdx];
                for (let i = 0; i < chaptersToRead; i++) {
                    if (p.bookIdx >= books.length) {
                        if (p.loop) { p.bookIdx = 0; p.chap = 1; startChap = 1; currentBook = books[0]; }
                        else break;
                    }
                    currentBook = books[p.bookIdx];
                    p.chap++;
                    if (p.chap > currentBook.chapters) {
                        readings.push({ book: currentBook, start: startChap, end: currentBook.chapters });
                        p.bookIdx++;
                        p.chap = 1;
                        if (p.bookIdx < books.length) { currentBook = books[p.bookIdx]; startChap = 1; }
                        else if (p.loop) { currentBook = books[0]; startChap = 1; }
                    }
                }
                if (p.chap > startChap) readings.push({ book: currentBook, start: startChap, end: p.chap - 1 });
                
                return readings.map(r => ({
                    text: `${r.book.name} ${r.start}${r.end > r.start ? '-' + r.end : ''}`,
                    abbr: `${r.book.abbr}${r.start}${r.end > r.start ? '-' + r.end : ''}`,
                    bookCode: r.book.code,
                    chapter: r.start
                }));
            };

            const currentYear = new Date().getFullYear();
            for (let i = 0; i < 365; i++) {
                let date = new Date(currentYear, 0, 1);
                date.setDate(date.getDate() + i);
                let dateStr = `${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`; // æ”¹ç‚º MM-DD æ ¼å¼ä»¥é…åˆæ–°UI

                let otRead = getReadingForTrack('ot', otBooks);
                let ntRead = getReadingForTrack('nt', ntBooks);
                let psRead = getReadingForTrack('ps', psBooks);
                let proChap = (i % 31) + 1;
                let proRead = [{ text: `ç®´è¨€ ${proChap}`, abbr: `ç®´${proChap}`, bookCode: "PRO", chapter: proChap }];

                let fullReadings = [];
                if (otRead) otRead.forEach(r => fullReadings.push({...r, type: 'èˆŠ'}));
                if (ntRead) ntRead.forEach(r => fullReadings.push({...r, type: 'æ–°'}));
                if (psRead) psRead.forEach(r => fullReadings.push({...r, type: 'è©©'}));
                if (proRead) proRead.forEach(r => fullReadings.push({...r, type: 'ç®´'}));

                // çµ„åˆé¡¯ç¤ºæ–‡å­— (Card: ä½¿ç”¨ abbr ç¸®å¯«)
                let mainText = "";
                if (otRead) mainText += otRead[0].abbr + " "; 
                if (ntRead) mainText += ntRead[0].abbr;
                // å¦‚æœ OT/NT éƒ½æ²’æœ‰ï¼Œé¡¯ç¤ºè©©ç¯‡ç¸®å¯« (ç†è«–ä¸Šç¾åœ¨éƒ½æœ‰äº†)
                if (!otRead && !ntRead && psRead) mainText = psRead[0].abbr;

                // å¦‚æœæ–‡å­—å¤ªé•·ï¼Œæ¨™è¨»æœ‰é¡å¤–é€²åº¦
                let extraMark = "";
                if (psRead || proRead) extraMark = "+è©©/ç®´";

                plan.push({ 
                    day: i + 1, 
                    dateStr: dateStr, 
                    details: fullReadings,
                    reading: mainText.trim() || "å®‰æ¯æ—¥ (è£œé€²åº¦)",
                    extraMark: extraMark,
                    completed: false 
                });
            }
            return plan;
        }

        // --- Data Loaders ---
        async function loadOnlineQuotes() { const d = await fetchAndParseCSV('1349046456'); if(!d)return; let idx=d.headers.findIndex(h=>['text','quote'].some(k=>h.includes(k)))||0; dailyQuotesPool=[]; d.rows.forEach(l=>{const c=d.parser(l);if(c[idx])dailyQuotesPool.push(c[idx])}); refreshDailyWord(); }
        async function loadSaltStatusMap() { const d = await fetchAndParseCSV('138033526'); if(d){ onlineSaltStatusMap=[]; d.rows.forEach(l=>{const c=d.parser(l);onlineSaltStatusMap.push({min:parseInt(c[d.headers.indexOf('min_percent')]),max:parseInt(c[d.headers.indexOf('max_percent')]),title:c[d.headers.indexOf('status_title')],desc:c[d.headers.indexOf('status_desc')]})}); } }
        async function loadPreservativePool() { const d=await fetchAndParseCSV('159897993'); if(d){ let idx={min:d.headers.findIndex(h=>h.includes('min'))||0,max:d.headers.findIndex(h=>h.includes('max'))||1,c:d.headers.findIndex(h=>h.includes('content'))||2}; onlinePreservativePool=[]; d.rows.forEach(l=>{const c=d.parser(l);onlinePreservativePool.push({tMin:parseInt(c[idx.min]),tMax:parseInt(c[idx.max]),content:c[idx.c]})}); } }
        async function loadFlipQuotes() { const d=await fetchAndParseCSV('1402400724'); if(d){ let idx={c:d.headers.findIndex(h=>h.includes('content'))||0,s:d.headers.findIndex(h=>h.includes('source'))||1,cm:d.headers.findIndex(h=>h.includes('comment'))||2}; onlineFlipQuotes=[]; d.rows.forEach(l=>{const c=d.parser(l);if(c[idx.c])onlineFlipQuotes.push({text:c[idx.c],source:c[idx.s]||"",comment:c[idx.cm]||""})}); } }
        async function loadPuaData() { const d=await fetchAndParseCSV('0'); if(!d){renderPuaTags();return;} let idx={s:d.headers.findIndex(h=>h.includes('pua'))||0,t:d.headers.findIndex(h=>h.includes('trans'))||1,d:d.headers.findIndex(h=>h.includes('defense'))||2,l:d.headers.findIndex(h=>h.includes('level'))||3}; onlinePuaData=[]; d.rows.forEach((l,i)=>{const c=d.parser(l);if(c[idx.s])onlinePuaData.push({key:`pua_${i}`,sentence:c[idx.s],trans:c[idx.t],defenses:c[idx.d]?c[idx.d].split(/[|\n]/):[],level:c[idx.l]})}); renderPuaTags(); }
        async function loadShieldData() { const d=await fetchAndParseCSV('1087555591'); if(!d){renderShieldTags();return;} let idx={l:d.headers.findIndex(h=>h.includes('label'))||0,o:d.headers.findIndex(h=>h.includes('options'))||1}; onlineShieldData=[]; d.rows.forEach(l=>{const c=d.parser(l);if(c[idx.l])onlineShieldData.push({label:c[idx.l],options:c[idx.o].split(/[|\n]/)})}); renderShieldTags(); }

        // --- Core UI & Logic ---
        function refreshDailyWord() { const el=document.getElementById('daily-word'); if(el) el.innerHTML=`<span>ğŸ’¬ å°èªï¼š${dailyQuotesPool.length?dailyQuotesPool[Math.floor(Math.random()*dailyQuotesPool.length)]:preservativePool[0].content}</span> <span class="refresh-icon">â†»</span>`; }
        function setRandomStatus() { 
            const t=document.getElementById('daily-status-title'), d=document.getElementById('daily-status-desc'); if(!t)return; 
            // Calculate REAL percentage based on biblePlan completion
            const completedCount = biblePlan.filter(d => d.completed).length;
            // é¿å…é™¤ä»¥ 0
            const totalDays = biblePlan.length || 365;
            currentSaltPercent = Math.floor((completedCount / totalDays) * 100);

            const s=(onlineSaltStatusMap.length?onlineSaltStatusMap:saltStatusMap).find(x=>currentSaltPercent>=x.min&&currentSaltPercent<=x.max)||saltStatusMap[0]; 
            t.style.opacity=0;d.style.opacity=0; 
            
            setTimeout(()=>{
                // Handle % placeholder replacement if exists, otherwise append
                if (s.title.includes('%')) {
                     t.innerText = s.title.replace(/\d+%/, currentSaltPercent + "%");
                } else {
                     t.innerText = `å«é¹½é‡ ${currentSaltPercent}%ï¼š${s.title}`;
                }
                d.innerText=s.desc;
                t.style.opacity=1;d.style.opacity=1;
            },200); 
            
            refreshDailyWord(); 
            // Also refresh Home Progress UI
            updateHomeStatus();
        }
        function getPreservative() { const d=document.getElementById('preservative-display'); d.style.opacity=0; const pool=onlinePreservativePool.length?onlinePreservativePool:preservativePool; const msg=pool[Math.floor(Math.random()*pool.length)].content; setTimeout(()=>{d.innerText=`ã€Œ${msg}ã€`;d.style.opacity=1;},200); }
        function flipCard() { document.querySelector('.flip-container').classList.toggle('flipped'); if(document.querySelector('.flip-container').classList.contains('flipped')){const q=(onlineFlipQuotes.length?onlineFlipQuotes:quotes)[Math.floor(Math.random()*onlineFlipQuotes.length||quotes.length)]; document.getElementById('quote-content').innerText=q.text; document.getElementById('quote-source').innerText=q.source; document.getElementById('quote-comment').innerHTML=`<strong>ä¸»å»šç¥•æ–¹ï¼š</strong><br>${q.comment.replace(/[()]/g,'').replace('é¹¹é­šä¸»å»šçš„ç¥•æ–¹ï¼š','')}`; } }
        function saveCardImage(e) { e.stopPropagation(); showToast('ğŸ“¸ æˆªåœ–ä¸­...'); const temp=document.createElement('div'); temp.style.position='fixed'; temp.style.top='0'; temp.style.zIndex='-9'; temp.style.width='350px'; temp.innerHTML=`<div style="background:#FDFBF7;border:2px solid #7CA1B3;border-radius:24px;padding:40px 30px;text-align:center;font-family:'Noto Sans TC';"><p style="font-family:'Noto Serif TC';font-size:1.4rem;color:#5A524C;margin-bottom:20px;">${document.getElementById('quote-content').innerText}</p><p style="color:#9E9791;margin-bottom:30px;">â€”â€” ${document.getElementById('quote-source').innerText}</p><div style="color:#7CA1B3;font-style:italic;border-top:1px dashed #eee;padding-top:15px;">${document.getElementById('quote-comment').innerHTML}</div><div style="margin-top:30px;font-size:0.75rem;color:#D4B483;">æ©Ÿæ™ºçš„é¹¹é­šç”Ÿæ´»</div></div>`; document.body.appendChild(temp); html2canvas(temp.firstChild,{scale:2,backgroundColor:null}).then(c=>{const a=document.createElement('a');a.download=`salted-fish-${Date.now()}.png`;a.href=c.toDataURL();a.click();document.body.removeChild(temp);showToast('âœ… ä¸‹è¼‰å®Œæˆ');}); }
        function showSection(id, btn) { 
            document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); 
            document.getElementById(id).classList.add('active'); 
            if(btn){document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active')); btn.classList.add('active');}
            
            // è™•ç†éˆä¿®å…§å®¤çš„ç‰¹æ®Šç‰ˆé¢
            const body = document.body;
            const main = document.getElementById('app-main');
            if (id === 'devotion') {
                body.classList.add('devotion-mode');
                main.classList.remove('container-limited');
                main.classList.add('container-full');
                // åˆå§‹åŒ–éˆä¿®é é¢çš„æ—¥æœŸ
                initJournalDate();
            } else {
                body.classList.remove('devotion-mode');
                main.classList.add('container-limited');
                main.classList.remove('container-full');
                document.getElementById('scroll-wrapper').scrollTo(0,0);
            }
        }

        // --- NEW JOURNAL UI LOGIC ---
        const journalEls = {}; // Cache elements

        function initJournalDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const picker = document.getElementById('journal-date-picker');
            if (picker) {
                if (!picker.value) picker.value = `${yyyy}-${mm}-${dd}`;
                handleJournalDateChange(`${mm}-${dd}`);
            }
        }

        function handleJournalDateChange(dateKey) {
            renderPlanButtons(dateKey);
            
            // è¼‰å…¥ç­†è¨˜
            ['note-scripture', 'note-reflection', 'note-prayer'].forEach(id => {
                const saved = localStorage.getItem(`${dateKey}-${id}`);
                const el = document.getElementById(id);
                if(el) el.value = saved || "";
            });

            // è¼‰å…¥å¿ƒæƒ…
            const savedMood = localStorage.getItem(`${dateKey}-note-mood`);
            const moodBtns = document.querySelectorAll('.mood-btn');
            moodBtns.forEach(b => b.classList.remove('active'));
            if(savedMood) {
                const targetBtn = Array.from(moodBtns).find(b => b.dataset.mood === savedMood);
                if(targetBtn) targetBtn.classList.add('active');
            }
        }

        function renderPlanButtons(dateKey) {
            const planList = document.getElementById('plan-list');
            const mobilePlanList = document.getElementById('mobile-plan-list');
            if (!planList || !mobilePlanList) return;

            planList.innerHTML = "";
            mobilePlanList.innerHTML = "";
            
            // å¾ biblePlan å°‹æ‰¾è©²æ—¥æœŸçš„è¨ˆç•«
            const todayPlan = biblePlan.find(p => p.dateStr === dateKey) || biblePlan[0];
            const details = todayPlan.details || [];

            const createBtn = (item) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left px-8 py-12 rounded-xl border border-[#D6D0C8] bg-white hover:border-[#A68C76] hover:bg-[#FAF9F6] transition-all group flex flex-col gap-6 shadow-sm hover:shadow-md min-h-[140px]";
                btn.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] font-bold text-[#B0AAA3] uppercase group-hover:text-[#A68C76] transition-colors tracking-widest">${item.type}</span>
                        <div class="w-2 h-2 rounded-full bg-[#EBE6DE] group-hover:bg-[#A68C76] transition-colors"></div>
                    </div>
                    <span class="text-base font-serif text-[#5E5A54] group-hover:text-[#3E3A34] tracking-wide">${item.abbr}</span>
                `;
                btn.onclick = () => fetchBible(item); // å‚³å…¥å®Œæ•´ç‰©ä»¶ä»¥ä¾¿ fetch
                return btn;
            };

            const createMobileBtn = (item) => {
                const btn = document.createElement('button');
                btn.className = "flex-shrink-0 px-6 py-6 border border-[#D6D0C8] rounded-xl bg-white text-xs hover:bg-[#F2EBE5] hover:border-[#A68C76] transition-colors flex flex-col items-center justify-center gap-2 min-w-[120px] shadow-sm";
                btn.innerHTML = `<span class="text-[10px] text-[#B0AAA3] tracking-widest">${item.type}</span><span class="font-serif text-[#5E5A54] text-base">${item.abbr}</span>`;
                btn.onclick = () => fetchBible(item);
                return btn;
            };

            details.forEach(item => {
                planList.appendChild(createBtn(item));
                mobilePlanList.appendChild(createMobileBtn(item));
            });
        }

        async function fetchBible(item, isSearch = false) {
            const content = document.getElementById('bible-content');
            const title = document.getElementById('bible-title');
            const tag = document.getElementById('bible-book-tag');
            const copyBtn = document.getElementById('copy-btn');
            
            content.innerHTML = '<div class="h-full flex flex-col items-center justify-center gap-4"><span class="loader"></span><span class="text-xs text-[#94908A] tracking-widest animate-pulse font-serif">è®€å–ä¸­...</span></div>';
            title.innerText = "è®€å–ä¸­...";
            copyBtn.classList.add('hidden');

            if (isSearch) {
                // Bolls Life Search
                const query = typeof item === 'string' ? item : "";
                const url = `https://bolls.life/search/CUNP/?search=${encodeURIComponent(query)}`;
                try {
                    const res = await fetch(url);
                    if(!res.ok) throw new Error("Network");
                    const data = await res.json();
                    if (data.length > 0) {
                        renderScriptureBolls(data, query, true);
                    } else {
                        renderDemoScripture(query);
                    }
                } catch(e) { renderDemoScripture(query); }
                return;
            }

            // Reading Mode: Bolls Life
            let startChap = item.chapter;
            let endChap = item.chapter;
            
            const parts = item.text.split(' '); 
            if (parts.length > 1) {
                const range = parts[parts.length - 1]; 
                if (range.includes('-')) {
                    endChap = parseInt(range.split('-')[1]);
                }
            }

            let allVerses = [];
            try {
                // Parallel fetch for multiple chapters
                const promises = [];
                for (let c = startChap; c <= endChap; c++) {
                    promises.push(fetch(`https://bolls.life/get-text/CUNP/${item.bookCode}/${c}/`).then(r => r.json()));
                }
                
                const results = await Promise.all(promises);
                
                // Combine results
                results.forEach((chapVerses, idx) => {
                    const currentChap = startChap + idx;
                    // Add chapter info for rendering
                    chapVerses.forEach(v => {
                        v.chapter = currentChap;
                        // Bolls returns pk, verse, text
                    });
                    allVerses = allVerses.concat(chapVerses);
                });

                renderScriptureBolls(allVerses, item.text, false);
            } catch (err) {
                console.warn(err);
                renderDemoScripture(item.text);
            }
        }

        function renderScriptureBolls(records, title, isSearch) {
            const content = document.getElementById('bible-content');
            const titleEl = document.getElementById('bible-title');
            const tag = document.getElementById('bible-book-tag');
            const copyBtn = document.getElementById('copy-btn');

            titleEl.innerText = title;
            tag.innerText = isSearch ? "SEARCH RESULT" : "SCRIPTURE";
            
            let html = "";
            let textBuffer = `ã€${title}ã€‘\n`;

            records.forEach(v => {
                let text = v.text;
                let label = isSearch ? `${v.chapter}:${v.verse}` : `${v.verse}`;
                const fullTextForNote = `${text} (${label})`;
                const labelClass = isSearch ? "w-20 text-right pr-2" : "w-8 text-center";

                html += `
                    <div class="mb-2 hover:bg-[#F9F7F5] -mx-4 px-4 py-3 rounded-lg transition-colors cursor-pointer group flex gap-3 items-start" 
                         onclick="appendToNote('${fullTextForNote}')">
                        <span class="text-[10px] text-[#D6D0C8] font-mono pt-2 shrink-0 group-hover:text-[#A68C76] transition-colors ${labelClass}">${label}</span>
                        <span class="text-[#5E5A54] leading-loose group-hover:text-[#3E3A34] text-justify flex-1">${text}</span>
                    </div>
                `;
                textBuffer += `${label} ${text}\n`;
            });

            content.innerHTML = `<div class="max-w-3xl mx-auto">${html}</div>`;
            currentFullText = textBuffer;
            copyBtn.classList.remove('hidden');
        }

        function renderDemoScripture(title) {
            const content = document.getElementById('bible-content');
            const titleEl = document.getElementById('bible-title');
            const tag = document.getElementById('bible-book-tag');
            const copyBtn = document.getElementById('copy-btn');

            titleEl.innerText = title;
            tag.innerText = "PREVIEW MODE";
            content.innerHTML = `<div class="h-full flex items-center justify-center text-[#94908A] font-serif flex-col gap-2">
                <span>ç„¡æ³•é€£ç·šè‡³è³‡æ–™åº«</span>
                <span class="text-xs opacity-60">è«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦</span>
            </div>`;
            copyBtn.classList.add('hidden');
        }

        function appendToNote(text) {
            const field = document.getElementById('note-scripture');
            const prefix = field.value ? "\n" : "";
            field.value += `${prefix}â€¢ ${text}`;
            
            const picker = document.getElementById('journal-date-picker');
            const dateKey = picker.value.substring(5);
            saveNote(dateKey, 'note-scripture', field.value);
            
            field.parentElement.classList.add('bg-[#FAF9F6]');
            setTimeout(() => field.parentElement.classList.remove('bg-[#FAF9F6]'), 300);
        }

        function saveNote(dateKey, id, content) {
            localStorage.setItem(`${dateKey}-${id}`, content);
            const status = document.getElementById('save-status');
            status.style.opacity = '1';
            setTimeout(() => { status.style.opacity = '0'; }, 2000);
        }

        // --- Other Logic (Keep existing functionality) ---
        function renderPuaTags() { 
            const c = document.getElementById('pua-tag-container'); if(!c) return; c.innerHTML = ''; currentPuaSelection = null; document.getElementById('pua-result').style.opacity = 0;
            let src = onlinePuaData.length ? [...onlinePuaData] : Object.keys(puaData).map(k=>({key:k, ...puaData[k]}));
            src.sort(()=>0.5-Math.random()).slice(0,7).forEach(i => { const b = document.createElement('button'); b.className='pua-tag'; b.innerText=i.sentence; b.onclick=()=>{ document.querySelectorAll('.pua-tag').forEach(t=>t.classList.remove('selected')); b.classList.add('selected'); currentPuaSelection=i.key||i; }; c.appendChild(b); });
        }
        function detectPUA() {
            if(!currentPuaSelection) { showToast("è«‹å…ˆé¸æ“‡æ¨™ç±¤"); return; }
            const box = document.getElementById('pua-result'), badge = document.getElementById('pua-level');
            let item = typeof currentPuaSelection === 'string' ? onlinePuaData.find(d=>d.key===currentPuaSelection) : currentPuaSelection;
            if(!item) item = puaData[currentPuaSelection]; 
            box.style.opacity = 0;
            setTimeout(() => {
                document.getElementById('pua-translation').innerText = item.trans;
                document.getElementById('pua-defense').innerText = item.defenses[Math.floor(Math.random()*item.defenses.length)];
                badge.style.display = item.level ? 'inline-block' : 'none'; badge.innerText = `æ¯’æ€§: ${item.level}`;
                box.style.opacity = 1;
            }, 200);
        }
        function togglePuaTest() { const a = document.getElementById('pua-test-area'); a.style.display = a.style.display === 'block' ? 'none' : 'block'; if(a.style.display==='block') initPuaTest(); }
        function initPuaTest() { const l = document.getElementById('test-list'); l.innerHTML=''; fullChecklistItems.sort(()=>0.5-Math.random()).slice(0,7).forEach(t=>{ const d=document.createElement('div'); d.style.marginBottom='10px'; d.style.cursor='pointer'; d.innerHTML=`<input type="checkbox"> <span>${t}</span>`; d.onclick=(e)=>{if(e.target.tagName!=='INPUT') {const c=d.querySelector('input'); c.checked=!c.checked;}}; l.appendChild(d); }); }
        function runPuaTest() { const n = document.querySelectorAll('#test-list input:checked').length; const r = document.getElementById('test-result'); r.style.display='block'; r.innerText = n<=2?"è¼•å¾®æ“¦å‚·":n<=5?"ä¸­æ¯’åæ·±":"é‡åº¦å—ç½æˆ¶ï¼å¿«é€ƒï¼"; }
        function renderShieldTags() {
            const c = document.getElementById('shield-tag-container'); if(!c) return; c.innerHTML=''; currentShieldSelection=null; document.getElementById('shield-result').style.opacity=0; document.getElementById('shield-text').innerText='';
            let src = onlineShieldData.length ? [...onlineShieldData] : Object.keys(shields).map(k=>({label:k==='marriage'?'ä»€éº¼æ™‚å€™çµå©š?':k==='salary'?'è–ªæ°´å¤šå°‘?':'æ²’ä¾†æœäº‹?', options:shields[k]}));
            src.sort(()=>0.5-Math.random()).slice(0,7).forEach(i => { const b = document.createElement('button'); b.className='shield-tag'; b.innerText=i.label; b.onclick=()=>{ document.querySelectorAll('.shield-tag').forEach(t=>t.classList.remove('selected')); b.classList.add('selected'); currentShieldSelection=i; }; c.appendChild(b); });
        }
        function getExcuse() { if(!currentShieldSelection) { showToast("è«‹é¸æ“‡æƒ…å¢ƒ"); return; } const opts = currentShieldSelection.options; document.getElementById('shield-result').style.opacity=0; setTimeout(()=>{ document.getElementById('shield-text').innerText=`ã€Œ${opts[Math.floor(Math.random()*opts.length)]}ã€`; document.getElementById('shield-result').style.opacity=1; },100); }
        function switchFlowTab(t) { document.querySelectorAll('#flow .sub-section').forEach(e=>e.classList.remove('active')); document.getElementById(`tab-${t}`).classList.add('active'); document.querySelectorAll('#flow .tab-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); }
        function renderSavingsGrid() { const grid = document.getElementById('savings-grid'); if(!grid) return; grid.innerHTML = ''; let total = 0; for (let i=1; i<=365; i++) { const s = savingsPlan[i]; if(s) total+=i; const d = document.createElement('div'); d.className = `savings-cell ${s?'saved':''}`; d.innerText=i; d.onclick=()=>confirmSave(i); grid.appendChild(d); } document.getElementById('savings-total').innerText = `$${total.toLocaleString()}`; }
        function confirmSave(i) { const saved = savingsPlan[i]; showConfirm(saved?`å–æ¶ˆå­˜å…¥ $${i}?`:`å­˜å…¥ $${i}?`, ()=>{ savingsPlan[i]=!saved; saveToStorage('savingsPlan', JSON.stringify(savingsPlan)); renderSavingsGrid(); if(!saved) showToast(`ğŸ’° å­˜å…¥ $${i}ï¼`); }); }
        function renderWishlist() { const list = document.getElementById('wish-list'); if(!list) return; list.innerHTML = ''; if(wishlist.length===0) { list.innerHTML='<div style="text-align:center; color:#ccc; font-size:0.9rem; padding: 20px;">é‚„æ²’æœ‰è¨±é¡˜å–” âœ¨</div>'; return; } wishlist.forEach(w => { const d = document.createElement('div'); d.className=`wish-item ${w.fulfilled?'fulfilled':''}`; d.innerHTML=`<div class="wish-content"><div class="wish-text">${w.content}</div><div class="wish-meta">$${w.cost?parseInt(w.cost).toLocaleString():'--'}</div></div><div style="display:flex;"><button class="action-btn" onclick="toggleWishStatus(${w.id})">${w.fulfilled?'â†©ï¸':'ğŸ'}</button><button class="action-btn" onclick="deleteWish(${w.id})">ğŸ—‘ï¸</button></div>`; list.appendChild(d); }); }
        function addWish() { const i1 = document.getElementById('new-wish-input'), i2 = document.getElementById('new-wish-cost'); if(!i1.value.trim()) return; wishlist.push({id:Date.now(), content:i1.value.trim(), cost:i2.value, fulfilled:false}); saveToStorage('wishlist', JSON.stringify(wishlist)); i1.value=''; i2.value=''; renderWishlist(); }
        function toggleWishStatus(id) { const w = wishlist.find(i=>i.id===id); if(w) { w.fulfilled=!w.fulfilled; saveToStorage('wishlist', JSON.stringify(wishlist)); renderWishlist(); } }
        function deleteWish(id) { showConfirm("åˆªé™¤é¡˜æœ›ï¼Ÿ", ()=>{ wishlist = wishlist.filter(i=>i.id!==id); saveToStorage('wishlist', JSON.stringify(wishlist)); renderWishlist(); }); }
        function refreshFinancialEncouragement() { const el = document.getElementById('financial-encouragement'); if(el) el.innerText = financialEncouragements[Math.floor(Math.random() * financialEncouragements.length)]; }
        async function shareNote() {
            const date = document.getElementById('journal-date-picker').value;
            const mood = document.getElementById('note-mood').value || "";
            const s = document.getElementById('note-scripture').value || "(ç„¡)";
            const r = document.getElementById('note-reflection').value || "(ç„¡)";
            const p = document.getElementById('note-prayer').value || "(ç„¡)";
            const title = `éˆä¿®æ—¥èªŒ ${date} ${mood}`;
            const text = `${title}\n\nğŸ“– æ„Ÿå‹•ç¶“æ–‡ï¼š\n${s}\n\nğŸ’¡ é ˜å—ï¼š\n${r}\n\nğŸ™ ç¦±å‘Šï¼š\n${p}`;
            if (navigator.share) {
                try { await navigator.share({ title: title, text: text }); } catch (err) { console.log('åˆ†äº«å–æ¶ˆ'); }
            } else {
                navigator.clipboard.writeText(text).then(() => { showToast("å·²è¤‡è£½æ—¥èªŒå…§å®¹ï¼"); });
            }
        }
        function downloadNote() {
            const date = document.getElementById('journal-date-picker').value;
            const mood = document.getElementById('note-mood').value || "";
            const s = document.getElementById('note-scripture').value;
            const r = document.getElementById('note-reflection').value;
            const p = document.getElementById('note-prayer').value;
            const content = `éˆä¿®æ—¥èªŒ ${date} ${mood}\n\nã€æ„Ÿå‹•ç¶“æ–‡ã€‘\n${s}\n\nã€é ˜å—ã€‘\n${r}\n\nã€ç¦±å‘Šã€‘\n${p}`;
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `devotion-${date}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        function exportData() {
            // Updated Export for new Key
            const data = { 
                biblePlan_2026: localStorage.getItem('biblePlan_2026'), 
                prayers: localStorage.getItem('prayers'), 
                goals: localStorage.getItem('goals'), 
                userSignals: localStorage.getItem('userSignals'), 
                yearlyKeyword: localStorage.getItem('yearlyKeyword'), 
                savingsPlan: localStorage.getItem('savingsPlan'), 
                wishlist: localStorage.getItem('wishlist') 
            };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `salted-fish-backup-${new Date().toISOString().slice(0,10)}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        }
        function importData(input) {
            const file = input.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    // Support both old and new keys for import
                    if (data.biblePlan_2026) saveToStorage('biblePlan_2026', data.biblePlan_2026);
                    else if (data.biblePlan) saveToStorage('biblePlan_2026', data.biblePlan); // Migration on import

                    if (data.prayers) saveToStorage('prayers', data.prayers);
                    if (data.goals) saveToStorage('goals', data.goals);
                    if (data.userSignals) saveToStorage('userSignals', data.userSignals);
                    if (data.yearlyKeyword) saveToStorage('yearlyKeyword', data.yearlyKeyword);
                    if (data.savingsPlan) saveToStorage('savingsPlan', data.savingsPlan);
                    if (data.wishlist) saveToStorage('wishlist', data.wishlist);
                    showToast('åŒ¯å…¥æˆåŠŸï¼é é¢å°‡é‡æ–°æ•´ç†ã€‚'); setTimeout(() => location.reload(), 1500);
                } catch (err) { showToast('åŒ¯å…¥å¤±æ•—ï¼Œæª”æ¡ˆæ ¼å¼å¯èƒ½éŒ¯èª¤ã€‚'); }
            };
            reader.readAsText(file);
        }
        let pendingConfirmAction = null;
        function showConfirm(msg, action) { document.getElementById('confirm-msg').innerText = msg; pendingConfirmAction = action; document.getElementById('confirm-modal').classList.add('show'); }
        function closeConfirmModal() { document.getElementById('confirm-modal').classList.remove('show'); pendingConfirmAction = null; }
        document.getElementById('confirm-btn-action').onclick = function() { if (pendingConfirmAction) pendingConfirmAction(); closeConfirmModal(); };

        function showHelpModal() { document.getElementById('help-modal').classList.add('show'); }
        function closeHelpModal() { document.getElementById('help-modal').classList.remove('show'); }

        // --- NEW: Update Home Status (Replaces renderBibleGrid) ---
        function updateHomeStatus() {
            // Get today's date in MM-DD format
            const now = new Date();
            const todayStr = `${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            
            // Find today's plan
            let todayPlan = biblePlan.find(d => d.dateStr === todayStr);
            
            // Fallback logic
            if (!todayPlan && biblePlan.length > 0) todayPlan = biblePlan[0];

            const scopeText = document.getElementById('plan-scope-text');
            if(scopeText) {
                if (todayPlan) {
                    const extra = todayPlan.extraMark ? ` ${todayPlan.extraMark}` : '';
                    scopeText.innerText = (todayPlan.reading || "ä»Šæ—¥æš«ç„¡é€²åº¦") + extra;
                } else {
                    scopeText.innerText = "ä»Šæ—¥ä¼‘æ¯"; // é˜²å‘†é¡¯ç¤º
                }
            }
            
            // Update Date Text
            const dateText = document.getElementById('current-date-text');
            if(dateText) dateText.innerText = `${now.getMonth() + 1}/${now.getDate()}`; // Display as M/D

            // Update Progress Bar
            let completedCount = biblePlan.filter(d => d.completed).length;
            const percent = ((completedCount / 365) * 100).toFixed(1);
            
            const progressBar = document.getElementById('bible-progress'); 
            if(progressBar) progressBar.style.width = `${percent}%`;
            
            const percentText = document.getElementById('percent-text');
            if(percentText) percentText.innerText = `${percent}% å…¥å‘³`;

            // Update Stars
            const saltStars = document.getElementById('today-salt-stars');
            if (saltStars && todayPlan) {
                const count = todayPlan.details ? todayPlan.details.length : 0;
                saltStars.innerText = count >= 4 ? 'â­â­â­â­â­' : count >= 2 ? 'â­â­â­' : 'â­';
            }
        }

        // --- Check-in Logic for Journal ---
        function handleCheckIn(dateKey) {
            const planIndex = biblePlan.findIndex(p => p.dateStr === dateKey);
            if (planIndex !== -1) {
                const isCompleted = biblePlan[planIndex].completed;
                if (!isCompleted) {
                    biblePlan[planIndex].completed = true;
                    saveToStorage('biblePlan_2026', JSON.stringify(biblePlan));
                    showToast('ğŸ‰ ä»Šæ—¥è®€ç¶“æ‰“å¡æˆåŠŸï¼');
                    updateHomeStatus(); // Refresh Home UI
                } else {
                    showToast('å·²ç¶“æ‰“éå¡å›‰ï¼');
                }
            }
        }

        function initData() {
            // Force Migration to New Key to fix "undefined" issues
            const DB_KEY = 'biblePlan_2026';
            const savedBible = localStorage.getItem(DB_KEY);
            let needRegen = !savedBible;
            
            // Migration Logic: If old key exists but new key doesn't, try to migrate completion status
            if (needRegen) {
                const oldData = localStorage.getItem('biblePlan');
                if (oldData) {
                    try {
                        const oldParsed = JSON.parse(oldData);
                        // Generate fresh plan first
                        biblePlan = generateBiblePlan();
                        
                        // Try to map completion status (Best Effort)
                        // Old format might be M/D, New is MM-DD. 
                        // Simple index mapping might be safer if both are 365 days.
                        if (oldParsed.length === biblePlan.length) {
                            oldParsed.forEach((d, i) => {
                                if (d.completed) biblePlan[i].completed = true;
                            });
                        }
                        
                        saveToStorage(DB_KEY, JSON.stringify(biblePlan));
                        needRegen = false; // Data is ready
                    } catch(e) { 
                        // Migration failed, just regen
                        needRegen = true; 
                    }
                }
            }

            if (!needRegen) {
                try {
                    biblePlan = JSON.parse(savedBible);
                    // Double check integrity
                    if (!biblePlan || biblePlan.length === 0 || !biblePlan[0].dateStr.includes('-')) {
                        needRegen = true;
                    }
                } catch(e) { needRegen = true; }
            }
            
            if (needRegen) {
                biblePlan = generateBiblePlan();
                saveToStorage(DB_KEY, JSON.stringify(biblePlan));
            }

            try { prayers = JSON.parse(localStorage.getItem('prayers')||'[]'); } catch(e){}
            try { goals = JSON.parse(localStorage.getItem('goals')||'[]'); } catch(e){}
            try { userSignals = JSON.parse(localStorage.getItem('userSignals')||'[]'); } catch(e){}
            try { savingsPlan = JSON.parse(localStorage.getItem('savingsPlan')||JSON.stringify(new Array(366).fill(false))); } catch(e){}
            try { wishlist = JSON.parse(localStorage.getItem('wishlist')||'[]'); } catch(e){}
            yearlyKeyword = localStorage.getItem('yearlyKeyword')||'';

            refreshDailyWord();
            refreshFinancialEncouragement();
        }

        window.onload = function() {
            generateAppIcons();
            initData();
            loadOnlineQuotes(); loadPreservativePool(); loadFlipQuotes(); loadPuaData(); loadShieldData();
            loadSaltStatusMap().then(()=>setRandomStatus());
            
            // Journal UI specific events setup
            const picker = document.getElementById('journal-date-picker');
            if (picker) {
                picker.addEventListener('change', (e) => handleJournalDateChange(e.target.value.substring(5)));
            }
            
            // Check-in Button Event
            const checkInBtn = document.getElementById('journal-checkin-btn');
            if (checkInBtn) {
                checkInBtn.addEventListener('click', () => {
                    const dateKey = picker.value.substring(5); // MM-DD
                    handleCheckIn(dateKey);
                });
            }

            document.getElementById('journal-search-btn').addEventListener('click', () => {
                const val = document.getElementById('journal-search-input').value.trim();
                if(val) fetchBible(val, true);
            });
            document.getElementById('journal-search-input').addEventListener('keypress', (e) => {
                if(e.key === 'Enter') {
                    const val = document.getElementById('journal-search-input').value.trim();
                    if(val) fetchBible(val, true);
                }
            });
            document.getElementById('copy-btn').addEventListener('click', () => {
                navigator.clipboard.writeText(currentFullText).then(() => showToast("å·²è¤‡è£½ç¶“æ–‡"));
            });
            ['note-scripture', 'note-reflection', 'note-prayer'].forEach(id => {
                const el = document.getElementById(id);
                el.addEventListener('input', () => {
                    const dateKey = picker.value.substring(5);
                    saveNote(dateKey, id, el.value);
                });
            });
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const mood = btn.dataset.mood;
                    const dateKey = picker.value.substring(5);
                    saveNote(dateKey, 'note-mood', mood);
                });
            });
            
            // Initial call to populate Home stats
            updateHomeStatus();
        };
    </script>
</body>
</html>
